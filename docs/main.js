parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"OtoZ":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(Object.prototype,"$method",{value:function(t,e){Object.defineProperty(this,t,{value:e,enumerable:!1,writable:!0})}}),Object.prototype.$method("setter",function(t,e){Object.defineProperty(this,t,{set:e,enumerable:!1,configurable:!0})}),Object.prototype.$method("getter",function(t,e){Object.defineProperty(this,t,{get:e,enumerable:!1,configurable:!0})}),Object.prototype.$method("accessor",function(t,e){Object.defineProperty(this,t,{set:e.set,get:e.get,enumerable:!1,configurable:!0})}),Object.prototype.$method("forIn",function(t,e){return e=e||this,Object.keys(this).forEach(function(i,n){var s=this[i];t.call(e,i,s,n)},this),this}),Object.prototype.$method("$get",function(t){return t.split(".").reduce(function(t,e){return t&&t[e]},this)}),Object.prototype.$method("$set",function(t,e){t.split(".").reduce(function(t,i,n,s){if(n!==s.length-1)return t[i]||(t[i]={}),t[i];t[i]=e},this)}),Object.prototype.$method("$has",function(t){return this.hasOwnProperty(t)}),Object.prototype.$method("$extend",function(){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)this[e]=t[e]},this),this}),Object.prototype.$method("$safe",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)void 0===this[e]&&(this[e]=t[e])},this),this}),Object.prototype.$method("$strict",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)console.assert(!this[e],"tm error: {0} is Already".format(e)),this[e]=t[e]},this),this}),Object.prototype.$method("$pick",function(){var t={};return Array.prototype.forEach.call(arguments,function(e){e in this&&(t[e]=this[e])},this),t}),Object.prototype.$method("$omit",function(){var t={};for(var e in this)-1==Array.prototype.indexOf.call(arguments,e)&&(t[e]=this[e]);return t}),Object.prototype.$method("$toArray",function(){return Array.prototype.slice.call(this)}),Object.prototype.$method("$watch",function(t,e){for(var i=this,n=null;i&&!(n=Object.getOwnPropertyDescriptor(i,t));)i=Object.getPrototypeOf(i);if(n)if(void 0!==n.value){var s="__"+t,r=this[t];this[s]=r,this.accessor(t,{get:function(){return this[s]},set:function(t){var i=this[s];this[s]=t,e.call(this,t,i)}})}else this.accessor(t,{get:function(){return n.get.call(this)},set:function(t){var i=n.get.call(this);n.set.call(this,t),e.call(this,t,i)}});else{var o="__"+t;this.accessor(t,{get:function(){return this[o]},set:function(t){var i=this[o];this[o]=t,e.call(this,t,i)}})}}),Object.observe||Object.$method("observe",function(t,e){Object.keys(t).forEach(function(i){var n="__"+i,s=t[i];t[n]=s,t.accessor(i,{get:function(){return this[n]},set:function(t){this[n]=t,e()}})})}),Object.unobserve||Object.$method("unobserve",function(t,e){console.assert(!1)}),Number.prototype.$method("round",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return(i=Math.round(i))/e}),Number.prototype.$method("ceil",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return(i=Math.ceil(i))/e}),Number.prototype.$method("floor",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return(i=Math.floor(i))/e}),Number.prototype.$method("toInt",function(){return 0|this}),Number.prototype.$method("toHex",function(){return this.toString(16)}),Number.prototype.$method("toBin",function(){return this.toString(2)}),Number.prototype.$method("toUnsigned",function(){return this>>>0}),Number.prototype.$method("padding",function(t,e){var i=this+"";for(t-=i.length,e=(e||"0")[0];t-- >0;)i=e+i;return i.indexOf("-")>=0&&(i="-"+i.replace("-","")),i}),Number.prototype.$method("times",function(t,e){e=e||this;for(var i=0;i<this;++i)t.call(e,i,this);return this}),Number.prototype.$method("upto",function(t,e,i){i=i||this;for(var n=+this;n<=t;++n)e.call(i,n,this);return this}),Number.prototype.$method("downto",function(t,e,i){i=i||this;for(var n=+this;n>=t;--n)e.call(i,n,this);return this}),Number.prototype.$method("step",function(t,e,i,n){n=n||this;for(var s=+this;s<=t;s+=e)i.call(n,s,this);return this}),Number.prototype.$method("map",function(t,e){e=e||this;for(var i=[],n=0;n<this;++n){var s=t.call(e,n);i.push(s)}return i}),Number.prototype.$method("abs",function(){return Math.abs(this)}),Number.prototype.$method("acos",function(){return Math.acos(this)}),Number.prototype.$method("asin",function(){return Math.asin(this)}),Number.prototype.$method("atan",function(){return Math.atan(this)}),Number.prototype.$method("cos",function(){return Math.cos(this)}),Number.prototype.$method("exp",function(){return Math.exp(this)}),Number.prototype.$method("log",function(){return Math.log(this)}),Number.prototype.$method("max",function(t){return Math.max(this,t)}),Number.prototype.$method("min",function(t){return Math.min(this,t)}),Number.prototype.$method("clamp",function(t,e){return Math.clamp(this,t,e)}),Number.prototype.$method("pow",function(t){return Math.pow(this,t)}),Number.prototype.$method("sin",function(){return Math.sin(this)}),Number.prototype.$method("sqrt",function(){return Math.sqrt(this)}),Number.prototype.$method("tan",function(){return Math.tan(this)}),Number.prototype.$method("toDegree",function(){return this*Math.RAD_TO_DEG}),Number.prototype.$method("toRadian",function(){return this*Math.DEG_TO_RAD}),function(){String.prototype.$method("format",function(t){var e=void 0;if("object"==typeof t)e=function(e,i){return void 0===t[i]?"":t[i]};else{var i=arguments;e=function(t,e){var n=i[parseInt(e)];return null!=n?n:""}}return this.replace(/\{(\w+)\}/g,e)}),String.prototype.$method("trim",function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.$method("capitalize",function(){return this.replace(/\w+/g,function(t){return t.capitalizeFirstLetter()})}),String.prototype.$method("capitalizeFirstLetter",function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()}),String.prototype.$method("toDash",function(){return this.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}),String.prototype.$method("toHash",function(){return this.toCRC32()}),String.prototype.$method("padding",function(t,e){var i=this.toString();for(t-=i.length,e=(e||" ")[0];t-- >0;)i=e+i;return i}),String.prototype.$method("paddingLeft",function(t,e){var i=this.toString();for(t-=i.length,e=(e||" ")[0];t-- >0;)i=e+i;return i}),String.prototype.$method("paddingRight",function(t,e){var i=this.toString();for(t-=i.length,e=(e||" ")[0];t-- >0;)i+=e;return i}),String.prototype.$method("quotemeta",function(t){return this.replace(/([^0-9A-Za-z_])/g,"\\$1")}),String.prototype.$method("repeat",function(t){for(var e=Array(t),i=0;i<t;++i)e[i]=this;return e.join("")}),String.prototype.$method("count",function(t){var e=new RegExp(t,"gm");return this.match(e).length}),String.prototype.$method("include",function(t){return-1!=this.indexOf(t)}),String.prototype.$method("each",function(){return Array.prototype.forEach.apply(this,arguments),this}),String.prototype.$method("toArray",function(){for(var t=[],e=0,i=this.length;e<i;++e)t.push(this[e]);return t}),String.prototype.$method("toObject",function(t,e){t=t||"&",e=e||"=";var i={};return this.split(t).each(function(t,n){var s=t.indexOf(e);if(s>0){var r=t.substring(0,s),o=t.substring(s+1),a=Number(o);isNaN(a)?"true"===o?o=!0:"false"===o&&(o=!1):o=a,i[r]=o}}),i});var t="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ");String.prototype.$method("toCRC32",function(){var e=0,i=0;e^=-1;for(var n=0,s=this.length;n<s;++n)i=255&(e^this.charCodeAt(n)),e=e>>>8^"0x"+t[i];return(-1^e)>>>0})}(),Array.prototype.accessor("first",{get:function(){return this[0]},set:function(t){this[0]=t}}),Array.prototype.accessor("last",{get:function(){return this[this.length-1]},set:function(t){this[this.length-1]=t}}),Array.prototype.$method("equals",function(t){if(this.length!==t.length)return!1;for(var e=0,i=this.length;e<i;++e)if(this[e]!==t[e])return!1;return!0}),Array.prototype.$method("deepEquals",function(t){if(this.length!==t.length)return!1;for(var e=0,i=this.length;e<i;++e)if(!1===(this[e].deepEquals?this[e].deepEquals(t[e]):this[e]===t[e]))return!1;return!0}),Array.prototype.$method("contains",function(t,e){return-1!=this.indexOf(t,e)}),Array.prototype.$method("at",function(t){return t%=this.length,t+=this.length,this[t%=this.length]}),Array.prototype.$method("find",function(t,e){var i=null;return this.some(function(n,s){if(t.call(e,n,s,this))return i=n,!0}),i}),Array.prototype.$method("findIndex",function(t,e){var i=null;return this.some(function(n,s){if(t.call(e,n,s,this))return i=s,!0}),i}),Array.prototype.$method("swap",function(t,e){var i=this[t];return this[t]=this[e],this[e]=i,this}),Array.prototype.$method("erase",function(t){var e=this.indexOf(t);return e>=0&&this.splice(e,1),this}),Array.prototype.$method("eraseAll",function(t){for(var e=0,i=this.length;e<i;++e)this[e]==t&&this.splice(e--,1);return this}),Array.prototype.$method("eraseIf",function(t){for(var e=0,i=this.length;e<i;++e)if(t(this[e],e,this)){this.splice(e,1);break}return this}),Array.prototype.$method("eraseIfAll",function(t){for(var e=0,i=this.length;e<i;++e)t(this[e],e,this)&&(this.splice(e--,1),i--);return this}),Array.prototype.$method("random",function(t,e){return t=t||0,e=e||this.length-1,this[Math.randint(t,e)]}),Array.prototype.$method("pickup",function(t,e){return t=t||0,e=e||this.length-1,this[Math.randint(t,e)]}),Array.prototype.$method("lot",function(t,e){return t=t||0,e=e||this.length-1,this[Math.randint(t,e)]}),Array.prototype.$method("uniq",function(t){return this.filter(function(t,e,i){return i.indexOf(t)===e})}),Array.prototype.$method("flatten",function(t){var e=null;if(t){e=this;for(var i=0;i<t;++i)e=Array.prototype.concat.apply([],e)}else e=this.reduce(function(t,e){return Array.isArray(e)?t.concat(e.flatten()):t.concat(e)},[]);return e}),Array.prototype.$method("clone",function(t){if(!0===t){for(var e=Array(this.length),i=0,n=this.length;i<n;++i)e[i]=this[i].clone?this[i].clone(t):this[i];return e}return Array.prototype.slice.apply(this)}),Array.prototype.$method("clear",function(){return this.length=0,this}),Array.prototype.$method("fill",function(t,e,i){e=e||0,i=i||this.length;for(var n=e;n<i;++n)this[n]=t;return this}),Array.prototype.$method("range",function(t,e,i){if(this.clear(),1==arguments.length)for(var n=0;n<t;++n)this[n]=n;else if(t<e){if((i=i||1)>0){n=t;for(var s=0;n<e;n+=i,++s)this[s]=n}}else if((i=i||-1)<0)for(n=t,s=0;n>e;n+=i,++s)this[s]=n;return this}),Array.prototype.$method("shuffle",function(){for(var t=0,e=this.length;t<e;++t){var i=Math.randint(0,e-1);t!=i&&this.swap(t,i)}return this}),Array.prototype.$method("sum",function(){for(var t=0,e=0,i=this.length;e<i;++e)t+=this[e];return t}),Array.prototype.$method("average",function(){for(var t=0,e=this.length,i=0;i<e;++i)t+=this[i];return t/e}),Array.prototype.$method("each",function(){return this.forEach.apply(this,arguments),this}),Array.prototype.$method("toULElement",function(){}),Array.prototype.$method("toOLElement",function(){}),Array.$method("range",function(t,e,i){return Array.prototype.range.apply([],arguments)}),Array.$method("of",function(){return Array.prototype.slice.call(arguments)}),Array.$method("from",function(t,e,i){if(!Object(t).length)return[];var n=[];if(Symbol&&Symbol.iterator&&t[Symbol.iterator]){for(var s=t[Symbol.iterator]();;){var r=s.next();if(r.done)break;var o="function"==typeof e?e.bind(i||this)(r.value):r.value;n.push(o)}return n}for(var a=0,h=t.length;a<h;a++)n.push(t[a]);return n.map("function"==typeof e?e:function(t){return t},i)}),Array.prototype.$method("most",function(t,e){if(this.length<1)return{max:-1/0,min:1/0};if(t){var i=-1/0,n=1/0,s=0,r=0;void 0===e&&(e=this);for(var o=0,a=this.length;o<a;++o){var h=t.call(e,this[o],o,this);i<h&&(i=h,s=o),n>h&&(n=h,r=o)}return{max:this[s],min:this[r]}}var u=-1/0,c=1/0;for(o=0,a=this.length;o<a;++o)u<this[o]&&(u=this[o]),c>this[o]&&(c=this[o]);return{max:u,min:c}}),function(){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.prototype.$method("format",function(i){var n=this.getFullYear(),s=this.getMonth(),r=this.getDate(),o=this.getDay(),a=this.getHours(),h=this.getMinutes(),u=this.getSeconds(),c=(this.getMilliseconds(),{yyyy:String(n).padding(4,"0"),yy:n.toString().substr(2,2),y:n,MMMM:t[s],MMM:t[s].substr(0,3),MM:String(s+1).padding(2,"0"),M:s+1,dd:String(r).padding(2,"0"),d:r,EEEE:e[o],EEE:e[o].substr(0,3),HH:String(a).padding(2,"0"),H:a,mm:String(h).padding(2,"0"),m:h,ss:String(u).padding(2,"0"),s:u}),l="("+Object.keys(c).join("|")+")",f=new RegExp(l,"g");return i.replace(f,function(t){return c[t]})}),Date.$method("calculateAge",function(t,e){"string"==typeof t&&(t=new Date(t)),e?"string"==typeof e&&(e=new Date(e)):e=new Date;var i=new Date(t.getTime()).setFullYear(256),n=new Date(e.getTime()).setFullYear(256)<i?1:0;return e.getFullYear()-t.getFullYear()-n})}(),Math.DEG_TO_RAD=Math.PI/180,Math.RAD_TO_DEG=180/Math.PI,Math.PHI=(1+Math.sqrt(5))/2,Math.degToRad=function(t){return t*Math.DEG_TO_RAD},Math.radToDeg=function(t){return t*Math.RAD_TO_DEG},Math.$method("clamp",function(t,e,i){return t<e?e:t>i?i:t}),Math.$method("inside",function(t,e,i){return t>=e&&t<=i}),Math.$method("randint",function(t,e){return Math.floor(Math.random()*(e-t+1))+t}),Math.$method("randfloat",function(t,e){return Math.random()*(e-t)+t}),Math.$method("randbool",function(t){return Math.randint(0,100)<(t||50)});var e=e||{};!function(){e.VERSION="0.2.3",e.$method("isNode",function(){return"undefined"!=typeof module}),e.$method("namespace",function(t){t.call(this)});var i=e.isNode()?t:window;e.accessor("global",{get:function(){return i}}),e.$method("testUA",function(t){if(!e.global.navigator)return!1;var i=e.global.navigator.userAgent;return t.test(i)}),e.$method("isAndroid",function(){return e.testUA(/Android/)}),e.$method("isIPhone",function(){return e.testUA(/iPhone/)}),e.$method("isIPad",function(){return e.testUA(/iPad/)}),e.$method("isIOS",function(){return e.testUA(/iPhone|iPad/)}),e.$method("isMobile",function(){return e.testUA(/iPhone|iPad|Android/)}),e.isNode()&&(module.exports=e),i.phina=e}(),e.namespace(function(){e.$method("createClass",function(t){var e=function(){var t=new e.prototype._creator;return e.prototype.init.apply(t,arguments),t};t.superClass&&(e.prototype=Object.create(t.superClass.prototype),t.init.owner=e,e.prototype.superInit=function(){this.__counter=this.__counter||0,this._hierarchies[this.__counter++].prototype.init.apply(this,arguments),this.__counter=0},e.prototype.superMethod=function(){var t=Array.prototype.slice.call(arguments,0),e=t.shift();this.__counters=this.__counters||{},this.__counters[e]=this.__counters[e]||0;var i=this._hierarchies[this.__counters[e]++].prototype[e].apply(this,t);return this.__counters[e]=0,i},e.prototype.constructor=e),e.prototype.$extend(t),e.prototype._hierarchies=[];for(var i=e.prototype.superClass;i;)e.prototype._hierarchies.push(i),i=i.prototype.superClass;return t._accessor&&t._accessor.forIn(function(t,i){e.prototype.accessor(t,i)}),e.prototype._creator=function(){return this},e.prototype._creator.prototype=e.prototype,t._static&&e.$extend(t._static),t._defined&&t._defined.call(e,e),e}),e.$method("using",function(t){if(!t)return e.global;var i=t.split(/[,.\/ ]|::/),n=e.global;return i.forEach(function(t){n=n[t]||(n[t]={})}),n}),e.$method("register",function(t,i){var n=t.split(/[,.\/ ]|::/).last,s=t.substring(0,t.lastIndexOf("."));return e.using(s)[n]=i,i});var t={};e.$method("define",function(i,n){if(n.superClass)if("string"==typeof n.superClass){var s=e.using(n.superClass);if("function"!=typeof s)return t[n.superClass]||(t[n.superClass]=[]),void t[n.superClass].push(function(){e.define(i,n)});n.superClass=s}else n.superClass=n.superClass;var r=e.createClass(n);return r.prototype.accessor("className",{get:function(){return i}}),e.register(i,r),t[i]&&(t[i].forEach(function(t){t()}),t[i]=null),r}),e.$method("globalize",function(){e.forIn(function(t,i){"object"==typeof i&&i.forIn(function(t,i){e.global[t]=i})})}),e._mainListeners=[],e._mainLoaded=!1,e.$method("main",function(t){e._mainLoaded?t():e._mainListeners.push(t)});var i=e.global.document;e.global.addEventListener&&i&&"complete"!==i.readyState?e.global.addEventListener("load",function(){var t=function(){var i=e._mainListeners.clone();e._mainListeners.clear(),i.each(function(t){t()}),e._mainListeners.length>0?t(0):e._mainLoaded=!0};setTimeout(t)}):e._mainLoaded=!0}),e.namespace(function(){e.define("phina.geom.Vector2",{x:0,y:0,init:function(t,e){this.x=t,this.y=e},clone:function(){return e.geom.Vector2(this.x,this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},set:function(t,e){return this.x=t,this.y=e,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},mul:function(t){return this.x*=t,this.y*=t,this},div:function(t){return t=t||.01,this.x/=t,this.y/=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},distance:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},distanceSquared:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},random:function(t,i,n){var s=e.util.Random.randfloat(t||0,i||360)*Math.DEG_TO_RAD;n=n||1;return this.x=Math.cos(s)*n,this.y=Math.sin(s)*n,this},normalize:function(){return this.div(this.length()),this},toString:function(){return"{x:{x}, y:{y}}".format(this)},getDirection:function(){var t=this.toDegree();return t<45?"right":t<135?"down":t<225?"left":t<315?"up":"right"},toAngle:function(){return(Math.atan2(this.y,this.x)+2*Math.PI)%(2*Math.PI)},fromAngle:function(t,e){return e=e||1,this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this},toDegree:function(){return this.toAngle().toDegree()},fromDegree:function(t,e){return this.fromAngle(t.toRadian(),e)},rotate:function(t,i){i=i||e.geom.Vector2(0,0);var n=this.x-i.x,s=this.y-i.y,r=n*Math.cos(t)-s*Math.sin(t),o=n*Math.sin(t)+s*Math.cos(t);return this.set(i.x+r,i.y+o),this},_accessor:{},_static:{min:function(t,i){return e.geom.Vector2(t.x<i.x?t.x:i.x,t.y<i.y?t.y:i.y)},max:function(t,i){return e.geom.Vector2(t.x>i.x?t.x:i.x,t.y>i.y?t.y:i.y)},add:function(t,i){return e.geom.Vector2(t.x+i.x,t.y+i.y)},sub:function(t,i){return e.geom.Vector2(t.x-i.x,t.y-i.y)},mul:function(t,i){return e.geom.Vector2(t.x*i,t.y*i)},div:function(t,i){return e.geom.Vector2(t.x/i,t.y/i)},negate:function(t){return e.geom.Vector2(-t.x,-t.y)},dot:function(t,e){return t.x*e.x+t.y*e.y},cross:function(t,e){return t.x*e.y-t.y*e.x},distance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},distanceSquared:function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)},manhattanDistance:function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},normal:function(t,i){var n=e.geom.Vector2.sub(t,i);return e.geom.Vector2(-n.y,n.x)},reflect:function(t,i){var n=e.geom.Vector2.dot(t,i),s=e.geom.Vector2.mul(i,2*n);return e.geom.Vector2.sub(t,s)},wall:function(t,i){var n=e.geom.Vector2.dot(t,i),s=e.geom.Vector2.mul(i,n);return e.geom.Vector2.sub(t,s)},lerp:function(t,i,n){return e.geom.Vector2(t.x+(i.x-t.x)*n,t.y+(i.y-t.y)*n)},slerp:function(t,e,i){},random:function(t,i,n){return e.geom.Vector2().random(t,i).mul(n||1)}}}),e.geom.Vector2.ZERO=e.geom.Vector2(0,0),e.geom.Vector2.LEFT=e.geom.Vector2(-1,0),e.geom.Vector2.RIGHT=e.geom.Vector2(1,0),e.geom.Vector2.UP=e.geom.Vector2(0,-1),e.geom.Vector2.DOWN=e.geom.Vector2(0,1)}),e.namespace(function(){e.define("phina.geom.Vector3",{x:0,y:0,z:0,init:function(t,e,i){this.x=t,this.y=e,this.z=i}})}),e.namespace(function(){e.define("phina.geom.Matrix33",{init:function(){arguments.length>=9?this.set.apply(this,arguments):this.identity()},set:function(t,e,i,n,s,r,o,a,h){return this.m00=t,this.m01=e,this.m02=i,this.m10=n,this.m11=s,this.m12=r,this.m20=o,this.m21=a,this.m22=h,this},identity:function(){return this.m00=1,this.m01=0,this.m02=0,this.m10=0,this.m11=1,this.m12=0,this.m20=0,this.m21=0,this.m22=1,this},clone:function(){return e.geom.Matrix33(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)},determinant:function(){var t=this.m00,e=this.m01,i=this.m02,n=this.m10,s=this.m11,r=this.m12,o=this.m20,a=this.m21,h=this.m22;return t*s*h+n*a*i+e*r*o-i*s*o-e*n*h-r*a*t},transpose:function(){var t=function(t,e){var i=this[t];this[t]=this[e],this[e]=i}.bind(this);return t("m01","m10"),t("m02","m20"),t("m12","m21"),this},invert:function(){var t=this.m00,e=this.m01,i=this.m02,n=this.m10,s=this.m11,r=this.m12,o=this.m20,a=this.m21,h=this.m22,u=this.determinant();return this.m00=(s*h-r*a)/u,this.m01=(n*h-r*o)/u*-1,this.m02=(n*a-s*o)/u,this.m10=(e*h-i*a)/u*-1,this.m11=(t*h-i*o)/u,this.m12=(t*a-e*o)/u*-1,this.m20=(e*r-i*s)/u,this.m21=(t*r-i*n)/u*-1,this.m22=(t*s-e*n)/u,this.transpose(),this},multiply:function(t){this.m,t.m;var e=this.m00,i=this.m01,n=this.m02,s=this.m10,r=this.m11,o=this.m12,a=this.m20,h=this.m21,u=this.m22,c=t.m00,l=t.m01,f=t.m02,d=t.m10,p=t.m11,g=t.m12,m=t.m20,y=t.m21,v=t.m22;return this.m00=e*c+i*d+n*m,this.m01=e*l+i*p+n*y,this.m02=e*f+i*g+n*v,this.m10=s*c+r*d+o*m,this.m11=s*l+r*p+o*y,this.m12=s*f+r*g+o*v,this.m20=a*c+h*d+u*m,this.m21=a*l+h*p+u*y,this.m22=a*f+h*g+u*v,this},multiplyVector2:function(t){var i=this.m00*t.x+this.m01*t.y+this.m02,n=this.m10*t.x+this.m11*t.y+this.m12;return e.geom.Vector2(i,n)},getRow:function(t){return 0===t?[this.m00,this.m01,this.m02]:1===t?[this.m10,this.m11,this.m12]:2===t?[this.m20,this.m21,this.m22]:null},getCol:function(t){return 0===t?[this.m00,this.m10,this.m20]:1===t?[this.m01,this.m11,this.m21]:2===t?[this.m02,this.m12,this.m22]:null},toString:function(){return"|{m00}, {m01}, {m02}|\n|{m10}, {m11}, {m12}|\n|{m20}, {m21}, {m22}|".format(this)}}),e.geom.Matrix33.IDENTITY=e.geom.Matrix33().identity()}),e.namespace(function(){e.define("phina.geom.Rect",{x:0,y:0,width:32,height:32,init:function(t,e,i,n){this.set(t,e,i,n)},set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},moveTo:function(t,e){return this.x=t,this.y=e,this},moveBy:function(t,e){return this.x+=t,this.y+=e,this},setSize:function(t,e){return this.width=t,this.height=e,this},padding:function(t,e,i,n){switch(arguments.length){case 1:t=e=i=n=arguments[0];break;case 2:t=i=arguments[0],e=n=arguments[1];break;case 3:t=arguments[0],e=n=arguments[1],i=arguments[2]}return this.x+=n,this.y+=t,this.width-=n+e,this.height-=t+i,this},contains:function(t,e){return this.left<=t&&t<=this.right&&this.top<=e&&e<=this.bottom},clone:function(){return e.geom.Rect(this.x,this.y,this.width,this.height)},toCircle:function(){var t=(this.width<this.height?this.width:this.height)/2;return e.geom.Circle(this.centerX,this.centerY,t)},toArray:function(){return[this.x,this.y,this.width,this.height]},_accessor:{left:{get:function(){return this.x},set:function(t){this.width-=t-this.x,this.x=t}},top:{get:function(){return this.y},set:function(t){this.height-=t-this.y,this.y=t}},right:{get:function(){return this.x+this.width},set:function(t){this.width+=t-this.right}},bottom:{get:function(){return this.y+this.height},set:function(t){this.height+=t-this.bottom}},centerX:{get:function(){return this.x+this.width/2},set:function(t){}},centerY:{get:function(){return this.y+this.height/2},set:function(t){}}}})}),e.namespace(function(){e.define("phina.geom.Circle",{x:0,y:0,radius:32,init:function(t,e,i){this.set(t,e,i)},set:function(t,e,i){return this.x=t,this.y=e,this.radius=i,this},moveTo:function(t,e){return this.x=t,this.y=e,this},moveBy:function(t,e){return this.x+=t,this.y+=e,this},contains:function(t,e){var i=this.x-t,n=this.y-e;return i*i+n*n<=this.radius*this.radius},clone:function(){return e.geom.Circle(this.x,this.y,this.radius)},toRect:function(){var t=this.size;return e.geom.Rect(this.x-this.radius,this.y-this.radius,t,t)},toArray:function(){return[this.x,this.y,this.radius]},_accessor:{left:{get:function(){return this.x-this.radius},set:function(t){}},top:{get:function(){return this.y-this.radius},set:function(t){}},right:{get:function(){return this.x+this.radius},set:function(t){}},bottom:{get:function(){return this.y+this.radius},set:function(t){}},size:{get:function(){return 2*this.radius},set:function(t){}}}})}),e.namespace(function(){e.define("phina.geom.Collision",{_static:{testCircleCircle:function(t,i){return e.geom.Vector2.distanceSquared(t,i)<=Math.pow(t.radius+i.radius,2)},testRectRect:function(t,e){return t.left<e.right&&t.right>e.left&&t.top<e.bottom&&t.bottom>e.top},testCircleRect:function(t,i){if(!1===e.geom.Rect(i.left-t.radius,i.top-t.radius,i.width+2*t.radius,i.height+2*t.radius).contains(t.x,t.y))return!1;var n=e.geom.Rect(i.left-t.radius,i.top,i.width+2*t.radius,i.height);if(n.contains(t.x,t.y))return!0;if(n.set(i.left,i.top-t.radius,i.width,i.height+2*t.radius),n.contains(t.x,t.y))return!0;var s=e.geom.Circle(t.x,t.y,t.radius);return!!s.contains(i.left,i.top)||(!!s.contains(i.right,i.top)||(!!s.contains(i.right,i.bottom)||!!s.contains(i.left,i.bottom)))},testCircleLine:function(t,i,n){if(t.contains(i.x,i.y)||t.contains(n.x,n.y))return!0;var s=t.radius*t.radius,r=e.geom.Vector2(t.x,t.y),o=e.geom.Vector2.sub(i,n),a=e.geom.Vector2.sub(i,r),h=e.geom.Vector2.sub(n,r),u=e.geom.Vector2.cross(o,a);if(u*u/o.lengthSquared()<=s&&e.geom.Vector2.dot(a,o)*e.geom.Vector2.dot(h,o)<=0)return!0;return!1},testLineLine:function(t,e,i,n){if(t.x==e.x&&t.x==i.x&&t.x==n.x){var s=Math.min(t.y,e.y),r=Math.max(t.y,e.y);return s<=i.y&&i.y<=r||s<=n.y&&n.y<=r}if(t.y==e.y&&t.y==i.y&&t.y==n.y){s=Math.min(t.x,e.x),r=Math.max(t.x,e.x);return s<=i.x&&i.x<=r||s<=n.x&&n.x<=r}var o=(t.x-e.x)*(i.y-t.y)+(t.y-e.y)*(t.x-i.x),a=(t.x-e.x)*(n.y-t.y)+(t.y-e.y)*(t.x-n.x),h=(i.x-n.x)*(t.y-i.y)+(i.y-n.y)*(i.x-t.x),u=(i.x-n.x)*(e.y-i.y)+(i.y-n.y)*(i.x-e.x);return o*a<=0&&h*u<=0},testRectLine:function(t,i,n){if(t.left<=i.x&&i.x<=t.right&&t.top<=i.y&&i.y<=t.bottom)return!0;var s=e.geom.Vector2(t.left,t.top),r=e.geom.Vector2(t.right,t.top),o=e.geom.Vector2(t.right,t.bottom),a=e.geom.Vector2(t.left,t.bottom);return!!e.geom.Collision.testLineLine(i,n,s,r)||(!!e.geom.Collision.testLineLine(i,n,r,o)||(!!e.geom.Collision.testLineLine(i,n,o,a)||!!e.geom.Collision.testLineLine(i,n,s,a)))}}})}),e.namespace(function(){e.define("phina.util.Support",{_static:{canvas:!!e.global.CanvasRenderingContext2D,webGL:!!e.global.CanvasRenderingContext2D&&!!document.createElement("canvas").getContext("webgl"),webAudio:!!e.global.AudioContext||!!e.global.webkitAudioContext||!!e.global.mozAudioContext}})}),e.namespace(function(){e.define("phina.util.EventDispatcher",{init:function(){this._listeners={}},on:function(t,e){return void 0===this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(e),this},off:function(t,e){var i=this._listeners[t],n=i.indexOf(e);return-1!=n&&i.splice(n,1),this},fire:function(t){t.target=this;var e="on"+t.type;this[e]&&this[e](t);var i=this._listeners[t.type];if(i)for(var n=i.clone(),s=0,r=n.length;s<r;++s)n[s].call(this,t);return this},flare:function(t,e){var i={type:t};return e&&e.forIn(function(t,e){i[t]=e}),this.fire(i),this},one:function(t,e){var i=this,n=function(){var s=e.apply(i,arguments);return i.off(t,n),s};return this.on(t,n),this},has:function(t){return void 0!==this._listeners[t]&&0!==this._listeners[t].length||!!this["on"+t]},clear:function(t){var e="on"+t;return this[e]&&delete this[e],this._listeners[t]=[],this}}),{addEventListener:"on",removeEventListener:"off",clearEventListener:"clear",hasEventListener:"has",dispatchEvent:"fire",dispatchEventByType:"flare"}.forIn(function(t,i){e.util.EventDispatcher.prototype.$method(t,e.util.EventDispatcher.prototype[i])})}),e.define("phina.util.Tween",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.time=0},fromTo:function(t,e,i,n,s){for(var r in this.target=t,this.beginProps=e,this.finishProps=i,this.duration=n||1e3,this.easing=s,this.changeProps={},e)this.changeProps[r]=i[r]-e[r];return this},to:function(t,e,i,n){var s={};for(var r in e)s[r]=t[r];return this.fromTo(t,s,e,i,n),this},from:function(t,e,i,n){var s={};for(var r in e)s[r]=t[r],t[r]=e[r];return this.fromTo(t,e,s,i,n),this},by:function(t,e,i,n){var s={},r={};for(var o in e)s[o]=t[o],r[o]=t[o]+e[o];return this.fromTo(t,s,r,i,n),this},yoyo:function(){var t=this.beginProps;return this.beginProps=this.finishProps,this.finishProps=t,this.changeProps.forIn(function(t,e,i){this.changeProps[t]=-e,this.target[t]=this.beginProps[t]},this),this},gain:function(t){this.seek(this.time+t)},forward:function(t){this.seek(this.time+t)},backward:function(t){this.seek(this.time-t)},seek:function(t){return this.time=Math.clamp(t,0,this.duration),this.beginProps.forIn(function(t,e){var i=this.easing(this.time,e,this.changeProps[t],this.duration);this.target[t]=i},this),this},_accessor:{easing:{get:function(){return this._easing},set:function(t){this._easing=e.util.Tween.EASING[t]||e.util.Tween.EASING.default}}},_static:{EASING:{default:function(t,e,i,n){return i*t/n+e},linear:function(t,e,i,n){return i*t/n+e},swing:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeOutInCubic:function(t,i,n,s){return t<s/2?e.util.Tween.EASING.easeOutCubic(2*t,i,n/2,s):e.util.Tween.EASING.easeInCubic(2*t-s,i+n/2,n/2,s)},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeOutInQuart:function(t,i,n,s){return t<s/2?e.util.Tween.EASING.easeOutQuart(2*t,i,n/2,s):e.util.Tween.EASING.easeInQuart(2*t-s,i+n/2,n/2,s)},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeOutInQuint:function(t,i,n,s){return t<s/2?e.util.Tween.EASING.easeOutQuint(2*t,i,n/2,s):e.util.Tween.EASING.easeInQuint(2*t-s,i+n/2,n/2,s)},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeOutInSine:function(t,i,n,s){return t<s/2?e.util.Tween.EASING.easeOutSine(2*t,i,n/2,s):e.util.Tween.EASING.easeInSine(2*t-s,i+n/2,n/2,s)},easeInExpo:function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},easeOutExpo:function(t,e,i,n){return t==n?e+i:1.001*i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e-5e-4*i:i/2*1.0005*(2-Math.pow(2,-10*--t))+e},easeOutInExpo:function(t,i,n,s){return t<s/2?e.util.Tween.EASING.easeOutExpo(2*t,i,n/2,s):e.util.Tween.EASING.easeInExpo(2*t-s,i+n/2,n/2,s)},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeOutInCirc:function(t,i,n,s){return t<s/2?e.util.Tween.EASING.easeOutCirc(2*t,i,n/2,s):e.util.Tween.EASING.easeInCirc(2*t-s,i+n/2,n/2,s)},easeInElastic:function(t,e,i,n,s,r){var o;return 0==t?e:1==(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,o=r/4):o=r/(2*Math.PI)*Math.asin(i/s),-s*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/r)+e)},easeOutElastic:function(t,e,i,n,s,r){var o;return 0==t?e:1==(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,o=r/4):o=r/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin((t*n-o)*(2*Math.PI)/r)+i+e)},easeInOutElastic:function(t,e,i,n,s,r){var o;return 0==t?e:2==(t/=n/2)?e+i:(r||(r=n*(.3*1.5)),!s||s<Math.abs(i)?(s=i,o=r/4):o=r/(2*Math.PI)*Math.asin(i/s),t<1?s*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/r)*-.5+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/r)*.5+i+e)},easeOutInElastic:function(t,i,n,s,r,o){return t<s/2?e.util.Tween.EASING.easeOutElastic(2*t,i,n/2,s,r,o):e.util.Tween.EASING.easeInElastic(2*t-s,i+n/2,n/2,s,r,o)},easeInBack:function(t,e,i,n,s){return null==s&&(s=1.70158),i*(t/=n)*t*((s+1)*t-s)+e},easeOutBack:function(t,e,i,n,s){return null==s&&(s=1.70158),i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},easeInOutBack:function(t,e,i,n,s){return null==s&&(s=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(s*=1.525))*t-s))+e:i/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+e},easeOutInBack:function(t,i,n,s,r){return t<s/2?e.util.Tween.EASING.easeOutBack(2*t,i,n/2,s,r):e.util.Tween.EASING.easeInBack(2*t-s,i+n/2,n/2,s,r)},easeInBounce:function(t,i,n,s){return n-e.util.Tween.EASING.easeOutBounce(s-t,0,n,s)+i},easeOutBounce:function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,i,n,s){return t<s/2?.5*e.util.Tween.EASING.easeInBounce(2*t,0,n,s)+i:.5*e.util.Tween.EASING.easeOutBounce(2*t-s,0,n,s)+.5*n+i},easeOutInBounce:function(t,i,n,s){return t<s/2?e.util.Tween.EASING.easeOutBounce(2*t,i,n/2,s):e.util.Tween.EASING.easeInBounce(2*t-s,i+n/2,n/2,s)}}}}),e.define("phina.util.Ticker",{superClass:"phina.util.EventDispatcher",frame:null,deltaTime:null,elapsedTime:null,init:function(){this.superInit(),this.fps=30,this.frame=0,this.deltaTime=0,this.elapsedTime=0,this.isPlaying=!0,this.runner=e.util.Ticker.runner},tick:function(t){this.on("tick",t)},untick:function(t){this.off("tick",t)},run:function(){var t=(new Date).getTime();this.deltaTime=t-this.currentTime,this.elapsedTime=t-this.startTime;var e=this.currentTime=t;this.flare("tick");var i=(new Date).getTime();this.frame+=1;var n=i-e;return Math.max(this.frameTime-n,0)},start:function(){var t=this;this.isPlaying=!0,this.startTime=this.currentTime=(new Date).getTime();var e=function(){if(t.isPlaying){var i=t.run();t.runner(e,i)}};return e(),this},resume:function(){},stop:function(){return this.isPlaying=!1,this},rewind:function(){},_accessor:{fps:{get:function(){return this._fps},set:function(t){this._fps=t,this.frameTime=1e3/this._fps}}},_static:{runner:function(t,e){setTimeout(t,e)}}}),e.define("phina.util.Grid",{width:640,columns:12,loop:!1,offset:0,init:function(){if("object"==typeof arguments[0])var t=arguments[0],e=t.width||640,i=t.columns||12,n=t.loop||!1,s=t.offset||0;else e=arguments[0]||640,i=arguments[1]||12,n=arguments[2]||!1,s=arguments[3]||0;this.width=e,this.columns=i,this.loop=n,this.offset=s,this.unitWidth=this.width/this.columns},span:function(t){return this.loop&&(t+=this.columns,t%=this.columns),this.unitWidth*t+this.offset},unit:function(){return this.unitWidth},center:function(t){var e=t||0;return this.width/2+this.unitWidth*e}}),e.namespace(function(){e.define("phina.util.ChangeDispatcher",{superClass:"phina.util.EventDispatcher",init:function(){this.superInit(),this._observe=!0},register:function(t,e){if(1===arguments.length){arguments[0].forIn(function(t,e){this.register(t,e)},this)}else{var i="__"+t;this[i]=e,this.accessor(t,{get:function(){return this[i]},set:function(t){this[i]=t,this._observe&&this.flare("change")}})}return this},observe:function(){this._observe=!0},unobserve:function(){this._observe=!1}})}),e.define("phina.util.Flow",{superClass:"phina.util.EventDispatcher",init:function(t,e){if(this.superInit(),this.status="pending",this.resultValue=null,this._queue=[],this.func=t,!0!==e){var i=this;this.func(function(){i.resolve.apply(i,arguments),i.status="resolved"},function(){i.reject.apply(i,arguments),i.status="rejected"})}},resolve:function(t){this.resultValue=t,this._queue.each(function(t){t(this.resultValue)},this),this._queue.clear()},reject:function(){},then:function(t){if("resolved"===this.status){var i=t(this.resultValue);return e.util.Flow.resolve(i)}var n=e.util.Flow(function(t){t()},!0);return this._queue.push(function(i){var s=t(i);s instanceof e.util.Flow?s.then(function(t){n.resolve(t)}):n.resolve(i)}),n},_static:{resolve:function(t){return t instanceof e.util.Flow?t:e.util.Flow(function(e){e(t)})},all:function(t){return e.util.Flow(function(e){var i=0,n=[];t.each(function(s){s.then(function(s){++i,n.push(s),i>=t.length&&e(n)})})})}}}),e.namespace(function(){e.define("phina.util.Color",{r:255,g:255,b:255,a:1,init:function(t,e,i,n){this.set.apply(this,arguments)},set:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=void 0!==n?n:1,this},setFromNumber:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=void 0!==n?n:1,this},setFromArray:function(t){return this.set.apply(this,t)},setFromObject:function(t){return this.set(t.r,t.g,t.b,t.a)},setFromString:function(t){var i=e.util.Color.stringToNumber(t);return this.set(i[0],i[1],i[2],i[3])},setSmart:function(){var t=arguments[0];return arguments.length>=3?this.set(arguments.r,arguments.g,arguments.b,arguments.a):t instanceof Array?this.setFromArray(t):t instanceof Object?this.setFromObject(t):"string"==typeof t&&this.setFromString(t),this},toStyleAsHex:function(){return"#{0}{1}{2}".format(this.r.toString(16).padding(2,"0"),this.g.toString(16).padding(2,"0"),this.b.toString(16).padding(2,"0"))},toStyleAsRGB:function(){return"rgb({r},{g},{b})".format({r:~~this.r,g:~~this.g,b:~~this.b})},toStyleAsRGBA:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})},toStyle:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})},_static:{COLOR_LIST:{black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255]},strToNum:function(t){return this.stringToNumber(t)},stringToNumber:function(i){var n=null,s=null;if("#"===i[0]?s=4==i.length?"hex111":"hex222":"r"===i[0]&&"g"===i[1]&&"b"===i[2]?s="a"==i[3]?"rgba":"rgb":"h"===i[0]&&"s"===i[1]&&"l"===i[2]&&(s="a"==i[3]?"hsla":"hsl"),s){var r=t[s],o=i.match(r.reg);n=r.exec(o)}else e.util.Color.COLOR_LIST[i]&&(n=e.util.Color.COLOR_LIST[i]);return n},HSLtoRGB:function(t,e,i){var n,s,r;if(t%=360,t+=360,t%=360,i*=.01,0===(e*=.01))return[i=Math.round(255*i),i,i];var o=i<.5?i*(1+e):i+e-i*e,a=2*i-o,h=(t+120)%360;return n=h<60?a+(o-a)*h/60:h<180?o:a,s=(h=t)<60?a+(o-a)*h/60:h<180?o:h<240?a+(o-a)*(240-h)/60:a,r=(h=(t-120+360)%360)<60?a+(o-a)*h/60:h<180?o:h<240?a+(o-a)*(240-h)/60:a,[parseInt(255*n),parseInt(255*s),parseInt(255*r)]},HSLAtoRGBA:function(t,i,n,s){var r=e.util.Color.HSLtoRGB(t,i,n);return r[3]=s,r},createStyleRGB:function(t,e,i){return"rgba("+t+","+e+","+i+")"},createStyleRGBA:function(t,e,i,n){return"rgba("+t+","+e+","+i+","+n+")"},createStyleHSL:function(t,e,i){return"hsl("+t+","+e+"%,"+i+"%)"},createStyleHSLA:function(t,e,i,n){return"hsla("+t+","+e+"%,"+i+"%,"+n+")"}}});var t={hex111:{reg:/^#(\w{1})(\w{1})(\w{1})$/,exec:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},hex222:{reg:/^#(\w{2})(\w{2})(\w{2})$/,exec:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},rgb:{reg:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,exec:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},rgba:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseFloat(t[4])]}},hsl:{reg:/^hsl\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/,exec:function(t){return e.util.Color.HSLtoRGB(t[1],t[2],t[3])}},hsla:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(t){return e.util.Color.HSLAtoRGBA(t[1],t[2],t[3],t[4])}}}}),e.namespace(function(){e.define("phina.util.Random",{seed:1,init:function(t){this.seed=t||Date.now()||1},random:function(){var t=this.seed;return t^=t<<13,t^=t>>>17,t^=t<<5,this.seed=t,(t>>>0)/e.util.Random.MAX},randint:function(t,e){return Math.floor(this.random()*(e-t+1))+t},randfloat:function(t,e){return this.random()*(e-t)+t},randbool:function(){return 1===this.randint(0,1)},randarray:function(t,e,i){return e=e||0,i=i||100,(t=t||100).map(function(){return this.randint(e,i)},this)},_accessor:{seed:{get:function(){return this._seed},set:function(t){this._seed=t>>>0||1}}},_static:{MAX:4294967295,seed:Date.now(),getSeed:function(){return this.seed},setSeed:function(t){return this.seed=t>>>0||1,this},random:function(){return this.seed=this.xor32(this.seed),(this.seed>>>0)/e.util.Random.MAX},randint:function(t,i){return e.global.Math.floor(this.random()*(i-t+1))+t},randfloat:function(t,e){return this.random()*(e-t)+t},randbool:function(){return 1===this.randint(0,1)},randarray:function(t,e,i){return e=e||0,i=i||100,(t=t||100).map(function(){return this.randint(e,i)},this)},xor32:function(t){return t^=t<<13,t^=t>>>17,t^=t<<5},uuid:function(){var t=(new Date).getTime();return e.global.performance&&"function"==typeof e.global.performance.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)})}}}),Math.$method("randint",function(t,i){return e.util.Random.randint(t,i)}),Math.$method("randfloat",function(t,i){return e.util.Random.randfloat(t,i)})}),e.namespace(function(){e.define("phina.util.QueryString",{_static:{parse:function(t,e,i,n){t=t||location.search.substr(1),e=e||"&",i=i||"=";var s=n?decodeURIComponent:function(t){return t};return t.split(e).reduce(function(t,e){var n=e.split(i);return t[n[0]]=s(n[1]),t},{})},stringify:function(t,e,i,n){e=e||"&",i=i||"=";var s=n?encodeURIComponent:function(t){return t};return Object.keys(t).map(function(e){return e+i+s(t[e])}).join(e)}}})}),e.namespace(function(){e.define("phina.util.Ajax",{_static:{defaults:{type:"GET",contentType:"application/x-www-form-urlencoded",responseType:"json",data:null,url:""},request:function(t){var i={}.$safe(t,this.defaults),n=new XMLHttpRequest;return e.util.Flow(function(t){n.onreadystatechange=function(){4===n.readyState&&-1!==[200,201,0].indexOf(n.status)&&t(n.response)},n.open(i.type,i.url),n.responseType=i.responseType,n.send(null)})},get:function(t){return this.request({type:"GET",url:t})},post:function(t){return this.request({type:"POST",url:t})},put:function(t){return this.request({type:"PUT",url:t})},del:function(t){return this.request({type:"DELETE",url:t})}}})}),e.namespace(function(){e.define("phina.asset.Asset",{superClass:"phina.util.EventDispatcher",serverError:!1,notFound:!1,loadError:!1,init:function(t){this.superInit(),this.loaded=!1},load:function(t){return this.src=t,e.util.Flow(this._load.bind(this))},isLoaded:function(){return this.loaded},_load:function(t){var e=this;setTimeout(function(){e.loaded=!0,t()},100)},loadDummy:function(){}})}),e.namespace(function(){e.define("phina.asset.AssetManager",{_static:{assets:{image:{},sound:{},spritesheet:{}},get:function(t,e){return this.assets[t]&&this.assets[t][e]},set:function(t,e,i){this.assets[t]||(this.assets[t]={}),this.assets[t][e]=i},contains:function(t,e){}}})}),e.namespace(function(){e.define("phina.asset.AssetLoader",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),t=(t||{}).$safe({cache:!0}),this.assets={},this.cache=t.cache},load:function(t){var i=this,n=[],s=0,r=0;return t.forIn(function(t,e){r+=Object.keys(e).length}),t.forIn(function(t,o){o.forIn(function(o,a){var h=(0,e.asset.AssetLoader.assetLoadFunctions[t])(o,a);h.then(function(n){i.cache&&e.asset.AssetManager.set(t,o,n),i.flare("progress",{key:o,asset:n,progress:++s/r})}),n.push(h)})}),i.cache&&i.on("progress",function(i){i.progress>=1&&t.forIn(function(t,i){i.forIn(function(i,n){var s=e.asset.AssetManager.get(t,i);if(s.loadError){var r=e.asset.AssetManager.get(t,"dummy");r?(r.loadError&&(r.loadDummy(),r.loadError=!1),e.asset.AssetManager.set(t,i,r)):s.loadDummy()}})})}),e.util.Flow.all(n).then(function(t){i.flare("load")})},_static:{assetLoadFunctions:{image:function(t,i){return e.asset.Texture().load(i)},sound:function(t,i){return e.asset.Sound().load(i)},spritesheet:function(t,i){return e.asset.SpriteSheet().load(i)},script:function(t,i){return e.asset.Script().load(i)},font:function(t,i){var n=e.asset.Font();return n.setFontName(t),n.load(i)},json:function(t,i){return e.asset.File().load({path:i,dataType:"json"})},xml:function(t,i){return e.asset.File().load({path:i,dataType:"xml"})},text:function(t,i){return e.asset.File().load(i)}},register:function(t,e){return this.assetLoadFunctions[t]=e,this}}})}),e.namespace(function(){e.define("phina.asset.File",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){var e={};"string"==typeof this.src?e.$extend({path:this.src}):"object"==typeof this.src&&e.$extend(this.src),e.$safe({path:"",dataType:"text"});var i=this,n=new XMLHttpRequest;n.open("GET",e.path),n.onreadystatechange=function(){if(4===n.readyState&&-1!==[200,201,0].indexOf(n.status)){var s=n.responseText;"json"===e.dataType?s=JSON.parse(s):"xml"===e.dataType&&(s=(new DOMParser).parseFromString(s,"text/xml")),i.dataType=e.dataType,i.data=s,t(i)}},n.send(null)}})}),e.namespace(function(){e.define("phina.asset.Script",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){var e=this;this.domElement=document.createElement("script"),this.domElement.src=this.src,this.domElement.onload=function(){t(e)}.bind(this),document.body.appendChild(this.domElement)}})}),e.namespace(function(){e.define("phina.asset.Texture",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){this.domElement=new Image,!("file:"==location.protocol)&&/^data:/.test(this.src);var e=this;this.domElement.onload=function(i){e.loaded=!0,t(e)},this.domElement.onerror=function(t){console.error("[phina.js] not found `{0}`!".format(this.src));var i=e.src.split("/").last.replace(".png","").split("?").first.split("#").first;t.target.onerror=null,t.target.src="http://dummyimage.com/128x128/444444/eeeeee&text="+i},this.domElement.src=this.src},clone:function(){var t=this.domElement,i=e.graphics.Canvas().setSize(t.width,t.height),n=e.asset.Texture();return i.context.drawImage(t,0,0),n.domElement=i.domElement,n},transmit:function(t){var i=this.domElement,n=e.graphics.Canvas().setSize(i.width,i.height);n.context.drawImage(i,0,0);var s=n.context.getImageData(0,0,n.width,n.height),r=s.data,o=void 0!==t?t.r:r[0],a=void 0!==t?t.g:r[1],h=void 0!==t?t.b:r[2];3..step(r.length,4,function(t){r[t-3]===o&&r[t-2]===a&&r[t-1]===h&&(r[t]=0)}),n.context.putImageData(s,0,0),this.domElement=n.domElement},filter:function(t){if(!t)return this;Array.isArray(t)||(t=[t]);var i=this.domElement,n=i.width,s=i.height,r=e.graphics.Canvas().setSize(n,s),o=null;return r.context.drawImage(i,0,0),o=r.context.getImageData(0,0,n,s),t.forEach(function(t){"function"==typeof t&&s.times(function(e){n.times(function(i){var s=4*(e*n+i),r=o.data.slice(s,s+4);t(r,s,i,e,o)})})}),r.context.putImageData(o,0,0),this.domElement=r.domElement,this}})}),e.namespace(function(){e.define("phina.asset.Sound",{superClass:"phina.asset.Asset",_loop:!1,_loopStart:0,_loopEnd:0,_playbackRate:1,init:function(){this.superInit(),this.context=e.asset.Sound.getAudioContext(),this.gainNode=this.context.createGain()},play:function(t,i,n){t=t?t+this.context.currentTime:0,i=i||0,this.source;var s=this.source=this.context.createBufferSource();s.buffer=this.buffer;return s.loop=this._loop,s.loopStart=this._loopStart,s.loopEnd=this._loopEnd,s.playbackRate.value=this._playbackRate,s.connect(this.gainNode),this.gainNode.connect(e.asset.Sound.getMasterGain()),void 0!==n?s.start(t,i,n):s.start(t,i),s.addEventListener("ended",function(){this.flare("ended")}.bind(this)),this},stop:function(){return this.source&&(this.source.stop&&this.source.stop(0),this.source=null,this.flare("stop")),this},pause:function(){return this.source.playbackRate.value=0,this.flare("pause"),this},resume:function(){return this.source.playbackRate.value=this._playbackRate,this.flare("resume"),this},_oscillator:function(t){var e=this.context,i=e.createOscillator();i.type=t||"sine",this.source=i,this.source.connect(e.destination)},loadFromBuffer:function(t){var e=this.context;if(!t)for(var i=(t=e.createBuffer(1,44100,44100)).getChannelData(0),n=0;n<i.length;n++)i[n]=Math.sin(n/100*Math.PI);this.buffer=t},setLoop:function(t){return this.loop=t,this},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},setPlaybackRate:function(t){return this.playbackRate=t,this},_load:function(t){/^data:/.test(this.src)?this._loadFromURIScheme(t):this._loadFromFile(t)},_loadFromFile:function(t){var e=this,i=new XMLHttpRequest;i.open("GET",this.src),i.onreadystatechange=function(){if(4===i.readyState)if(-1!==[200,201,0].indexOf(i.status)){var n=i.response;e.context.decodeAudioData(n,function(i){e.loadFromBuffer(i),t(e)},function(){console.warn("("+e.src+")"),t(e),e.flare("decodeerror")})}else 404===i.status?(e.loadError=!0,e.notFound=!0,t(e),e.flare("loaderror"),e.flare("notfound")):(e.loadError=!0,e.serverError=!0,t(e),e.flare("loaderror"),e.flare("servererror"))},i.responseType="arraybuffer",i.send(null)},_loadFromURIScheme:function(t){var e="";e=this.src.split(",")[0].indexOf("base64")>=0?atob(this.src.split(",")[1]):unescape(this.src.split(",")[1]);for(var i=this,n=e.length,s=new Uint8Array(n),r=0;r<n;++r)s[r]=e.charCodeAt(r);this.context.decodeAudioData(s.buffer,function(e){i.loadFromBuffer(e),t(i)},function(){console.warn("("+i.src+")"),i.loaded=!0,t(i)})},loadDummy:function(){this.loadFromBuffer()},_accessor:{volume:{get:function(){return this.gainNode.gain.value},set:function(t){this.gainNode.gain.value=t}},loop:{get:function(){return this._loop},set:function(t){this._loop=t,this.source&&(this.source._loop=t)}},loopStart:{get:function(){return this._loopStart},set:function(t){this._loopStart=t,this.source&&(this.source._loopStart=t)}},loopEnd:{get:function(){return this._loopEnd},set:function(t){this._loopEnd=t,this.source&&(this.source._loopEnd=t)}},playbackRate:{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this.source&&0!==this.source.playbackRate.value&&(this.source.playbackRate.value=t)}}},_defined:function(){this.accessor("volume",{get:function(){return this.getMasterGain().gain.value},set:function(t){this.getMasterGain().gain.value=t}})},_static:{getMasterGain:function(){if(!this._masterGain){var t=this.getAudioContext();this._masterGain=t.createGain(),this._masterGain.connect(t.destination)}return this._masterGain},getAudioContext:function(){if(!e.util.Support.webAudio)return null;if(this.context)return this.context;var t=e.global,i=null;return t.AudioContext?i=new AudioContext:t.webkitAudioContext?i=new webkitAudioContext:t.mozAudioContext&&(i=new mozAudioContext),this.context=i,i}}})}),e.namespace(function(){e.define("phina.asset.SoundManager",{_static:{volume:.8,musicVolume:.8,muteFlag:!1,currentMusic:null,play:function(t,i,n,s){var r=e.asset.AssetManager.get("sound",t);return r.volume=this.getVolume(),r.play(i,n,s),r},stop:function(){},pause:function(){},fade:function(){},setVolume:function(t){this.volume=t},getVolume:function(){return this.volume},mute:function(){return this.muteFlag=!0,this.currentMusic&&(this.currentMusic.volume=0),this},unmute:function(){return this.muteFlag=!1,this.currentMusic&&(this.currentMusic.volume=this.getVolumeMusic()),this},isMute:function(){return this.muteFlag},playMusic:function(t,i,n,s,r,o){n=void 0===n||n,this.currentMusic&&this.stopMusic(i);var a=e.asset.AssetManager.get("sound",t);if(a.setLoop(n),a.play(s,r,o),i>0){var h=0,u=i/32,c=this.getVolumeMusic();a.volume=0;var l=setInterval(function(){var t=(h+=1)/32;return a.volume=t*c,!(t>=1)||(clearInterval(l),!1)},u)}else a.volume=this.getVolumeMusic();return this.currentMusic=a,this.currentMusic},stopMusic:function(t){if(this.currentMusic){var e=this.currentMusic;if(this.currentMusic=null,t>0){var i=0,n=t/32,s=this.getVolumeMusic();e.volume=0;var r=setInterval(function(){var t=(i+=1)/32;return e.volume=s*(1-t),!(t>=1)||(e.stop(),clearInterval(r),!1)},n)}else e.stop()}},pauseMusic:function(){this.currentMusic&&this.currentMusic.pause()},resumeMusic:function(){this.currentMusic&&this.currentMusic.resume()},setVolumeMusic:function(t){return this.musicVolume=t,this.currentMusic&&(this.currentMusic.volume=t),this},getVolumeMusic:function(){return this.musicVolume}}})}),e.namespace(function(){e.define("phina.asset.SpriteSheet",{superClass:"phina.asset.Asset",init:function(){this.superInit()},setup:function(t){return this._setupFrame(t.frame),this._setupAnim(t.animations),this},_load:function(t){var e=this;if("string"==typeof this.src){var i=new XMLHttpRequest;i.open("GET",this.src),i.onreadystatechange=function(){if(4===i.readyState&&-1!==[200,201,0].indexOf(i.status)){var n=i.responseText,s=JSON.parse(n);e.setup(s),t(e)}},i.send(null)}else this.setup(this.src),t(e)},_setupFrame:function(t){var e=this.frames=[],i=t.width,n=t.height,s=t.rows*t.cols;this.frame=s,s.times(function(s){var r=s%t.cols,o=s/t.cols|0;e.push({x:r*i,y:o*n,width:i,height:n})})},_setupAnim:function(t){this.animations={},this.animations.default={frames:[].range(0,this.frame),next:"default",frequency:1},t.forIn(function(t,e){var i=e;i instanceof Array?this.animations[t]={frames:[].range(i[0],i[1]),next:i[2],frequency:i[3]||1}:this.animations[t]={frames:i.frames,next:i.next,frequency:i.frequency||1}},this)},getFrame:function(t){return this.frames[t]},getAnimation:function(t){return t=void 0!==t?t:"default",this.animations[t]}})}),e.namespace(function(){e.define("phina.asset.Font",{superClass:"phina.asset.Asset",init:function(){this.superInit(),this.fontName=null},load:function(t){this.src=t;var i=/(.*)(?:\.([^.]+$))/,n=this.fontName||t.match(i)[1].split("/").last,s="unknown";switch(t.match(i)[2]){case"ttf":s="truetype";break;case"otf":s="opentype";break;case"woff":s="woff";break;case"woff2":s="woff2";break;default:console.warn("("+t+")")}if(this.format=s,this.fontName=n,"unknown"!==s){var r="@font-face { font-family: '{0}'; src: url({1}) format('{2}'); }".format(n,t,s),o=document.querySelector("head"),a=document.createElement("style");a.innerText?a.innerText=r:a.textContent=r,o.appendChild(a)}return e.util.Flow(this._load.bind(this))},_load:function(t){"unknown"!==this.format?this._checkLoaded(this.fontName,function(){this.loaded=!0,t(this)}.bind(this)):(this.loaded=!0,t(this))},_checkLoaded:function(t,i){var n=e.graphics.Canvas(),s=n.context.font.split(" ")[1];n.context.font="40px "+s;var r="1234567890-^\\qwertyuiop@[asdfghjkl;:]zxcvbnm,./!\"#$%&'()=~|QWERTYUIOP`{ASDFGHJKL+*}ZXCVBNM<>?_";r+=String.fromCharCode("0xf04b");var o=n.context.measureText(r).width;n.context.font="40px "+t+", "+s;var a=30,h=function(){n.context.measureText(r).width!==o?setTimeout(function(){i&&i()},100):--a>0?setTimeout(h,100):(i&&i(),console.warn("timeout font loading"))};h()},setFontName:function(t){return this.loaded?(console.warn("Load("+t+")"),this):(this.fontName=t,this)},getFontName:function(){return this.fontName}})}),e.define("phina.input.Input",{superClass:"phina.util.EventDispatcher",domElement:null,init:function(t){this.superInit(),this.domElement=t||window.document,this.position=e.geom.Vector2(0,0),this.startPosition=e.geom.Vector2(0,0),this.deltaPosition=e.geom.Vector2(0,0),this.prevPosition=e.geom.Vector2(0,0),this._tempPosition=e.geom.Vector2(0,0),this.maxCacheNum=e.input.Input.defaults.maxCacheNum,this.minDistance=e.input.Input.defaults.minDistance,this.maxDistance=e.input.Input.defaults.maxDistance,this.cachePositions=[],this.flickVelocity=e.geom.Vector2(0,0),this.flags=0},update:function(){this.last=this.now,this.now=this.flags,this.start=(this.now^this.last)&this.now,this.end=(this.now^this.last)&this.last,this.deltaPosition.x=this._tempPosition.x-this.position.x,this.deltaPosition.y=this._tempPosition.y-this.position.y,0===this.deltaPosition.x&&0===this.deltaPosition.y?this._moveFlag=!1:this._moveFlag=!0,this.start&&this.startPosition.set(this.position.x,this.position.y),this.prevPosition.set(this.position.x,this.position.y),this.position.set(this._tempPosition.x,this._tempPosition.y),this.cachePositions.length>this.maxCacheNum&&this.cachePositions.shift(),this.cachePositions.push(this.position.clone())},_start:function(t,e,i){i=void 0!==i?i:1,this._move(t,e),this.flags|=i,t=this._tempPosition.x,e=this._tempPosition.y,this.position.set(t,e),this.prevPosition.set(t,e),this.flickVelocity.set(0,0),this.cachePositions.clear()},_end:function(t){if(t=void 0!==t?t:1,this.flags&=~t,!(this.cachePositions.length<2)){var i=this.cachePositions.first,n=this.cachePositions.last,s=e.geom.Vector2.sub(n,i),r=s.length();if(r>this.minDistance){var o=r.clamp(this.minDistance,this.maxDistance);s.div(r).mul(o),this.flickVelocity.set(s.x,s.y)}this.cachePositions.clear()}},_move:function(t,e){this._tempPosition.x=t,this._tempPosition.y=e;var i=this.domElement,n=i.getBoundingClientRect();n.width&&(this._tempPosition.x*=i.width/n.width),n.height&&(this._tempPosition.y*=i.height/n.height)},_accessor:{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},dx:{get:function(){return this.deltaPosition.x},set:function(t){this.deltaPosition.x=t}},dy:{get:function(){return this.deltaPosition.y},set:function(t){this.deltaPosition.y=t}},fx:{get:function(){return this.flickVelocity.x},set:function(t){this.flickVelocity.x=t}},fy:{get:function(){return this.flickVelocity.y},set:function(t){this.flickVelocity.y=t}}},_static:{defaults:{maxCacheNum:3,minDistance:10,maxDistance:100}}}),function(){e.define("phina.input.Mouse",{superClass:"phina.input.Input",init:function(t){this.superInit(t),this.id=0;var e=this;this.domElement.addEventListener("mousedown",function(t){e._start(t.pointX,t.pointY,1<<t.button)}),this.domElement.addEventListener("mouseup",function(t){e._end(1<<t.button)}),this.domElement.addEventListener("mousemove",function(t){e._move(t.pointX,t.pointY)}),this.domElement.addEventListener("mouseout",function(t){e._end(1)})},getButton:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.now&e)},getButtonDown:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.start&e)},getButtonUp:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.end&e)},_static:{BUTTON_LEFT:1,BUTTON_MIDDLE:2,BUTTON_RIGHT:4}});var t={left:e.input.Mouse.BUTTON_LEFT,middle:e.input.Mouse.BUTTON_MIDDLE,right:e.input.Mouse.BUTTON_RIGHT};e.input.Mouse.prototype.getPointing=function(){return this.getButton("left")},e.input.Mouse.prototype.getPointingStart=function(){return this.getButtonDown("left")},e.input.Mouse.prototype.getPointingEnd=function(){return this.getButtonUp("left")}}(),e.define("phina.input.Touch",{superClass:"phina.input.Input",init:function(t,e){if(this.superInit(t),this.id=null,!0!==e){var i=this;this.domElement.addEventListener("touchstart",function(t){i._start(t.pointX,t.pointY,!0)}),this.domElement.addEventListener("touchend",function(t){i._end()}),this.domElement.addEventListener("touchmove",function(t){i._move(t.pointX,t.pointY)})}},getTouch:function(){return 0!=this.now},getTouchStart:function(){return 0!=this.start},getTouchEnd:function(){return 0!=this.end}}),e.input.Touch.prototype.getPointing=e.input.Touch.prototype.getTouch,e.input.Touch.prototype.getPointingStart=e.input.Touch.prototype.getTouchStart,e.input.Touch.prototype.getPointingEnd=e.input.Touch.prototype.getTouchEnd,e.define("phina.input.TouchList",{domElement:null,touchMap:null,touches:null,_id:null,init:function(t){this.domElement=t,this.touches=[];var e=this.touchMap={};this._id=new Uint32Array(1);var i=this,n=Array.prototype.forEach;this.domElement.addEventListener("touchstart",function(t){n.call(t.changedTouches,function(t){var n=i.getEmpty();e[t.identifier]=n,n._start(t.pointX,t.pointY)})}),this.domElement.addEventListener("touchend",function(t){n.call(t.changedTouches,function(t){var i=t.identifier;e[i]._end(),delete e[i]})}),this.domElement.addEventListener("touchmove",function(t){n.call(t.changedTouches,function(t){e[t.identifier]._move(t.pointX,t.pointY)}),t.stop()}),this.domElement.addEventListener("touchcancel",function(t){console.warn(""),n.call(t.changedTouches,function(t){var i=t.identifier;e[i]._end(),delete e[i]}),t.stop()})},getEmpty:function(){var t=e.input.Touch(this.domElement,!0);return t.id=this.id,this.touches.push(t),t},getTouch:function(t){return this.touchMap[t]},removeTouch:function(t){var e=this.touches.indexOf(t);this.touches.splice(e,1)},update:function(){this.touches.forEach(function(t){t.released?(t.released=!1,this.removeTouch(t)):(t.update(),0===t.flags&&(t.released=!0))},this)},_accessor:{id:{get:function(){return this._id[0]++}}}}),e.namespace(function(){e.define("phina.input.Keyboard",{superClass:"phina.input.Input",init:function(t){this.superInit(t),this.key={},this.press={},this.down={},this.up={},this.last={},this._keydown=null,this._keyup=null,this._keypress=null;var e=this;this.domElement.addEventListener("keydown",function(t){e.key[t.keyCode]=!0,e._keydown=t.keyCode}),this.domElement.addEventListener("keyup",function(t){e.key[t.keyCode]=!1,e._keyup=t.keyCode}),this.domElement.addEventListener("keypress",function(t){e._keypress=t.keyCode})},update:function(){for(var t in this.key)this.last[t]=this.press[t],this.press[t]=this.key[t],this.down[t]=(this.press[t]^this.last[t])&this.press[t],this.up[t]=(this.press[t]^this.last[t])&this.last[t];return this._keydown&&(this.flare("keydown",{keyCode:this._keydown}),this._keydown=null),this._keyup&&(this.flare("keyup",{keyCode:this._keyup}),this._keyup=null),this._keypress&&(this.flare("keypress",{keyCode:this._keypress}),this._keypress=null),this},getKey:function(t){return"string"==typeof t&&(t=e.input.Keyboard.KEY_CODE[t]),!0==!!this.press[t]},getKeyDown:function(t){return"string"==typeof t&&(t=e.input.Keyboard.KEY_CODE[t]),1==this.down[t]},getKeyUp:function(t){return"string"==typeof t&&(t=e.input.Keyboard.KEY_CODE[t]),1==this.up[t]},getKeyAngle:function(){var t=null,i=this.getKey("left")<<3|this.getKey("up")<<2|this.getKey("right")<<1|this.getKey("down");return 0!==i&&e.input.Keyboard.ARROW_BIT_TO_ANGLE_TABLE.hasOwnProperty(i)&&(t=e.input.Keyboard.ARROW_BIT_TO_ANGLE_TABLE[i]),t},getKeyDirection:function(){var t=e.geom.Vector2(0,0);return this.getKey("left")?t.x=-1:this.getKey("right")&&(t.x=1),this.getKey("up")?t.y=-1:this.getKey("down")&&(t.y=1),t.x&&t.y&&t.div(Math.SQRT2),t},setKey:function(t,i){return"string"==typeof t&&(t=e.input.Keyboard.KEY_CODE[t]),this.key[t]=i,this},clearKey:function(){return this.key={},this},_static:{ARROW_BIT_TO_ANGLE_TABLE:{1:270,2:0,4:90,8:180,6:45,3:315,12:135,9:225,14:90,13:180,11:270,7:0},KEY_CODE:{backspace:8,tab:9,enter:13,return:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,q:81,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,"forward slash":191,"/":191,"grave accent":192,"open bracket":219,"back slash":220,"close bracket":221,"single quote":222,space:32}}})}),e.namespace(function(){var t;e.define("phina.input.GamepadManager",{superClass:"phina.util.EventDispatcher",gamepads:null,_created:null,_rawgamepads:null,init:function(){this.superInit(),this.gamepads={},this._created=[],this._rawgamepads=[],this._prevTimestamps={},this._getGamepads=null;var t=e.global.navigator;t&&t.getGamepads?this._getGamepads=t.getGamepads.bind(t):t&&t.webkitGetGamepads?this._getGamepads=t.webkitGetGamepads.bind(t):this._getGamepads=function(){},e.global.addEventListener("gamepadconnected",function(t){var e=this.get(t.gamepad.index);e.connected=!0,this.flare("connected",{gamepad:e})}.bind(this)),e.global.addEventListener("gamepaddisconnected",function(t){var e=this.get(t.gamepad.index);e.connected=!1,this.flare("disconnected",{gamepad:e})}.bind(this))},update:function(){this._poll();for(var t=0,e=this._created.length;t<e;t++){var i=this._created[t],n=this._rawgamepads[i];n&&(n.timestamp&&n.timestamp===this._prevTimestamps[t]?this.gamepads[i]._updateStateEmpty():(this._prevTimestamps[t]=n.timestamp,this.gamepads[i]._updateState(n)))}},get:function(t){return t=t||0,this.gamepads[t]||(this._created.push(t),this.gamepads[t]=e.input.Gamepad(t)),this.gamepads[t]},dispose:function(t){if(this._created.contains(t)){var e=this.get(t);delete this.gamepad[e],this._created.erase(t),e.connected=!1}},isConnected:function(t){return t=t||0,this._rawgamepads[t]&&this._rawgamepads[t].connected},_poll:function(){var t=this._getGamepads();if(t){this._rawgamepads.clear();for(var e=0,i=t.length;e<i;e++)t[e]&&this._rawgamepads.push(t[e])}},_static:{isAvailable:(t=e.global.navigator,!(!t||!t.getGamepads&&!t.webkitGetGamepads))}}),e.define("phina.input.Gamepad",{index:null,buttons:null,sticks:null,id:null,connected:!1,mapping:null,timestamp:null,init:function(t){this.index=t||0,this.buttons=Array.range(0,16).map(function(){return{value:0,pressed:!1,last:!1,down:!1,up:!1}}),this.sticks=Array.range(0,2).map(function(){return e.geom.Vector2(0,0)})},getKey:function(t){return"string"==typeof t&&(t=e.input.Gamepad.BUTTON_CODE[t]),!!this.buttons[t]&&this.buttons[t].pressed},getKeyDown:function(t){return"string"==typeof t&&(t=e.input.Gamepad.BUTTON_CODE[t]),!!this.buttons[t]&&this.buttons[t].down},getKeyUp:function(t){return"string"==typeof t&&(t=e.input.Gamepad.BUTTON_CODE[t]),!!this.buttons[t]&&this.buttons[t].up},getKeyAngle:function(){var t=null,e=this.getKey("left")<<3|this.getKey("up")<<2|this.getKey("right")<<1|this.getKey("down");return 0!==e&&i.hasOwnProperty(e)&&(t=i[e]),t},getKeyDirection:function(){var t=e.geom.Vector2(0,0);return this.getKey("left")?t.x=-1:this.getKey("right")&&(t.x=1),this.getKey("up")?t.y=-1:this.getKey("down")&&(t.y=1),t.x&&t.y&&t.div(Math.SQRT2),t},getStickAngle:function(t){t=t||0;var e=this.sticks[t];return e?Math.atan2(-e.y,e.x):null},getStickDirection:function(t){return t=t||0,this.sticks?this.sticks[t].clone():e.geom.Vector2(0,0)},_updateState:function(t){this.id=t.id,this.connected=t.connected,this.mapping=t.mapping,this.timestamp=t.timestamp;for(var e=0,i=t.buttons.length;e<i;e++)this._updateButton(t.buttons[e],e);for(var n=0,s=t.axes.length;n<s;n+=2)this._updateStick(t.axes[n+0],n/2,"x"),this._updateStick(t.axes[n+1],n/2,"y")},_updateStateEmpty:function(){for(var t=0,e=this.buttons.length;t<e;t++)this.buttons[t].down=!1,this.buttons[t].up=!1},_updateButton:function(t,i){void 0===this.buttons[i]&&(this.buttons[i]={value:0,pressed:!1,last:!1,down:!1,up:!1});var n=this.buttons[i];n.last=n.pressed,"object"==typeof t?(n.value=t.value,n.pressed=t.pressed):(n.value=t,n.pressed=t>e.input.Gamepad.ANALOGUE_BUTTON_THRESHOLD),n.down=(n.pressed^n.last)&n.pressed,n.up=(n.pressed^n.last)&n.last},_updateStick:function(t,i,n){void 0===this.sticks[i]&&(this.sticks[i]=e.geom.Vector2(0,0)),this.sticks[i][n]=t},_static:{isAvailable:function(){var t=e.global.navigator;return!!t&&(!!t.getGamepads||!!t.webkitGetGamepads)}(),ANALOGUE_BUTTON_THRESHOLD:.5,BUTTON_CODE:{a:0,b:1,x:2,y:3,l1:4,r1:5,l2:6,r2:7,select:8,start:9,l3:10,r3:11,up:12,down:13,left:14,right:15,special:16,A:0,B:1,X:2,Y:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,START:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,SPECIAL:16}}});var i={0:null,1:270,2:0,4:90,8:180,6:45,3:315,12:135,9:225,14:90,13:180,11:270,7:0}}),e.namespace(function(){e.define("phina.input.Accelerometer",{init:function(){var t=this;this.gravity=e.geom.Vector3(0,0,0),this.acceleration=e.geom.Vector3(0,0,0),this.rotation=e.geom.Vector3(0,0,0),this.orientation=e.geom.Vector3(0,0,0),e.isMobile()&&(e.global.addEventListener("devicemotion",function(e){var i=t.acceleration,n=t.gravity,s=t.rotation;e.acceleration&&(i.x=e.acceleration.x,i.y=e.acceleration.y,i.z=e.acceleration.z),e.accelerationIncludingGravity&&(n.x=e.accelerationIncludingGravity.x,n.y=e.accelerationIncludingGravity.y,n.z=e.accelerationIncludingGravity.z),e.rotationRate&&(s.x=s.beta=e.rotationRate.beta,s.y=s.gamma=e.rotationRate.gamma,s.z=s.alpha=e.rotationRate.alpha)}),e.global.addEventListener("deviceorientation",function(e){var i=t.orientation;i.alpha=e.alpha,i.beta=e.beta,i.gamma=e.gamma}))}})}),e.namespace(function(){e.define("phina.app.Updater",{init:function(t){this.app=t},update:function(t){this._updateElement(t)},_updateElement:function(t){var e=this.app;if(!1!==t.awake){t.has("enterframe")&&t.flare("enterframe",{app:this.app}),t.update&&t.update(e);var i=t.children.length;if(t.children.length>0)for(var n=t.children.slice(),s=0;s<i;++s)this._updateElement(n[s])}},_checkPoint:function(t){this.app.pointers.forEach(function(e){null!==e.id&&this.__checkPoint(t,e)},this)},__checkPoint:function(t,e){if(t.interactive){var i=t._overFlags[e.id],n=t.hitTest2(e.x,e.y);t._overFlags[e.id]=n,!i&&n&&t.flare("pointover",{pointer:e}),i&&!n&&t.flare("pointout"),n&&e.getPointingStart()&&(t._touchFlags[e.id]=!0,t.flare("pointstart")),t._touchFlags[e.id]&&(t.flare("pointstay"),e._moveFlag&&t.flare("pointmove")),!0===t._touchFlags[e.id]&&e.getPointingEnd()&&(t._touchFlags[e.id]=!1,t.flare("pointend"),t._overFlags[e.id]&&(t._overFlags[e.id]=!1,t.flare("pointout")))}}})}),e.namespace(function(){e.define("phina.app.Interactive",{init:function(t){this.app=t,this._enable=!0,this.multiTouch=!0,this.cursor={normal:"",hover:"pointer"},this._holds=[],this.app.on("changescene",function(){this._holds.clear()}.bind(this))},enable:function(){return this._enable=!0,this},disable:function(){return this._enable=!1,this},check:function(t){this.app.domElement&&(this._holds.length>0?this.app.domElement.style.cursor=this.cursor.hover:this.app.domElement.style.cursor=this.cursor.normal),this._enable&&this.app.pointers&&this._checkElement(t)},_checkElement:function(t){this.app;if(!1!==t.awake){var e=t.children.length;if(t.children.length>0)for(var i=t.children.slice(),n=0;n<e;++n)this._checkElement(i[n]);this._checkPoint(t)}},_checkPoint:function(t){this.multiTouch?this.app.pointers.forEach(function(e){null!==e.id&&this.__checkPoint(t,e)},this):this.__checkPoint(t,this.app.pointer)},__checkPoint:function(t,i){if(t.interactive){var n=t._overFlags[i.id],s=t.hitTest(i.x,i.y);t._overFlags[i.id]=s;var r={pointer:i,interactive:this,over:s};!n&&s&&(t.flare("pointover",r),t.boundingType&&"none"!==t.boundingType&&this._holds.push(t)),n&&!s&&(t.flare("pointout",r),this._holds.erase(t)),s&&i.getPointingStart()&&(t._touchFlags[i.id]=!0,t.flare("pointstart",r),t._clicked=!0),t._touchFlags[i.id]&&(t.flare("pointstay",r),i._moveFlag&&t.flare("pointmove",r)),!0===t._touchFlags[i.id]&&i.getPointingEnd()&&(t._touchFlags[i.id]=!1,t.flare("pointend",r),e.isMobile()&&t._overFlags[i.id]&&(t._overFlags[i.id]=!1,t.flare("pointout",r),this._holds.erase(t)))}}})}),e.namespace(function(){e.define("phina.app.BaseApp",{superClass:"phina.util.EventDispatcher",awake:null,fps:null,frame:null,init:function(){this.superInit(),this._scenes=[e.app.Scene()],this._sceneIndex=0,this.updater=e.app.Updater(this),this.interactive=e.app.Interactive(this),this.awake=!0,this.ticker=e.util.Ticker()},run:function(){var t=this;return this._loopCaller=function(){t._loop()},this.ticker.tick(this._loopCaller),this.ticker.start(),this},kill:function(){return this.ticker.stop(),this.ticker.untick(this._loopCaller),this},replaceScene:function(t){this.flare("replace"),this.flare("changescene");return this.currentScene&&(this.currentScene.app=null),this.currentScene=t,this.currentScene.app=this,this.currentScene.flare("enter",{app:this}),this},pushScene:function(t){return this.flare("push"),this.flare("changescene"),this.currentScene.flare("pause",{app:this}),this._scenes.push(t),++this._sceneIndex,this.flare("pushed"),t.app=this,t.flare("enter",{app:this}),this},popScene:function(){this.flare("pop"),this.flare("changescene");var t=this._scenes.pop();return--this._sceneIndex,t.flare("exit",{app:this}),t.app=null,this.flare("poped"),this.currentScene.flare("resume",{app:this,prevScene:t}),t},start:function(){return this.awake=!0,this},stop:function(){return this.awake=!1,this},enableStats:function(){if(e.global.Stats)this.stats=new Stats,document.body.appendChild(this.stats.domElement);else{var t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r14/Stats.js",document.body.appendChild(t),t.onload=function(){this.enableStats()}.bind(this)}return this},enableDatGUI:function(t){if(e.global.dat){var i=new e.global.dat.GUI;t(i)}else{var n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5.1/dat.gui.js",document.body.appendChild(n),n.onload=function(){var i=new e.global.dat.GUI;t(i)}.bind(this)}return this},_loop:function(){this._update(),this.interactive.check(this.currentScene),this._draw(),this.stats&&this.stats.update()},_update:function(){this.awake&&(this.has("enterframe")&&this.flare("enterframe"),this.update&&this.update(),this.updater.update(this.currentScene))},_draw:function(){},_accessor:{currentScene:{get:function(){return this._scenes[this._sceneIndex]},set:function(t){this._scenes[this._sceneIndex]=t}},rootScene:{get:function(){return this._scenes[0]},set:function(t){this._scenes[0]=t}},frame:{get:function(){return this.ticker.frame},set:function(t){this.ticker.frame=t}},fps:{get:function(){return this.ticker.fps},set:function(t){this.ticker.fps=t}},deltaTime:{get:function(){return this.ticker.deltaTime}},elapsedTime:{get:function(){return this.ticker.elapsedTime}},currentTime:{get:function(){return this.ticker.currentTime}},startTime:{get:function(){return this.ticker.startTime}}}})}),e.namespace(function(){e.define("phina.app.Element",{superClass:"phina.util.EventDispatcher",parent:null,children:null,awake:!0,init:function(){this.superInit(),this.children=[]},addChild:function(t){return t.parent&&t.remove(),t.parent=this,this.children.push(t),t.has("added")&&t.flare("added"),t},addChildTo:function(t){return t.addChild(this),this},addChildAt:function(t,e){return t.parent&&t.remove(),t.parent=this,this.children.splice(e,0,t),t.has("added")&&t.flare("added"),t},getChildAt:function(t){return this.children.at(t)},getChildByName:function(t){},getChildIndex:function(t){return this.children.indexOf(t)},getParent:function(){return this.parent},getRoot:function(){var t=this;for(t=this.parent;null!=t.parent;t=t.parent);return t},removeChild:function(t){var e=this.children.indexOf(t);return-1!==e&&(this.children.splice(e,1),t.has("removed")&&t.flare("removed")),this},remove:function(){if(this.parent)return this.parent.removeChild(this),this.parent=null,this},isAwake:function(){return this.awake},wakeUp:function(){return this.awake=!0,this},sleep:function(){return this.awake=!1,this},fromJSON:function(t){var i=function(t,i){var n=i.arguments;n=n instanceof Array?n:[n];var s=e.using(i.className).apply(null,n);s.name=t,this[t]=s,s.fromJSON(i),s.addChildTo(this)}.bind(this);return t.forIn(function(t,e){"children"===t?e.forIn(function(t,e){i(t,e)}):"type"!==t&&"className"!==t&&(this[t]=e)},this),this},toJSON:function(){var t=Object.keys(e.using(this.className).defaults||{});this._hierarchies.forEach(function(e){var i=e.defaults;i&&Object.keys(i).forEach(function(e){-1===t.indexOf(e)&&t.push(e)})}),t.push("name","className");var i={};t.each(function(t){i[t]=this[t]},this);var n=this.children.map(function(t){return t.toJSON()});return n.length&&(i.children={},n.each(function(t,e){i.children[t.name||t.className+"_"+e]=t})),i}})}),e.namespace(function(){e.define("phina.app.Object2D",{superClass:"phina.app.Element",position:null,rotation:0,scale:null,origin:null,init:function(t){this.superInit(),t={}.$safe(t,e.app.Object2D.defaults),this.position=e.geom.Vector2(t.x,t.y),this.scale=e.geom.Vector2(t.scaleX,t.scaleY),this.rotation=t.rotation,this.origin=e.geom.Vector2(t.originX,t.originY),this._matrix=e.geom.Matrix33().identity(),this._worldMatrix=e.geom.Matrix33().identity(),this.interactive=!1,this._overFlags={},this._touchFlags={},this.width=t.width,this.height=t.height,this.radius=t.radius,this.boundingType=t.boundingType},hitTest:function(t,e){return"rect"===this.boundingType?this.hitTestRect(t,e):"circle"!==this.boundingType||this.hitTestCircle(t,e)},hitTestRect:function(t,i){var n=this.globalToLocal(e.geom.Vector2(t,i)),s=-this.width*this.originX,r=+this.width*(1-this.originX),o=-this.height*this.originY,a=+this.height*(1-this.originY);return s<n.x&&n.x<r&&o<n.y&&n.y<a},hitTestCircle:function(t,i){var n=this.globalToLocal(e.geom.Vector2(t,i));return n.x*n.x+n.y*n.y<this.radius*this.radius},hitTestElement:function(t){var e=t;return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},globalToLocal:function(t){var e=this._worldMatrix.clone();return e.invert(),e.multiplyVector2(t)},setInteractive:function(t,e){return this.interactive=t,e&&(this.boundingType=e),this},setX:function(t){return this.position.x=t,this},setY:function(t){return this.position.y=t,this},setPosition:function(t,e){return this.position.x=t,this.position.y=e,this},setRotation:function(t){return this.rotation=t,this},setScale:function(t,e){return this.scale.x=t,arguments.length<=1?this.scale.y=t:this.scale.y=e,this},setOrigin:function(t,e){return this.origin.x=t,this.origin.y=e,this},setWidth:function(t){return this.width=t,this},setHeight:function(t){return this.height=t,this},setSize:function(t,e){return this.width=t,this.height=e,this},setBoundingType:function(t){return this.boundingType=t,this},moveTo:function(t,e){return this.position.x=t,this.position.y=e,this},moveBy:function(t,e){return this.position.x+=t,this.position.y+=e,this},_calcWorldMatrix:function(){if(this.parent){if(this.rotation!=this._cachedRotation){this._cachedRotation=this.rotation;var t=this.rotation*(Math.PI/180);this._sr=Math.sin(t),this._cr=Math.cos(t)}var i=this._matrix,n=this.parent._worldMatrix||e.geom.Matrix33.IDENTITY,s=this._worldMatrix;i.m00=this._cr*this.scale.x,i.m01=-this._sr*this.scale.y,i.m10=this._sr*this.scale.x,i.m11=this._cr*this.scale.y,i.m02=this.position.x,i.m12=this.position.y;var r=i.m00,o=i.m01,a=i.m02,h=i.m10,u=i.m11,c=i.m12,l=n.m00,f=n.m01,d=n.m02,p=n.m10,g=n.m11,m=n.m12;return s.m00=l*r+f*h,s.m01=l*o+f*u,s.m02=l*a+f*c+d,s.m10=p*r+g*h,s.m11=p*o+g*u,s.m12=p*a+g*c+m,this}},_accessor:{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},originX:{get:function(){return this.origin.x},set:function(t){this.origin.x=t}},originY:{get:function(){return this.origin.y},set:function(t){this.origin.y=t}},scaleX:{get:function(){return this.scale.x},set:function(t){this.scale.x=t}},scaleY:{get:function(){return this.scale.y},set:function(t){this.scale.y=t}},width:{get:function(){return"rect"===this.boundingType?this._width:this._diameter},set:function(t){this._width=t}},height:{get:function(){return"rect"===this.boundingType?this._height:this._diameter},set:function(t){this._height=t}},radius:{get:function(){return"rect"===this.boundingType?(this.width+this.height)/4:this._radius},set:function(t){this._radius=t,this._diameter=2*t}},top:{get:function(){return this.y-this.height*this.originY},set:function(t){this.y=t+this.height*this.originY}},right:{get:function(){return this.x+this.width*(1-this.originX)},set:function(t){this.x=t-this.width*(1-this.originX)}},bottom:{get:function(){return this.y+this.height*(1-this.originY)},set:function(t){this.y=t-this.height*(1-this.originY)}},left:{get:function(){return this.x-this.width*this.originX},set:function(t){this.x=t+this.width*this.originX}},centerX:{get:function(){return this.x+this.width/2-this.width*this.originX},set:function(t){}},centerY:{get:function(){return this.y+this.height/2-this.height*this.originY},set:function(t){}}},_static:{defaults:{x:0,y:0,scaleX:1,scaleY:1,rotation:0,originX:.5,originY:.5,width:64,height:64,radius:32,boundingType:"rect"}}})}),e.namespace(function(){e.define("phina.app.Scene",{superClass:"phina.app.Element",init:function(){this.superInit()},exit:function(t,e){if(this.app)return arguments.length>0&&("object"==typeof arguments[0]&&(t=arguments[0].nextLabel||this.nextLabel,e=arguments[0]),this.nextLabel=t,this.nextArguments=e),this.app.popScene(),this}})}),e.namespace(function(){e.define("phina.accessory.Accessory",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.target=t},setTarget:function(t){if(this.target!==t)return this.target=t,this},getTarget:function(){return this.target},isAttached:function(){return!!this.target},attachTo:function(t){return t.attach(this),this.setTarget(t),this},remove:function(){this.target.detach(this),this.target=null}}),e.app.Element.prototype.$method("attach",function(t){return this.accessories||(this.accessories=[],this.on("enterframe",function(t){this.accessories.each(function(e){e.update&&e.update(t.app)})})),this.accessories.push(t),t.setTarget(this),t.flare("attached"),this}),e.app.Element.prototype.$method("detach",function(t){return this.accessories&&(this.accessories.erase(t),t.setTarget(null),t.flare("detached")),this})}),e.namespace(function(){var t=e.define("phina.accessory.Tweener",{superClass:"phina.accessory.Accessory",updateType:"delta",init:function(t){this.superInit(t),this._init()},_init:function(){this._loop=!1,this._tasks=[],this._index=0,this.playing=!0,this._update=this._updateTask},update:function(t){this._update(t)},setUpdateType:function(t){return this.updateType=t,this},to:function(t,e,i){return this._add({type:"tween",mode:"to",props:t,duration:e,easing:i}),this},by:function(t,e,i){return this._add({type:"tween",mode:"by",props:t,duration:e,easing:i}),this},from:function(t,e,i){return this._add({type:"tween",mode:"from",props:t,duration:e,easing:i}),this},wait:function(t){return this._add({type:"wait",data:{limit:t}}),this},call:function(t,e,i){return this._add({type:"call",data:{func:t,self:e||this,args:i}}),this},set:function(t,e){var i=null;return 2==arguments.length?(i={})[t]=e:i=t,this._tasks.push({type:"set",data:{values:i}}),this},moveTo:function(t,e,i,n){return this.to({x:t,y:e},i,n)},moveBy:function(t,e,i,n){return this.by({x:t,y:e},i,n)},rotateTo:function(t,e,i){return this.to({rotation:t},e,i)},rotateBy:function(t,e,i){return this.by({rotation:t},e,i)},scaleTo:function(t,e,i){return this.to({scaleX:t,scaleY:t},e,i)},scaleBy:function(t,e,i){return this.by({scaleX:t,scaleY:t},e,i)},fade:function(t,e,i){return this.to({alpha:t},e,i)},fadeOut:function(t,e){return this.fade(0,t,e)},fadeIn:function(t,e){return this.fade(1,t,e)},play:function(){return this.playing=!0,this},pause:function(){return this.playing=!1,this},stop:function(){return this.playing=!1,this.rewind(),this},rewind:function(){return this._update=this._updateTask,this._index=0,this},yoyo:function(){return this._update=this._updateTask,this._index=0,this._tasks.each(function(t){t.type}),this.play(),this},setLoop:function(t){return this._loop=t,this},clear:function(){return this._init(),this},fromJSON:function(t){return void 0!==t.loop&&this.setLoop(t.loop),t.tweens.each(function(t){this[(t=t.clone()).shift()].apply(this,t)},this),this},_add:function(t){this._tasks.push(t)},_updateTask:function(t){if(this.playing){var i=this._tasks[this._index];if(i)if(++this._index,"tween"===i.type){this._tween=e.util.Tween();var n=i.duration||this._getDefaultDuration();"to"===i.mode?this._tween.to(this.target,i.props,n,i.easing):"by"===i.mode?this._tween.by(this.target,i.props,n,i.easing):this._tween.from(this.target,i.props,n,i.easing),this._update=this._updateTween,this._update(t)}else"wait"===i.type?(this._wait={time:0,limit:i.data.limit},this._update=this._updateWait,this._update(t)):"call"===i.type?(i.data.func.apply(i.data.self,i.data.args),this._update(t)):"set"===i.type&&(this.target.$extend(i.data.values),this._update(t));else this._loop?(this.rewind(),this._update(t)):this.playing=!1}},_updateTween:function(t){var e=this._tween,i=this._getUnitTime(t);e.forward(i),this.flare("tween"),e.time>=e.duration&&(delete this._tween,this._tween=null,this._update=this._updateTask)},_updateWait:function(t){var e=this._wait,i=this._getUnitTime(t);e.time+=i,e.time>=e.limit&&(delete this._wait,this._wait=null,this._update=this._updateTask)},_getUnitTime:function(e){var i=t[this.updateType];return i?i.func(e):1e3/e.fps},_getDefaultDuration:function(){var e=t[this.updateType];return e&&e.duration},_static:{UPDATE_MAP:{normal:{func:function(t){return 1e3/t.fps},duration:1e3},delta:{func:function(t){return t.ticker.deltaTime},duration:1e3},fps:{func:function(t){return 1},duration:30}}}}).UPDATE_MAP;e.app.Element.prototype.getter("tweener",function(){return this._tweener||(this._tweener=e.accessory.Tweener().attachTo(this)),this._tweener})}),e.namespace(function(){e.define("phina.accessory.Draggable",{superClass:"phina.accessory.Accessory",init:function(t){this.superInit(t),this.initialPosition=e.geom.Vector2(0,0);var i=this;this.on("attached",function(){this.target.setInteractive(!0),this._dragging=!1,this.target.on("pointstart",function(t){e.accessory.Draggable._lock||(this._dragging=!0,i.initialPosition.x=this.x,i.initialPosition.y=this.y,i.flare("dragstart"),this.flare("dragstart"))}),this.target.on("pointmove",function(t){this._dragging&&(this.x+=t.pointer.dx,this.y+=t.pointer.dy,i.flare("drag"),this.flare("drag"))}),this.target.on("pointend",function(t){this._dragging&&(this._dragging=!1,i.flare("dragend"),this.flare("dragend"))})})},back:function(t,i){if(t){var n=this.target;n.setInteractive(!1);var s=e.accessory.Tweener().attachTo(n);s.to({x:this.initialPosition.x,y:this.initialPosition.y},t,i||"easeOutElastic").call(function(){s.remove(),n.setInteractive(!0),this.flare("backend")},this)}else this.target.x=this.initialPosition.x,this.target.y=this.initialPosition.y,this.flare("backend")},enable:function(){this._enable=!0},_static:{_lock:!1,lock:function(){this._lock=!0},unlock:function(){this._lock=!1}}}),e.app.Element.prototype.getter("draggable",function(){return this._draggable||(this._draggable=e.accessory.Draggable().attachTo(this)),this._draggable})}),e.namespace(function(){e.define("phina.accessory.Flickable",{superClass:"phina.accessory.Accessory",init:function(t){this.superInit(t),this.initialPosition=e.geom.Vector2(0,0);var i=this;this.friction=.9,this.velocity=e.geom.Vector2(0,0),this.vertical=!0,this.horizontal=!0,this.cacheList=[],this.on("attached",function(){this.target.setInteractive(!0),this.target.on("pointstart",function(t){i.initialPosition.set(this.x,this.y),i.velocity.set(0,0)}),this.target.on("pointstay",function(t){i.horizontal&&(this.x+=t.pointer.dx),i.vertical&&(this.y+=t.pointer.dy),i.cacheList.length>3&&i.cacheList.shift(),i.cacheList.push(t.pointer.deltaPosition.clone())}),this.target.on("pointend",function(t){var e=i.cacheList.reverse().find(function(t){return t.lengthSquared()>10});i.cacheList.clear(),e?(i.velocity.x=e.x,i.velocity.y=e.y,i.flare("flickstart",{direction:e.normalize()})):i.flare("flickcancel")})})},update:function(){this.target&&(this.velocity.x*=this.friction,this.velocity.y*=this.friction,this.horizontal&&(this.target.position.x+=this.velocity.x),this.vertical&&(this.target.position.y+=this.velocity.y))},cancel:function(){this.target.x=this.initialPosition.x,this.target.y=this.initialPosition.y,this.velocity.set(0,0)},enable:function(){this._enable=!0}}),e.app.Element.prototype.getter("flickable",function(){return this._flickable||(this._flickable=e.accessory.Flickable().attachTo(this)),this._flickable})}),e.namespace(function(){e.define("phina.accessory.FrameAnimation",{superClass:"phina.accessory.Accessory",init:function(t){this.superInit(),this.ss=e.asset.AssetManager.get("spritesheet",t),this.paused=!0,this.finished=!1,this.fit=!0},update:function(){if(!this.paused&&this.currentAnimation){if(this.finished)return this.finished=!1,void(this.currentFrameIndex=0);++this.frame,this.frame%this.currentAnimation.frequency==0&&(++this.currentFrameIndex,this._updateFrame())}},gotoAndPlay:function(t,e){return(e=void 0===e||e)&&t===this.currentAnimationName&&this.currentFrameIndex<this.currentAnimation.frames.length&&!this.paused?this:(this.currentAnimationName=t,this.frame=0,this.currentFrameIndex=0,this.currentAnimation=this.ss.getAnimation(t),this._updateFrame(),this.paused=!1,this)},gotoAndStop:function(t){return this.currentAnimationName=t,this.frame=0,this.currentFrameIndex=0,this.currentAnimation=this.ss.getAnimation(t),this._updateFrame(),this.paused=!0,this},_updateFrame:function(){var t=this.currentAnimation;if(t&&this.currentFrameIndex>=t.frames.length)return t.next?void this.gotoAndPlay(t.next):(this.paused=!0,void(this.finished=!0));var e=t.frames[this.currentFrameIndex],i=this.ss.getFrame(e);this.target.srcRect.set(i.x,i.y,i.width,i.height),this.fit&&(this.target.width=i.width,this.target.height=i.height)}})}),e.namespace(function(){e.define("phina.accessory.Physical",{superClass:"phina.accessory.Accessory",init:function(t){this.superInit(t),this.velocity=e.geom.Vector2(0,0),this.gravity=e.geom.Vector2(0,0),this.friction=1},update:function(){var t=this.target;this.velocity.x*=this.friction,this.velocity.y*=this.friction,this.velocity.x+=this.gravity.x,this.velocity.y+=this.gravity.y,t.position.x+=this.velocity.x,t.position.y+=this.velocity.y},force:function(t,e){return this.velocity.set(t,e),this},addForce:function(t,e){return this.velocity.x+=t,this.velocity.y+=e,this},setGravity:function(t,e){return this.gravity.set(t,e),this},setFriction:function(t){return this.friction=t,this}}),e.app.Element.prototype.getter("physical",function(){return this._physical||(this._physical=e.accessory.Physical().attachTo(this)),this._physical})}),e.global.Event&&(Event.prototype.stop=function(){this.preventDefault(),this.stopPropagation()}),e.global.MouseEvent&&(MouseEvent.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),MouseEvent.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top})),e.global.TouchEvent&&(TouchEvent.prototype.getter("pointX",function(){return this.touches[0].clientX-this.target.getBoundingClientRect().left}),TouchEvent.prototype.getter("pointY",function(){return this.touches[0].clientY-this.target.getBoundingClientRect().top})),e.global.Touch&&(Touch.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),Touch.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top})),e.namespace(function(){e.define("phina.graphics.Canvas",{domElement:null,canvas:null,context:null,init:function(t){this.canvas="string"==typeof t?document.querySelector(t):t||document.createElement("canvas"),this.domElement=this.canvas,this.context=this.canvas.getContext("2d"),this.context.lineCap="round",this.context.lineJoin="round"},setSize:function(t,e){return this.canvas.width=t,this.canvas.height=e,this},setSizeToScreen:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.setSize(window.innerWidth,window.innerHeight)},fitScreen:function(t){t=void 0===t||t;var i=function(){var t=this.domElement,e=t.style;e.position="absolute",e.margin="auto",e.left="0px",e.top="0px",e.bottom="0px",e.right="0px";var i=t.width/window.innerWidth,n=t.height/window.innerHeight,s=t.height/t.width;i>n?(e.width=Math.floor(innerWidth)+"px",e.height=Math.floor(innerWidth*s)+"px"):(e.width=Math.floor(innerHeight/s)+"px",e.height=Math.floor(innerHeight)+"px")}.bind(this);i(),t&&e.global.addEventListener("resize",i,!1)},clear:function(t,e,i,n){return t=t||0,e=e||0,i=i||this.width,n=n||this.height,this.context.clearRect(t,e,i,n),this},clearColor:function(t,e,i,n,s){e=e||0,i=i||0,n=n||this.width,s=s||this.height;var r=this.context;return r.save(),r.setTransform(1,0,0,1,0,0),r.fillStyle=t,r.fillRect(e,i,n,s),r.restore(),this},beginPath:function(){return this.context.beginPath(),this},closePath:function(){return this.context.closePath(),this},moveTo:function(t,e){return this.context.moveTo(t,e),this},lineTo:function(t,e){return this.context.lineTo(t,e),this},quadraticCurveTo:function(){return this.context.quadraticCurveTo.apply(this.context,arguments),this},bezierCurveTo:function(){return this.context.bezierCurveTo.apply(this.context,arguments),this},fill:function(){return this.context.fill(),this},stroke:function(){return this.context.stroke(),this},clip:function(){return this.context.clip(),this},drawPoint:function(t,e){return this.strokeRect(t,e,1,1)},line:function(t,e,i,n){return this.moveTo(t,e).lineTo(i,n)},drawLine:function(t,e,i,n){return this.beginPath().line(t,e,i,n).stroke()},drawDashLine:function(t,e,i,n,s){var r=null;r=(r="string"==typeof s?s:(s=s||61680).toString(2)).padding(16,"1");var o=i-t,a=n-e,h=Math.sqrt(o*o+a*a);o/=h,a/=h;for(var u=t,c=e,l=0;l<h;++l)"1"==r[l%16]&&this.drawPoint(u,c),u+=o,c+=a;return this},drawArrow:function(t,e,i,n,s){var r=i-t,o=n-e,a=180*Math.atan2(o,r)/Math.PI;return this.drawLine(t,e,i,n),this.fillPolygon(i,n,s||5,3,a),this},lines:function(){this.moveTo(arguments[0],arguments[1]);for(var t=1,e=arguments.length/2;t<e;++t)this.lineTo(arguments[2*t],arguments[2*t+1]);return this},strokeLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.stroke(),this},fillLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.fill(),this},rect:function(t,e,i,n){return this.context.rect.apply(this.context,arguments),this},fillRect:function(){return this.context.fillRect.apply(this.context,arguments),this},strokeRect:function(){return this.context.strokeRect.apply(this.context,arguments),this},roundRect:function(t,e,i,n,s){var r=t+s,o=t+i-s,a=e+s,h=e+n-s;return this.context.arc(r,a,s,-Math.PI,.5*-Math.PI,!1),this.context.arc(o,a,s,.5*-Math.PI,0,!1),this.context.arc(o,h,s,0,.5*Math.PI,!1),this.context.arc(r,h,s,.5*Math.PI,Math.PI,!1),this.closePath(),this},fillRoundRect:function(t,e,i,n,s){return this.beginPath().roundRect(t,e,i,n,s).fill()},strokeRoundRect:function(t,e,i,n,s){return this.beginPath().roundRect(t,e,i,n,s).stroke()},circle:function(t,e,i){return this.context.arc(t,e,i,0,2*Math.PI,!1),this},fillCircle:function(t,e,i){var n=this.context;return n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!1),n.closePath(),n.fill(),this},strokeCircle:function(t,e,i){var n=this.context;return n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!1),n.closePath(),n.stroke(),this},arc:function(t,e,i,n,s,r){return this.context.arc(t,e,i,n,s,r),this},fillArc:function(t,e,i,n,s,r){return this.beginPath().arc(t,e,i,n,s,r).fill()},strokeArc:function(t,e,i,n,s,r){return this.beginPath().arc(t,e,i,n,s,r).stroke()},pie:function(t,e,i,n,s,r){var o=this.context;return o.beginPath(),o.moveTo(0,0),o.arc(t,e,i,n,s,r),o.closePath(),this},fillPie:function(t,e,i,n,s,r){return this.beginPath().pie(t,e,i,n,s,r).fill()},strokePie:function(t,e,i,n,s,r){return this.beginPath().pie(t,e,i,n,s,r).stroke()},polygon:function(t,e,i,n,s){var r=2*Math.PI/n,o=void 0!==s?s*Math.PI/180:-Math.PI/2;this.moveTo(t+Math.cos(o)*i,e+Math.sin(o)*i);for(var a=1;a<n;++a){var h=r*a+o;this.lineTo(t+Math.cos(h)*i,e+Math.sin(h)*i)}return this.closePath(),this},fillPolygon:function(t,e,i,n,s){return this.beginPath().polygon(t,e,i,n,s).fill()},strokePolygon:function(t,e,i,n,s){return this.beginPath().polygon(t,e,i,n,s).stroke()},star:function(t,e,i,n,s,r){t=t||0,e=e||0,n=n||5;var o=(i=i||64)*(s||.38),a=r?r*Math.PI/180:-Math.PI/2,h=2*Math.PI/n/2;this.moveTo(t+Math.cos(a)*i,e+Math.sin(a)*i);for(var u=1;u<2*n;++u){var c=h*u+a,l=u%2?o:i;this.lineTo(t+Math.cos(c)*l,e+Math.sin(c)*l)}return this.closePath(),this},fillStar:function(t,e,i,n,s,r){return this.beginPath().star(t,e,i,n,s,r).fill(),this},strokeStar:function(t,e,i,n,s,r){return this.beginPath().star(t,e,i,n,s,r).stroke(),this},heart:function(t,e,i,n){var s=.5*i,r=void 0===n?Math.PI/4:Math.degToRad(n),o=(s*s-Math.cos(r)*s*-s)/(Math.sin(r)*s),a=s-(o+s)/2;return this.moveTo(0+t,o+e+a),this.arc(-s+t,0+e+a,s,Math.PI-r,2*Math.PI),this.arc(s+t,0+e+a,s,Math.PI,r),this.closePath(),this},fillHeart:function(t,e,i,n){return this.beginPath().heart(t,e,i,n).fill()},strokeHeart:function(t,e,i,n){return this.beginPath().heart(t,e,i,n).stroke()},ellipse:function(t,e,i,n){var s=this.context,r=i/2*.5522848,o=n/2*.5522848,a=t+i,h=e+n,u=t+i/2,c=e+n/2;return s.moveTo(t,c),s.bezierCurveTo(t,c-o,u-r,e,u,e),s.bezierCurveTo(u+r,e,a,c-o,a,c),s.bezierCurveTo(a,c+o,u+r,h,u,h),s.bezierCurveTo(u-r,h,t,c+o,t,c),this},fillEllipse:function(t,e,i,n){return this.beginPath().ellipse(t,e,i,n).fill()},strokeEllipse:function(t,e,i,n){return this.beginPath().ellipse(t,e,i,n).stroke()},fillText:function(){return this._context.fillText.apply(this._context,arguments),this},strokeText:function(){return this._context.strokeText.apply(this._context,arguments),this},drawImage:function(){this.context.drawImage.apply(this.context,arguments)},setTransform:function(t,e,i,n,s,r){return this.context.setTransform(t,e,i,n,s,r),this},resetTransform:function(){return this.setTransform(1,0,0,1,0,0),this},transformCenter:function(){return this.context.setTransform(1,0,0,1,this.width/2,this.height/2),this},translate:function(t,e){return this.context.translate(t,e),this},rotate:function(t){return this.context.rotate(t),this},scale:function(t,e){return this.context.scale(t,e),this},save:function(){return this.context.save(),this},restore:function(){return this.context.restore(),this},saveAsImage:function(t){t=t||"image/png";var e=this.canvas.toDataURL(t);window.open(e,"save")},_accessor:{width:{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},height:{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}},fillStyle:{get:function(){return this.context.fillStyle},set:function(t){this.context.fillStyle=t}},strokeStyle:{get:function(){return this.context.strokeStyle},set:function(t){this.context.strokeStyle=t}},globalAlpha:{get:function(){return this.context.globalAlpha},set:function(t){this.context.globalAlpha=t}},globalCompositeOperation:{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}},shadowBlur:{get:function(){return this.context.shadowBlur},set:function(t){this.context.shadowBlur=t}},shadowColor:{get:function(){return this.context.shadowColor},set:function(t){this.context.shadowColor=t}},shadowOffsetX:{get:function(){return this.context.shadowOffsetX},set:function(t){this.context.shadowOffsetX=t}},shadowOffsetY:{get:function(){return this.context.shadowOffsetY},set:function(t){this.context.shadowOffsetY=t}},lineCap:{get:function(){return this.context.lineCap},set:function(t){this.context.lineCap=t}},lineJoin:{get:function(){return this.context.lineJoin},set:function(t){this.context.lineJoin=t}},miterLimit:{get:function(){return this.context.miterLimit},set:function(t){this.context.miterLimit=t}},lineWidth:{get:function(){return this.context.lineWidth},set:function(t){this.context.lineWidth=t}},font:{get:function(){return this.context.font},set:function(t){this.context.font=t}},textAlign:{get:function(){return this.context.textAlign},set:function(t){this.context.textAlign=t}},textBaseline:{get:function(){return this.context.textBaseline},set:function(t){this.context.textBaseline=t}},imageSmoothingEnabled:{get:function(){return this.context.imageSmoothingEnabled},set:function(t){this.context.imageSmoothingEnabled=t,this.context.webkitImageSmoothingEnabled=t,this.context.mozImageSmoothingEnabled=t}}},_static:{_context:e.util.Support.canvas?document.createElement("canvas").getContext("2d"):null,measureText:function(t,e){return this._context.font=t,this._context.measureText(e)},createLinearGradient:function(){return this._context.createLinearGradient.apply(this._context,arguments)},createRadialGradient:function(){return this._context.createRadialGradient.apply(this._context,arguments)}}})}),e.namespace(function(){e.define("phina.graphics.CanvasRecorder",{superClass:"phina.util.EventDispatcher",_id:null,objectURL:null,init:function(t,e){this.superInit(),this.canvas=t,this.gif=new GIF((e||{}).$safe({workers:4,quality:10,width:t.width,height:t.height})),this.gif.on("finished",function(t){this.objectURL=URL.createObjectURL(t),this.flare("finished")}.bind(this))},setOption:function(t,e){return this.gif.setOption(t,e),this},setOptions:function(t){return this.gif.setOptions(t),this},start:function(t,e){e=e||2e3;var i=1e3/(t=t||30),n=0;return this._id=setInterval(function(){var t=this.canvas.context;this.gif.addFrame(t,{copy:!0,delay:i}),(n+=i)>e&&this.stop()}.bind(this),i),this},stop:function(){return null===this._id?this:(clearInterval(this._id),this.gif.render(),this._id=null,this)},open:function(){window.open(this.objectURL)},_accessor:{width:{get:function(){return this.gif.options.width||this.canvas.width},set:function(t){this.setOption("width",t)}},height:{get:function(){return this.gif.options.height||this.canvas.height},set:function(t){this.setOption("height",t)}},quality:{get:function(){return this.gif.options.quality},set:function(t){this.setOption("quality",t)}},workerScript:{get:function(){return this.gif.options.workerScript},set:function(t){this.setOption("workerScript",t)}},workers:{get:function(){return this.gif.options.workers},set:function(t){this.setOption("workers",t)}},repeat:{get:function(){return this.gif.options.repeat},set:function(t){this.setOption("repeat",t)}},loop:{get:function(){return 0===this.gif.options.repeat},set:function(t){this.setOption("repeat",t?0:-1)}},transparent:{get:function(){return this.gif.options.transparent},set:function(t){this.setOption("transparent",t)}},background:{get:function(){return this.gif.options.background},set:function(t){this.setOption("background",t)}}}})}),e.namespace(function(){e.define("phina.display.DisplayElement",{superClass:"phina.app.Object2D",visible:!0,alpha:1,blendMode:"source-over",renderChildBySelf:!1,init:function(t){t=t||{},this.superInit(t),this.visible=!0,this.alpha=1,this._worldAlpha=1},setVisible:function(t){return this.visible=t,this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},_calcWorldAlpha:function(){if(this.alpha<0)this._worldAlpha=0;else if(this.parent){var t=void 0!==this.parent._worldAlpha?this.parent._worldAlpha:1;this._worldAlpha=t*this.alpha}else this._worldAlpha=this.alpha}})}),e.namespace(function(){e.define("phina.display.PlainElement",{superClass:"phina.display.DisplayElement",init:function(t){this.superInit(t),this.canvas=e.graphics.Canvas(),this.canvas.setSize(this.width,this.height)},draw:function(t){var e=this.canvas.domElement,i=e.width,n=e.height,s=-i*this.origin.x,r=-n*this.origin.y;t.context.drawImage(e,0,0,i,n,s,r,i,n)}})}),e.namespace(function(){var t=e.define("phina.display.Shape",{superClass:"phina.display.PlainElement",init:function(t){t={}.$safe(t,{width:64,height:64,padding:8,backgroundColor:"#aaa",fill:"#00a",stroke:"#aaa",strokeWidth:4,shadow:!1,shadowBlur:4}),this.superInit(t),this.padding=t.padding,this.backgroundColor=t.backgroundColor,this.fill=t.fill,this.stroke=t.stroke,this.strokeWidth=t.strokeWidth,this.shadow=t.shadow,this.shadowBlur=t.shadowBlur,this.watchDraw=!0,this._dirtyDraw=!0;var e=function(){this.watchDraw&&!0===this._dirtyDraw&&(this.render(this.canvas),this._dirtyDraw=!1)};this.on("enterframe",e),this.on("added",e)},calcCanvasWidth:function(){return this.width+2*this.padding},calcCanvasHeight:function(){return this.height+2*this.padding},calcCanvasSize:function(){return{width:this.calcCanvasWidth(),height:this.calcCanvasHeight()}},isStrokable:function(){return this.stroke&&0<this.strokeWidth},prerender:function(t){},postrender:function(t){},renderFill:function(t){t.fill()},renderStroke:function(t){t.stroke()},render:function(t){var e=t.context,i=this.calcCanvasSize();return t.setSize(i.width,i.height),t.clearColor(this.backgroundColor),t.transformCenter(),this.prerender(this.canvas),this.isStrokable()&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.lineJoin="round",e.shadowBlur=0,this.renderStroke(t)),this.fill&&(e.fillStyle=this.fill,this.shadow?(e.shadowColor=this.shadow,e.shadowBlur=this.shadowBlur):e.shadowBlur=0,this.renderFill(t)),this.postrender(this.canvas),this},_static:{watchRenderProperty:function(t){this.prototype.$watch(t,function(t,e){t!==e&&(this._dirtyDraw=!0)})},watchRenderProperties:function(e){var i=this.watchRenderProperty||t.watchRenderProperty;e.each(function(t){i.call(this,t)},this)}},_defined:function(){this.watchRenderProperties(["width","height","radius","padding","backgroundColor","fill","stroke","strokeWidth","shadow","shadowBlur"])}})}),e.namespace(function(){e.define("phina.display.RectangleShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"blue",stroke:"#aaa",strokeWidth:4,cornerRadius:0}),this.superInit(t),this.cornerRadius=t.cornerRadius},prerender:function(t){t.roundRect(-this.width/2,-this.height/2,this.width,this.height,this.cornerRadius)},_defined:function(){e.display.Shape.watchRenderProperty.call(this,"cornerRadius")}})}),e.namespace(function(){e.define("phina.display.CircleShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"red",stroke:"#aaa",strokeWidth:4,radius:32}),this.superInit(t),this.setBoundingType("circle")},prerender:function(t){t.circle(0,0,this.radius)}})}),e.namespace(function(){e.define("phina.display.TriangleShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"green",stroke:"#aaa",strokeWidth:4,radius:32}),this.superInit(t),this.setBoundingType("circle")},prerender:function(t){t.polygon(0,0,this.radius,3)}})}),e.namespace(function(){e.define("phina.display.StarShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"yellow",stroke:"#aaa",strokeWidth:4,radius:32,sides:5,sideIndent:.38}),this.superInit(t),this.setBoundingType("circle"),this.sides=t.sides,this.sideIndent=t.sideIndent},prerender:function(t){t.star(0,0,this.radius,this.sides,this.sideIndent)},_defined:function(){e.display.Shape.watchRenderProperty.call(this,"sides"),e.display.Shape.watchRenderProperty.call(this,"sideIndent")}})}),e.namespace(function(){e.define("phina.display.PolygonShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"cyan",stroke:"#aaa",strokeWidth:4,radius:32,sides:5}),this.superInit(t),this.setBoundingType("circle"),this.sides=t.sides},prerender:function(t){t.polygon(0,0,this.radius,this.sides)},_defined:function(){e.display.Shape.watchRenderProperty.call(this,"sides")}})}),e.namespace(function(){e.define("phina.display.HeartShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"pink",stroke:"#aaa",strokeWidth:4,radius:32,cornerAngle:45}),this.superInit(t),this.setBoundingType("circle"),this.cornerAngle=t.cornerAngle},prerender:function(t){t.heart(0,0,this.radius,this.cornerAngle)},_defined:function(){e.display.Shape.watchRenderProperty.call(this,"cornerAngle")}})}),e.namespace(function(){var t=e.define("phina.display.PathShape",{superClass:"phina.display.Shape",paths:null,init:function(e){e={}.$safe(e||{},t.defaults),this.superInit(e),this.paths=e.paths||[],this.lineJoin=e.lineJoin,this.lineCap=e.lineCap},setPaths:function(t){return this.paths=t,this._dirtyDraw=!0,this},clear:function(){return this.paths.length=0,this._dirtyDraw=!0,this},addPaths:function(t){return[].push.apply(this.paths,t),this._dirtyDraw=!0,this},addPath:function(t,i){return this.paths.push(e.geom.Vector2(t,i)),this._dirtyDraw=!0,this},getPath:function(t){return this.paths[t]},getPaths:function(){return this.paths},changePath:function(t,e,i){return this.paths[t].set(e,i),this._dirtyDraw=!0,this},calcCanvasSize:function(){var t=this.paths;if(0===t.length)return{width:2*this.padding,height:2*this.padding};for(var e=-1/0,i=-1/0,n=1/0,s=1/0,r=0,o=t.length;r<o;++r){var a=t[r];e<a.x&&(e=a.x),n>a.x&&(n=a.x),i<a.y&&(i=a.y),s>a.y&&(s=a.y)}return{width:2*Math.max(Math.abs(e),Math.abs(n))+2*this.padding,height:2*Math.max(Math.abs(i),Math.abs(s))+2*this.padding}},calcCanvasWidth:function(){return this.calcCanvasSize().width},calcCanvasHeight:function(){return this.calcCanvasSize().height},prerender:function(t){t.lineCap=this.lineCap,t.lineJoin=this.lineJoin;var e=this.paths;if(e.length>1){var i=t.context,n=e[0];i.beginPath(),i.moveTo(n.x,n.y);for(var s=1,r=e.length;s<r;++s)n=e[s],i.lineTo(n.x,n.y)}},_defined:function(){e.display.Shape.watchRenderProperties.call(this,["lineCap","lineJoin"])},_static:{defaults:{fill:!1,backgroundColor:"transparent",lineCap:"round",lineJoin:"round"}}})}),e.namespace(function(){e.define("phina.display.Sprite",{superClass:"phina.display.DisplayElement",init:function(t,i,n){this.superInit(),this.srcRect=e.geom.Rect(),this.setImage(t,i,n)},draw:function(t){var e=this.image.domElement,i=this.srcRect;t.context.drawImage(e,i.x,i.y,i.width,i.height,-this._width*this.originX,-this._height*this.originY,this._width,this._height)},setImage:function(t,i,n){return"string"==typeof t&&(t=e.asset.AssetManager.get("image",t)),this._image=t,this.width=this._image.domElement.width,this.height=this._image.domElement.height,i&&(this.width=i),n&&(this.height=n),this.frameIndex=0,this},setFrameIndex:function(t,e,i){var n=e||this._width,s=i||this._height,r=~~(this.image.domElement.width/n),o=(t%=r*~~(this.image.domElement.height/s))%r,a=~~(t/r);return this.srcRect.x=o*n,this.srcRect.y=a*s,this.srcRect.width=n,this.srcRect.height=s,this._frameIndex=t,this},_accessor:{image:{get:function(){return this._image},set:function(t){return this.setImage(t),this}},frameIndex:{get:function(){return this._frameIndex},set:function(t){return this.setFrameIndex(t),this}}}})}),e.namespace(function(){e.define("phina.display.Label",{superClass:"phina.display.Shape",init:function(t){t="object"!=typeof arguments[0]?{text:arguments[0]}:arguments[0],t={}.$safe(t,e.display.Label.defaults),this.superInit(t),this.text=t.text,this.fontSize=t.fontSize,this.fontWeight=t.fontWeight,this.fontFamily=t.fontFamily,this.align=t.align,this.baseline=t.baseline,this.lineHeight=t.lineHeight},calcCanvasWidth:function(){var t=0,e=this.canvas;return e.context.font=this.font,this._lines.forEach(function(i){var n=e.context.measureText(i).width;t<n&&(t=n)},this),"center"!==this.align&&(t*=2),t+2*this.padding},calcCanvasHeight:function(){var t=this.fontSize*this._lines.length;return"middle"!==this.baseline&&(t*=2),t*this.lineHeight+2*this.padding},prerender:function(t){var e=t.context;e.font=this.font,e.textAlign=this.align,e.textBaseline=this.baseline;var i=this._lines;this.lineSize=this.fontSize*this.lineHeight,this._offset=-Math.floor(i.length/2)*this.lineSize,this._offset+=(i.length+1)%2*(this.lineSize/2)},renderFill:function(t){var e=t.context;this._lines.forEach(function(t,i){e.fillText(t,0,i*this.lineSize+this._offset)},this)},renderStroke:function(t){var e=t.context;this._lines.forEach(function(t,i){e.strokeText(t,0,i*this.lineSize+this._offset)},this)},_accessor:{text:{get:function(){return this._text},set:function(t){this._text=t,this._lines=(this.text+"").split("\n")}},font:{get:function(){return"{fontWeight} {fontSize}px {fontFamily}".format(this)}}},_static:{defaults:{backgroundColor:"transparent",fill:"black",stroke:null,strokeWidth:2,text:"Hello, world!",fontSize:32,fontWeight:"",fontFamily:"'HiraKakuProN-W3'",align:"center",baseline:"middle",lineHeight:1.2}},_defined:function(){var t=e.display.Shape;t.watchRenderProperty.call(this,"text"),t.watchRenderProperty.call(this,"fontSize"),t.watchRenderProperty.call(this,"fontWeight"),t.watchRenderProperty.call(this,"fontFamily"),t.watchRenderProperty.call(this,"align"),t.watchRenderProperty.call(this,"baseline"),t.watchRenderProperty.call(this,"lineHeight")}})}),e.namespace(function(){e.define("phina.display.DisplayScene",{superClass:"phina.app.Scene",init:function(t){this.superInit(),t={}.$safe(t,e.display.DisplayScene.defaults),this.canvas=e.graphics.Canvas(),this.canvas.setSize(t.width,t.height),this.renderer=e.display.CanvasRenderer(this.canvas),this.backgroundColor=t.backgroundColor?t.backgroundColor:null,this.width=t.width,this.height=t.height,this.gridX=e.util.Grid(t.width,16),this.gridY=e.util.Grid(t.height,16),this.interactive=!0,this.setInteractive=function(t){this.interactive=t},this._overFlags={},this._touchFlags={}},hitTest:function(){return!0},_update:function(){this.update&&this.update()},_render:function(){this.renderer.render(this)},_static:{defaults:{width:640,height:960}}})}),e.namespace(function(){e.define("phina.display.Layer",{superClass:"phina.display.DisplayElement",renderChildBySelf:!0,init:function(t){t={}.$safe(t,{width:640,height:960}),this.superInit(t),this.width=t.width,this.height=t.height,this.gridX=e.util.Grid(t.width,16),this.gridY=e.util.Grid(t.height,16)},draw:function(t){if(this.domElement){var e=this.domElement;t.context.drawImage(e,0,0,e.width,e.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)}}})}),e.namespace(function(){e.define("phina.display.CanvasLayer",{superClass:"phina.display.Layer",init:function(t){this.superInit(t),this.canvas=e.graphics.Canvas(),this.canvas.width=this.width,this.canvas.height=this.height,this.renderer=e.display.CanvasRenderer(this.canvas),this.domElement=this.canvas.domElement,this.on("enterframe",function(){var t=this._worldMatrix;this._worldMatrix=null,this.renderer.render(this),this._worldMatrix=t})},draw:function(t){var e=this.domElement;t.context.drawImage(e,0,0,e.width,e.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)}})}),e.namespace(function(){e.define("phina.display.ThreeLayer",{superClass:"phina.display.Layer",scene:null,camera:null,light:null,renderer:null,init:function(t){this.superInit(t),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,t.width/t.height,1,1e4),this.camera.position.z=1e3,this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(1,1,1).normalize(),this.scene.add(this.light),this.renderer=new THREE.WebGLRenderer,this.renderer.setClearColor(15790320),this.renderer.setSize(t.width,t.height),this.on("enterframe",function(){this.renderer.render(this.scene,this.camera)}),this.domElement=this.renderer.domElement}})}),e.namespace(function(){e.define("phina.display.CanvasRenderer",{init:function(t){this.canvas=t,this._context=this.canvas.context},render:function(t){this.canvas.clear(),t.backgroundColor&&this.canvas.clearColor(t.backgroundColor),this._context.save(),this.renderChildren(t),this._context.restore()},renderChildren:function(t){if(t.children.length>0)for(var e=t.children.slice(),i=0,n=e.length;i<n;++i)this.renderObject(e[i])},renderObject:function(t){if((!1!==t.visible||t.interactive)&&(t._calcWorldMatrix&&t._calcWorldMatrix(),!1!==t.visible)){t._calcWorldAlpha&&t._calcWorldAlpha();var e=this.canvas.context;if(e.globalAlpha=t._worldAlpha,e.globalCompositeOperation=t.blendMode,t._worldMatrix){var i=t._worldMatrix;e.setTransform(i.m00,i.m10,i.m01,i.m11,i.m02,i.m12)}if(t.clip){if(e.save(),t.clip(this.canvas),e.clip(),t.draw&&t.draw(this.canvas),!1===t.renderChildBySelf&&t.children.length>0)for(var n=0,s=(r=t.children.slice()).length;n<s;++n)this.renderObject(r[n]);e.restore()}else if(t.draw&&t.draw(this.canvas),!1===t.renderChildBySelf&&t.children.length>0){var r;for(n=0,s=(r=t.children.slice()).length;n<s;++n)this.renderObject(r[n])}}}})}),e.namespace(function(){e.define("phina.display.DomApp",{superClass:"phina.app.BaseApp",domElement:null,init:function(t){this.superInit(t),t.domElement?this.domElement=t.domElement:t.query?this.domElement=document.querySelector(t.query):console.assert("error"),void 0!==t.fps&&(this.fps=t.fps),"function"==typeof t.runner&&(this.ticker.runner=t.runner),this.mouse=e.input.Mouse(this.domElement),this.touch=e.input.Touch(this.domElement),this.touchList=e.input.TouchList(this.domElement,5),this.keyboard=e.input.Keyboard(document),this.accelerometer=e.input.Accelerometer(),this.pointer=this.touch,this.pointers=this.touchList.touches,this.domElement.addEventListener("touchstart",function(){this.pointer=this.touch,this.pointers=this.touchList.touches}.bind(this)),this.domElement.addEventListener("mouseover",function(){this.pointer=this.mouse,this.pointers=[this.mouse]}.bind(this)),this.keyboard.on("keydown",function(t){this.currentScene&&this.currentScene.flare("keydown",{keyCode:t.keyCode})}.bind(this)),this.keyboard.on("keyup",function(t){this.currentScene&&this.currentScene.flare("keyup",{keyCode:t.keyCode})}.bind(this)),this.keyboard.on("keypress",function(t){this.currentScene&&this.currentScene.flare("keypress",{keyCode:t.keyCode})}.bind(this));var i=e.isMobile()?"touchend":"mouseup";this.domElement.addEventListener(i,this._checkClick.bind(this)),this.domElement.addEventListener("touchstart",function(t){t.stop()}),this.domElement.addEventListener("touchmove",function(t){t.stop()}),e.global.addEventListener("focus",function(){this.flare("focus"),this.currentScene.flare("focus")}.bind(this),!1),e.global.addEventListener("blur",function(){this.flare("blur"),this.currentScene.flare("blur")}.bind(this),!1),this.on("enterframe",function(){this.mouse.update(),this.touch.update(),this.touchList.update(),this.keyboard.update()})},_checkClick:function(t){var e=function(t){t.children.length>0&&t.children.each(function(t){e(t)}),t._clicked&&t.has("click")&&t.flare("click"),t._clicked=!1};e(this.currentScene)}})}),e.namespace(function(){e.define("phina.display.CanvasApp",{superClass:"phina.display.DomApp",init:function(t){(t=(t||{}).$safe(e.display.CanvasApp.defaults)).query||t.domElement||(t.domElement=document.createElement("canvas"),t.append&&document.body.appendChild(t.domElement)),this.superInit(t),this.gridX=e.util.Grid({width:t.width,columns:t.columns}),this.gridY=e.util.Grid({width:t.height,columns:t.columns}),this.canvas=e.graphics.Canvas(this.domElement),this.canvas.setSize(t.width,t.height),this.backgroundColor=void 0!==t.backgroundColor?t.backgroundColor:"white",this.replaceScene(e.display.DisplayScene({width:t.width,height:t.height})),t.fit&&this.fitScreen(),t.pixelated&&(this.domElement.style.imageRendering="pixelated"),this.on("push",function(){this.currentScene.canvas&&this._draw()})},_draw:function(){this.backgroundColor?this.canvas.clearColor(this.backgroundColor):this.canvas.clear(),this.currentScene.canvas&&(this.currentScene._render(),this._scenes.each(function(t){var e=t.canvas;e&&this.canvas.context.drawImage(e.domElement,0,0,e.width,e.height)},this))},fitScreen:function(){this.canvas.fitScreen()},_static:{defaults:{width:640,height:960,columns:12,fit:!0,append:!0}}})}),e.namespace(function(){e.define("phina.effect.Wave",{superClass:"phina.display.CircleShape",init:function(t){t=(t||{}).$safe({fill:"white",stroke:!1}),this.superInit(t),e.accessory.Tweener().attachTo(this).to({scaleX:2,scaleY:2,alpha:0},500).call(function(){this.remove()},this)}})}),e.namespace(function(){e.define("phina.ui.Button",{superClass:"phina.display.Shape",init:function(t){t=(t||{}).$safe(e.ui.Button.defaults),this.superInit(t),this.cornerRadius=t.cornerRadius,this.text=t.text,this.fontColor=t.fontColor,this.fontSize=t.fontSize,this.fontWeight=t.fontWeight,this.fontFamily=t.fontFamily,this.setInteractive(!0),this.on("pointend",function(){this.flare("push")})},prerender:function(t){t.roundRect(-this.width/2,-this.height/2,this.width,this.height,this.cornerRadius)},postrender:function(t){var e=t.context,i="{fontWeight} {fontSize}px {fontFamily}".format(this);e.font=i,e.textAlign="center",e.textBaseline="middle",e.fillStyle=this.fontColor,e.fillText(this.text,0,0)},_static:{defaults:{width:200,height:80,backgroundColor:"transparent",fill:"hsl(200, 80%, 60%)",stroke:null,cornerRadius:8,text:"Hello",fontColor:"white",fontSize:32,fontWeight:"",fontFamily:"'HiraKakuProN-W3'"}},_defined:function(){e.display.Shape.watchRenderProperty.call(this,"cornerRadius"),e.display.Shape.watchRenderProperty.call(this,"text"),e.display.Shape.watchRenderProperty.call(this,"fontColor"),e.display.Shape.watchRenderProperty.call(this,"fontSize"),e.display.Shape.watchRenderProperty.call(this,"fontFamily")}})}),e.namespace(function(){e.define("phina.ui.Gauge",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t||{},Gauge.defaults),this.superInit(t),this._value=void 0!==t.value?t.value:t.maxValue,this.maxValue=t.maxValue,this.gaugeColor=t.gaugeColor,this.cornerRadius=t.cornerRadius,this.visualValue=void 0!==t.value?t.value:t.maxValue,this.animation=!0,this.animationTime=1e3},isFull:function(){return this.value===this.maxValue},isEmpty:function(){return 0===this.value},setValue:function(t){if(t=Math.clamp(t,0,this.maxValue),this.value!==t)if(this.flare("change"),this._value=t,this.animation){var e=Math.abs(this.visualValue-t)/this.maxValue*this.animationTime;this.tweener.ontween=function(){this._dirtyDraw=!0}.bind(this),this.tweener.clear().to({visualValue:t},e).call(function(){this.flare("changed"),this.isEmpty()?this.flare("empty"):this.isFull()&&this.flare("full")},this)}else this.visualValue=t,this.flare("changed"),this.isEmpty()?this.flare("empty"):this.isFull()&&this.flare("full")},getRate:function(){return this.visualValue/this.maxValue},prerender:function(t){t.roundRect(-this.width/2,-this.height/2,this.width,this.height,this.cornerRadius)},postrender:function(t){var e=this.getRate();t.context.fillStyle=this.gaugeColor,t.context.save(),t.context.clip(),t.fillRect(-this.width/2,-this.height/2,this.width*e,this.height),t.context.restore()},_accessor:{value:{get:function(){return this._value},set:function(t){this.setValue(t)}}},_defined:function(){e.display.Shape.watchRenderProperty.call(this,"value"),e.display.Shape.watchRenderProperty.call(this,"maxValue"),e.display.Shape.watchRenderProperty.call(this,"gaugeColor"),e.display.Shape.watchRenderProperty.call(this,"cornerRadius")},_static:{defaults:{width:256,height:32,backgroundColor:"transparent",fill:"white",stroke:"#aaa",strokeWidth:4,maxValue:100,gaugeColor:"#44f",cornerRadius:0}}})}),e.namespace(function(){e.define("phina.ui.CircleGauge",{superClass:"phina.ui.Gauge",init:function(t){t=(t||{}).$safe({backgroundColor:"transparent",fill:"#aaa",stroke:"#222",radius:64,anticlockwise:!0,showPercentage:!1}),this.superInit(t),this.setBoundingType("circle"),this.radius=t.radius,this.anticlockwise=t.anticlockwise,this.showPercentage=t.showPercentage},prerender:function(t){var e=this.getRate(),i=2*Math.PI*e;this.startAngle=0,this.endAngle=i,this.canvas.rotate(.5*-Math.PI),this.canvas.scale(1,-1)},renderFill:function(t){t.fillPie(0,0,this.radius,this.startAngle,this.endAngle)},renderStroke:function(t){t.strokeArc(0,0,this.radius,this.startAngle,this.endAngle)},postrender:function(){}})}),e.namespace(function(){var t={},i=e.define("phina.ui.LabelArea",{superClass:"phina.display.Label",_lineUpdate:!0,init:function(t){t={}.$safe(t,i.defaults),this.superInit(t),this.verticalAlign=t.verticalAlign,this.scroll=t.scroll||e.geom.Vector2(),this.scrollX=t.scrollX,this.scrollY=t.scrollY},calcCanvasWidth:function(){return this.width+2*this.padding},calcCanvasHeight:function(){return this.height+2*this.padding},getOffsetY:function(){return"number"==typeof this.verticalAlign?this.verticalAlign:i.verticalAlignToOffsetMap[this.verticalAlign]||0},getOffsetX:function(){return i.alignToOffsetMap[this.align]||0},getTextWidthCache:function(){return t[this.font]||(t[this.font]={})},spliceLines:function(t){var e=this.width,i=this.canvas.context;i.font=this.font;var n=this.getTextWidthCache();this._text.each(function(t){n[t]||(n[t]=i.measureText(t).width)});var s=[];return t.forEach(function(t){var i="",r=0;t.each(function(t){var o=n[t];r+o>e&&(s.push(i),i="",r=0),i+=t,r+=o}),s.push(i)}),s},getLines:function(){if(!1===this._lineUpdate)return this._lines;this._lineUpdate=!1;var t=(this.text+"").split("\n");return this.width<1?this._lines=t:this._lines=this.spliceLines(t),this._lines},prerender:function(t){var e=t.context;e.font=this.font,e.textAlign=this.align,e.textBaseline=this.baseline;this.text;var i=this.getLines(),n=i.length,s=this.width,r=this.height,o=this.fontSize*this.lineHeight,a=this.getOffsetX()*s,h=this.getOffsetY();0===h?(h=-Math.floor(n/2)*o,h+=(n+1)%2*(o/2)):h<0?h*=r:h=h*r-n*o+o,h-=this.scrollY,a-=this.scrollX;var u=(h+r/2)/-o|0;u<0&&(u=0);var c=(r/2-h+2*o)/o|0;i=i.filter(function(t,e){return u<=e&&c>e}),this.lines=i,this.offsetX=a,this.offsetY=h,this.lineSize=o,this.start=u},renderFill:function(t){var e=t.context,i=this.offsetX,n=this.offsetY,s=this.lineSize,r=this.start;this.lines.forEach(function(t,o){e.fillText(t,i,(r+o)*s+n)},this)},renderStroke:function(t){var e=t.context,i=this.offsetX,n=this.offsetY,s=this.lineSize,r=this.start;this.lines.forEach(function(t,o){e.strokeText(t,i,(r+o)*s+n)},this)},_accessor:{text:{get:function(){return this._text},set:function(t){this._text=t}},scrollX:{get:function(){return this.scroll.x},set:function(t){this.scroll.x=t}},scrollY:{get:function(){return this.scroll.y},set:function(t){this.scroll.y=t}}},_static:{defaults:{verticalAlign:"top",align:"left",baseline:"top",width:320,height:320,scrollX:0,scrollY:0},alignToOffsetMap:{start:-.5,left:-.5,center:0,end:.5,right:.5},verticalAlignToOffsetMap:{top:-.5,center:0,middle:0,bottom:.5}},_defined:function(){var t=function(t,e){!1===this._lineUpdate&&t!==e&&(this._lineUpdate=!0)};["text","width","fontSize","fontWeight","fontFamily"].forEach(function(e){this.$watch(e,t)},this.prototype),e.display.Shape.watchRenderProperties.call(this,["verticalAlign","text","scroll","scrollX","scrollY"])},enableScroll:function(){return this}})}),e.namespace(function(){e.define("phina.game.ManagerScene",{superClass:"phina.app.Scene",init:function(t){this.superInit(),this.setScenes(t.scenes),this.on("enter",function(){this.gotoScene(t.startLabel||0)}.bind(this)),this.on("resume",this.onnext.bind(this)),this.commonArguments={}},setScenes:function(t){return this.scenes=t,this.sceneIndex=0,this},replaceScene:function(t,i){var n="string"==typeof t?this.labelToIndex(t):t||0,s=this.scenes[n];s||console.error("phina.js error: `{0}` .".format(t));var r=e.using(s.className);"function"!=typeof r&&(r=e.using("phina.game."+s.className));var o={}.$extend(s.arguments,i),a=r.call(null,o);return a.nextLabel||(a.nextLabel=s.nextLabel),a.nextArguments||(a.nextArguments=s.nextArguments),this.app.replaceScene(a),this.sceneIndex=n,this},gotoScene:function(t,i){var n="string"==typeof t?this.labelToIndex(t):t||0,s=this.scenes[n];s||console.error("phina.js error: `{0}` .".format(t));var r=e.using(s.className);"function"!=typeof r&&(r=e.using("phina.game."+s.className));var o={}.$extend(s.arguments,i),a=r.call(null,o);return a.nextLabel||(a.nextLabel=s.nextLabel),a.nextArguments||(a.nextArguments=s.nextArguments),this.app.pushScene(a),this.sceneIndex=n,this},gotoNext:function(t){var e=this.scenes[this.sceneIndex],i=null;return e.nextLabel?i=this.labelToIndex(e.nextLabel):this.sceneIndex+1<this.scenes.length&&(i=this.sceneIndex+1),null!==i?this.gotoScene(i,t):this.flare("finish"),this},getCurrentIndex:function(){return this.sceneIndex},getCurrentLabel:function(){return this.scenes[this.sceneIndex].label},labelToIndex:function(t){var e=this.scenes.filter(function(e){return e.label==t})[0];return this.scenes.indexOf(e)},indexToLabel:function(t){return this.scenes[t].label},onnext:function(t){var e=t.prevScene.nextLabel,i=t.prevScene.nextArguments;e?this.gotoScene(e,i):this.gotoNext(i)}})}),e.namespace(function(){e.define("phina.game.SplashScene",{superClass:"phina.display.DisplayScene",init:function(t){var i=e.game.SplashScene.defaults;this.superInit(t);var n=e.asset.Texture();n.load(i.imageURL).then(function(){this._init()}.bind(this)),this.texture=n},_init:function(){this.sprite=e.display.Sprite(this.texture).addChildTo(this),this.sprite.setPosition(this.gridX.center(),this.gridY.center()),this.sprite.alpha=0,this.sprite.tweener.clear().to({alpha:1},500,"easeOutCubic").wait(1e3).to({alpha:0},500,"easeOutCubic").wait(250).call(function(){this.exit()},this)},_static:{defaults:{imageURL:"http://cdn.rawgit.com/phi-jp/phina.js/develop/logo.png"}}})}),e.namespace(function(){e.define("phina.game.TitleScene",{superClass:"phina.display.DisplayScene",init:function(t){t={}.$safe(t,e.game.TitleScene.defaults),this.superInit(t),this.backgroundColor=t.backgroundColor,this.fromJSON({children:{titleLabel:{className:"phina.display.Label",arguments:{text:t.title,fill:t.fontColor,stroke:!1,fontSize:64},x:this.gridX.center(),y:this.gridY.span(4)}}}),"touch"===t.exitType&&(this.fromJSON({children:{touchLabel:{className:"phina.display.Label",arguments:{text:"TOUCH START",fill:t.fontColor,stroke:!1,fontSize:32},x:this.gridX.center(),y:this.gridY.span(12)}}}),this.on("pointend",function(){this.exit()}))},_static:{defaults:{title:"phina.js games",message:"",fontColor:"white",backgroundColor:"hsl(200, 80%, 64%)",backgroundImage:"",exitType:"touch"}}})}),e.namespace(function(){e.define("phina.game.ResultScene",{superClass:"phina.display.DisplayScene",init:function(t){t={}.$safe(t,e.game.ResultScene.defaults),this.superInit(t);var i=t.message.format(t);this.backgroundColor=t.backgroundColor,this.fromJSON({children:{scoreText:{className:"phina.display.Label",arguments:{text:"score",fill:t.fontColor,stroke:null,fontSize:48},x:this.gridX.span(8),y:this.gridY.span(4)},scoreLabel:{className:"phina.display.Label",arguments:{text:t.score+"",fill:t.fontColor,stroke:null,fontSize:72},x:this.gridX.span(8),y:this.gridY.span(6)},messageLabel:{className:"phina.display.Label",arguments:{text:i,fill:t.fontColor,stroke:null,fontSize:32},x:this.gridX.center(),y:this.gridY.span(9)},shareButton:{className:"phina.ui.Button",arguments:[{text:"",width:128,height:128,fontColor:t.fontColor,fontSize:50,cornerRadius:64,fill:"rgba(240, 240, 240, 0.5)"}],x:this.gridX.center(-3),y:this.gridY.span(12)},playButton:{className:"phina.ui.Button",arguments:[{text:"",width:128,height:128,fontColor:t.fontColor,fontSize:50,cornerRadius:64,fill:"rgba(240, 240, 240, 0.5)"}],x:this.gridX.center(3),y:this.gridY.span(12),interactive:!0,onpush:function(){this.exit()}.bind(this)}}}),"touch"===t.exitType&&this.on("pointend",function(){this.exit()}),this.shareButton.onclick=function(){var n="Score: {0}\n{1}".format(t.score,i),s=e.social.Twitter.createURL({text:n,hashtags:t.hashtags,url:t.url});window.open(s,"share window","width=480, height=320")}},_static:{defaults:{score:16,message:"this is phina.js project.",hashtags:"phina_js,game,javascript",url:e.global.location&&e.global.location.href,fontColor:"white",backgroundColor:"hsl(200, 80%, 64%)",backgroundImage:""}}})}),e.namespace(function(){e.define("phina.game.LoadingScene",{superClass:"phina.display.DisplayScene",init:function(t){t={}.$safe(t,e.game.LoadingScene.defaults),this.superInit(t),this.fromJSON({children:{gauge:{className:"phina.ui.Gauge",arguments:{value:0,width:this.width,height:12,fill:"#aaa",stroke:!1,gaugeColor:"hsla(200, 100%, 80%, 0.8)",padding:0},x:this.gridX.center(),y:0,originY:0}}});var i=e.asset.AssetLoader();t.lie?(this.gauge.animationTime=1e4,this.gauge.value=90,i.onload=function(){this.gauge.animationTime=0,this.gauge.value=100}.bind(this)):(this.gauge.animationTime=100,i.onprogress=function(t){this.gauge.value=100*t.progress}.bind(this)),this.gauge.onfull=function(){"auto"===t.exitType&&this.app.popScene(),this.flare("loaded")}.bind(this),i.load(t.assets)},_static:{defaults:{exitType:"auto",lie:!1}}})}),e.namespace(function(){e.define("phina.game.CountScene",{superClass:"phina.display.DisplayScene",init:function(t){this.superInit(t),t=(t||{}).$safe(e.game.CountScene.defaults),this.backgroundColor=t.backgroundColor,this.fromJSON({children:{label:{className:"phina.display.Label",arguments:{fill:t.fontColor,fontSize:t.fontSize,stroke:!1},x:this.gridX.center(),y:this.gridY.center()}}}),t.count instanceof Array?this.countList=t.count.reverse():this.countList=Array.range(1,t.count+1),this.counter=this.countList.length,this.exitType=t.exitType,this._updateCount()},_updateCount:function(){this.counter;var t=--this.counter;this.label.text=this.countList[t],this.label.scale.set(1,1),this.label.tweener.clear().to({scaleX:1,scaleY:1,alpha:1},250).wait(500).to({scaleX:1.5,scaleY:1.5,alpha:0},250).call(function(){this.counter<=0?(this.flare("finish"),"auto"===this.exitType&&this.app.popScene()):this._updateCount()},this)},_static:{defaults:{count:3,width:640,height:960,fontColor:"white",fontSize:164,backgroundColor:"rgba(50, 50, 50, 1)",exitType:"auto"}}})}),e.namespace(function(){e.define("phina.game.PauseScene",{superClass:"phina.display.DisplayScene",init:function(t){t={}.$safe(t,e.game.PauseScene.defaults),this.superInit(t),this.backgroundColor=t.backgroundColor,this.fromJSON({children:{text:{className:"phina.display.Label",arguments:{text:"Pause",fill:t.fontColor,stroke:null,fontSize:48},x:this.gridX.center(),y:this.gridY.center()}}}),"touch"===t.exitType&&this.on("pointend",function(){this.exit()})},_static:{defaults:{fontColor:"white",backgroundColor:"hsla(0, 0%, 0%, 0.85)",exitType:"touch"}}})}),e.namespace(function(){e.define("phina.game.GameApp",{superClass:"phina.display.CanvasApp",init:function(t){t=(t||{}).$safe({startLabel:"title"}),this.superInit(t);var i=t.startLabel||"title",n=t.scenes||[{className:"SplashScene",label:"splash",nextLabel:"title"},{className:"TitleScene",label:"title",nextLabel:"main"},{className:"MainScene",label:"main",nextLabel:"result"},{className:"ResultScene",label:"result",nextLabel:"title"}];n=n.each(function(e){e.arguments=e.arguments||t});var s=e.game.ManagerScene({startLabel:i,scenes:n});if(t.assets){var r={}.$extend(t,{exitType:""}),o=(e.global.LoadingScene||e.game.LoadingScene)(r);this.replaceScene(o),o.onloaded=function(){this.replaceScene(s),t.debug&&this._enableDebugger()}.bind(this)}else this.replaceScene(s),t.debug&&this._enableDebugger();t.autoPause&&this.on("blur",function(){var t=e.game.PauseScene();this.pushScene(t)})},_enableDebugger:function(){this.gui||this.enableDatGUI(function(t){var e=t.addFolder("scenes"),i={};this.rootScene.scenes.each(function(t){return i[t.label]=function(){this.rootScene.replaceScene(t.label),console.log(this._scenes.length)}.bind(this),t},this),i.forIn(function(t,n){e.add(i,t)}),e.open(),this.gui=t}.bind(this))}})}),e.namespace(function(){e.define("phina.social.Twitter",{init:function(){},_static:{baseURL:"https://twitter.com/intent",defaults:{text:"Hello, world!",hashtags:"javascript,phina",url:e.global.location&&e.global.location.href},createURL:function(t){t=(t||{}).$safe(this.defaults);var e=[],i=encodeURIComponent;return t.forIn(function(t,n){var s=t+"="+i(n);e.push(s)}),"{baseURL}/{type}?{query}".format({baseURL:this.baseURL,type:"tweet",query:e.join("&")})}}})}),e.namespace(function(){if(e.global.Box2D){e.box2d={b2:{Vec2:Box2D.Common.Math.b2Vec2,AABB:Box2D.Collision.b2AABB,BodyDef:Box2D.Dynamics.b2BodyDef,Body:Box2D.Dynamics.b2Body,FixtureDef:Box2D.Dynamics.b2FixtureDef,Fixture:Box2D.Dynamics.b2Fixture,World:Box2D.Dynamics.b2World,MassData:Box2D.Collision.Shapes.b2MassData,PolygonShape:Box2D.Collision.Shapes.b2PolygonShape,CircleShape:Box2D.Collision.Shapes.b2CircleShape,DebugDraw:Box2D.Dynamics.b2DebugDraw,MouseJointDef:Box2D.Dynamics.Joints.b2MouseJointDef}};var t=e.box2d.b2;e.define("phina.box2d.Box2dLayer",{superClass:"phina.display.CanvasLayer",init:function(e){this.superInit(e),e=(e||{}).$safe({worldScale:50});var i=new t.Vec2(0,9.8),n=new t.World(i,!0);this.world=n,this.world._scale=e.worldScale,this._setupDebugDraw()},_setupDebugDraw:function(){var e=new t.DebugDraw;e.SetSprite(this.canvas.context),e.SetDrawScale(this.world._scale),e.SetLineThickness(1),e.SetAlpha(1),e.SetFillAlpha(.4),e.SetFlags(t.DebugDraw.e_shapeBit),this.world.SetDebugDraw(e)},createBody:function(t){return t.world=this.world,e.box2d.Box2dBody(t)},update:function(t){var e=t.ticker.deltaTime/1e3;this.world.Step(e,10,10)},draw:function(t){this.world.ClearForces(),this.world.DrawDebugData();var e=this.canvas.domElement;t.context.drawImage(e,0,0,e.width,e.height)}})}}),e.namespace(function(){if(e.global.Box2D){var t=e.box2d.b2;e.define("phina.box2d.Box2dBody",{superClass:"phina.accessory.Accessory",init:function(e){this.superInit(),this.world=e.world,this.type=e.type,this.shape=e.shape,this._init(),this.on("attached",function(){var e=this.target,i=new t.Vec2(e.x/this.world._scale,e.y/this.world._scale);this.body.SetPosition(i),this.body.SetAngle(e.rotation*Math.PI/180),this._bindFixture(this.target)})},update:function(t){var e=this.target;e.x=this.body.GetPosition().x*this.world._scale,e.y=this.body.GetPosition().y*this.world._scale,e.rotation=180*this.body.GetAngle()/Math.PI},_init:function(){return this._setupBody(),this},_setupBody:function(){var e=this,i=this.world,n=(i._scale,new t.BodyDef);n.type={dynamic:t.Body.b2_dynamicBody,kinematic:t.Body.b2_kinematicBody,static:t.Body.b2_staticBody}[e.type||"dynamic"],n.position.Set(0,0);var s=i.CreateBody(n);return this.body=s,this},_bindFixture:function(){var e=this,i=this.target;(n=this.body.GetFixtureList())&&this.body.DestroyFixture(n);var n,s=this.world._scale,r=function(){var n=null;return"circle"===e.shape?n=new t.CircleShape(i.radius/s):"box"===e.shape?(n=new t.PolygonShape).SetAsBox(i.width/s/2,i.height/s/2):n=new t.CircleShape(32/s),n}();(n=new t.FixtureDef).shape=r,n.density=1,n.friction=.3,n.restitution=.5,this.body.CreateFixture(n)}})}}),e.namespace(function(){e.define("phina.display.CanvasElement",{superClass:"phina.display.DisplayElement",init:function(t){this.superInit(t),console.warn("[phina warn] CanvasElement . DisplayElement .")}}),e.define("phina.display.CanvasScene",{superClass:"phina.display.DisplayScene",init:function(t){this.superInit(t),console.warn("[phina warn] CanvasScene . DisplayScene .")}})});
},{}],"iJA9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MIXED_COLORS=exports.BASE_COLOR=exports.FONT=exports.COLOR=exports.SCREEN=void 0;var e={W:640,H:960};exports.SCREEN=e;var r={BASE:"#eee"};exports.COLOR=r;var s={DEFAULT:"'M PLUS Rounded 1c', sans-serif"};exports.FONT=s;var E={c:1,m:0,y:0},O={c:0,m:1,y:0},o={c:0,m:0,y:1},t={c:0,m:1,y:1},p={c:1,m:0,y:1},x={c:1,m:1,y:0},L={c:0,m:0,y:0},R={CYAN:E,MAGENTA:O,YELLOW:o,RED:t,GREEN:p,BLUE:x,WHITE:L};exports.BASE_COLOR=R;var c=[[E,O],[x,L],[O,o],[t,L],[o,E],[p,L],[E,p],[E,x],[O,t],[O,x],[o,t],[o,p],[E,O,O],[O,x,L],[E,o,o],[o,p,L],[O,E,E],[E,x,L],[O,o,o],[o,t,L],[o,E,E],[E,p,L],[o,O,O],[O,t,L]];exports.MIXED_COLORS=c;
},{}],"mG0D":[function(require,module,exports) {
var define;
var global = arguments[3];
var e,t=arguments[3];!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof e&&e.amd)e([],n);else{("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:this).Matter=n()}}(function(){return function(){return function e(t,n,o){function i(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){return i(t[s][1][e]||e)},d,d.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}}()({1:[function(e,t,n){var o={};t.exports=o;var i=e("../geometry/Vertices"),r=e("../geometry/Vector"),s=e("../core/Sleeping"),a=(e("../render/Render"),e("../core/Common")),l=e("../geometry/Bounds"),c=e("../geometry/Axes");!function(){o._inertiaScale=4,o._nextCollidingGroupId=1,o._nextNonCollidingGroupId=-1,o._nextCategory=1,o.create=function(t){var n={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:i.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:0}},o=a.extend(n,t);return e(o,t),o},o.nextGroup=function(e){return e?o._nextNonCollidingGroupId--:o._nextCollidingGroupId++},o.nextCategory=function(){return o._nextCategory=o._nextCategory<<1,o._nextCategory};var e=function(e,t){t=t||{},o.set(e,{bounds:e.bounds||l.create(e.vertices),positionPrev:e.positionPrev||r.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),i.rotate(e.vertices,e.angle,e.position),c.rotate(e.axes,e.angle),l.update(e.bounds,e.vertices,e.velocity),o.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var n=e.isStatic?"#2e2b44":a.choose(["#006BA6","#0496FF","#FFBC42","#D81159","#8F2D56"]);e.render.fillStyle=e.render.fillStyle||n,e.render.strokeStyle=e.render.strokeStyle||"#000",e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};o.set=function(e,t,n){var i;for(i in"string"==typeof t&&(i=t,(t={})[i]=n),t)if(n=t[i],t.hasOwnProperty(i))switch(i){case"isStatic":o.setStatic(e,n);break;case"isSleeping":s.set(e,n);break;case"mass":o.setMass(e,n);break;case"density":o.setDensity(e,n);break;case"inertia":o.setInertia(e,n);break;case"vertices":o.setVertices(e,n);break;case"position":o.setPosition(e,n);break;case"angle":o.setAngle(e,n);break;case"velocity":o.setVelocity(e,n);break;case"angularVelocity":o.setAngularVelocity(e,n);break;case"parts":o.setParts(e,n);break;default:e[i]=n}},o.setStatic=function(e,t){for(var n=0;n<e.parts.length;n++){var o=e.parts[n];o.isStatic=t,t?(o._original={restitution:o.restitution,friction:o.friction,mass:o.mass,inertia:o.inertia,density:o.density,inverseMass:o.inverseMass,inverseInertia:o.inverseInertia},o.restitution=0,o.friction=1,o.mass=o.inertia=o.density=1/0,o.inverseMass=o.inverseInertia=0,o.positionPrev.x=o.position.x,o.positionPrev.y=o.position.y,o.anglePrev=o.angle,o.angularVelocity=0,o.speed=0,o.angularSpeed=0,o.motion=0):o._original&&(o.restitution=o._original.restitution,o.friction=o._original.friction,o.mass=o._original.mass,o.inertia=o._original.inertia,o.density=o._original.density,o.inverseMass=o._original.inverseMass,o.inverseInertia=o._original.inverseInertia,delete o._original)}},o.setMass=function(e,t){var n=e.inertia/(e.mass/6);e.inertia=n*(t/6),e.inverseInertia=1/e.inertia,e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},o.setDensity=function(e,t){o.setMass(e,t*e.area),e.density=t},o.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},o.setVertices=function(e,t){t[0].body===e?e.vertices=t:e.vertices=i.create(t,e),e.axes=c.fromVertices(e.vertices),e.area=i.area(e.vertices),o.setMass(e,e.density*e.area);var n=i.centre(e.vertices);i.translate(e.vertices,n,-1),o.setInertia(e,o._inertiaScale*i.inertia(e.vertices,e.mass)),i.translate(e.vertices,e.position),l.update(e.bounds,e.vertices,e.velocity)},o.setParts=function(e,t,n){var r;for(t=t.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,r=0;r<t.length;r++){var s=t[r];s!==e&&(s.parent=e,e.parts.push(s))}if(1!==e.parts.length){if(n=void 0===n||n){var a=[];for(r=0;r<t.length;r++)a=a.concat(t[r].vertices);i.clockwiseSort(a);var l=i.hull(a),c=i.centre(l);o.setVertices(e,l),i.translate(e.vertices,c)}var d=o._totalProperties(e);e.area=d.area,e.parent=e,e.position.x=d.centre.x,e.position.y=d.centre.y,e.positionPrev.x=d.centre.x,e.positionPrev.y=d.centre.y,o.setMass(e,d.mass),o.setInertia(e,d.inertia),o.setPosition(e,d.centre)}},o.setPosition=function(e,t){var n=r.sub(t,e.position);e.positionPrev.x+=n.x,e.positionPrev.y+=n.y;for(var o=0;o<e.parts.length;o++){var s=e.parts[o];s.position.x+=n.x,s.position.y+=n.y,i.translate(s.vertices,n),l.update(s.bounds,s.vertices,e.velocity)}},o.setAngle=function(e,t){var n=t-e.angle;e.anglePrev+=n;for(var o=0;o<e.parts.length;o++){var s=e.parts[o];s.angle+=n,i.rotate(s.vertices,n,e.position),c.rotate(s.axes,n),l.update(s.bounds,s.vertices,e.velocity),o>0&&r.rotateAbout(s.position,n,e.position,s.position)}},o.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x,e.positionPrev.y=e.position.y-t.y,e.velocity.x=t.x,e.velocity.y=t.y,e.speed=r.magnitude(e.velocity)},o.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t,e.angularVelocity=t,e.angularSpeed=Math.abs(e.angularVelocity)},o.translate=function(e,t){o.setPosition(e,r.add(e.position,t))},o.rotate=function(e,t,n){if(n){var i=Math.cos(t),r=Math.sin(t),s=e.position.x-n.x,a=e.position.y-n.y;o.setPosition(e,{x:n.x+(s*i-a*r),y:n.y+(s*r+a*i)}),o.setAngle(e,e.angle+t)}else o.setAngle(e,e.angle+t)},o.scale=function(e,t,n,r){var s=0,a=0;r=r||e.position;for(var d=0;d<e.parts.length;d++){var u=e.parts[d];i.scale(u.vertices,t,n,r),u.axes=c.fromVertices(u.vertices),u.area=i.area(u.vertices),o.setMass(u,e.density*u.area),i.translate(u.vertices,{x:-u.position.x,y:-u.position.y}),o.setInertia(u,o._inertiaScale*i.inertia(u.vertices,u.mass)),i.translate(u.vertices,{x:u.position.x,y:u.position.y}),d>0&&(s+=u.area,a+=u.inertia),u.position.x=r.x+(u.position.x-r.x)*t,u.position.y=r.y+(u.position.y-r.y)*n,l.update(u.bounds,u.vertices,e.velocity)}e.parts.length>1&&(e.area=s,e.isStatic||(o.setMass(e,e.density*s),o.setInertia(e,a))),e.circleRadius&&(t===n?e.circleRadius*=t:e.circleRadius=null)},o.update=function(e,t,n,o){var s=Math.pow(t*n*e.timeScale,2),a=1-e.frictionAir*n*e.timeScale,d=e.position.x-e.positionPrev.x,u=e.position.y-e.positionPrev.y;e.velocity.x=d*a*o+e.force.x/e.mass*s,e.velocity.y=u*a*o+e.force.y/e.mass*s,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*a*o+e.torque/e.inertia*s,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=r.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var p=0;p<e.parts.length;p++){var m=e.parts[p];i.translate(m.vertices,e.velocity),p>0&&(m.position.x+=e.velocity.x,m.position.y+=e.velocity.y),0!==e.angularVelocity&&(i.rotate(m.vertices,e.angularVelocity,e.position),c.rotate(m.axes,e.angularVelocity),p>0&&r.rotateAbout(m.position,e.angularVelocity,e.position,m.position)),l.update(m.bounds,m.vertices,e.velocity)}},o.applyForce=function(e,t,n){e.force.x+=n.x,e.force.y+=n.y;var o=t.x-e.position.x,i=t.y-e.position.y;e.torque+=o*n.y-i*n.x},o._totalProperties=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===e.parts.length?0:1;n<e.parts.length;n++){var o=e.parts[n],i=o.mass!==1/0?o.mass:1;t.mass+=i,t.area+=o.area,t.inertia+=o.inertia,t.centre=r.add(t.centre,r.mult(o.position,i))}return t.centre=r.div(t.centre,t.mass),t}}()},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31}],2:[function(e,t,n){var o={};t.exports=o;var i=e("../core/Events"),r=e("../core/Common"),s=e("../geometry/Bounds"),a=e("./Body");o.create=function(e){return r.extend({id:r.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},e)},o.setModified=function(e,t,n,i){if(e.isModified=t,n&&e.parent&&o.setModified(e.parent,t,n,i),i)for(var r=0;r<e.composites.length;r++){var s=e.composites[r];o.setModified(s,t,n,i)}},o.add=function(e,t){var n=[].concat(t);i.trigger(e,"beforeAdd",{object:t});for(var s=0;s<n.length;s++){var a=n[s];switch(a.type){case"body":if(a.parent!==a){r.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}o.addBody(e,a);break;case"constraint":o.addConstraint(e,a);break;case"composite":o.addComposite(e,a);break;case"mouseConstraint":o.addConstraint(e,a.constraint)}}return i.trigger(e,"afterAdd",{object:t}),e},o.remove=function(e,t,n){var r=[].concat(t);i.trigger(e,"beforeRemove",{object:t});for(var s=0;s<r.length;s++){var a=r[s];switch(a.type){case"body":o.removeBody(e,a,n);break;case"constraint":o.removeConstraint(e,a,n);break;case"composite":o.removeComposite(e,a,n);break;case"mouseConstraint":o.removeConstraint(e,a.constraint)}}return i.trigger(e,"afterRemove",{object:t}),e},o.addComposite=function(e,t){return e.composites.push(t),t.parent=e,o.setModified(e,!0,!0,!1),e},o.removeComposite=function(e,t,n){var i=r.indexOf(e.composites,t);if(-1!==i&&(o.removeCompositeAt(e,i),o.setModified(e,!0,!0,!1)),n)for(var s=0;s<e.composites.length;s++)o.removeComposite(e.composites[s],t,!0);return e},o.removeCompositeAt=function(e,t){return e.composites.splice(t,1),o.setModified(e,!0,!0,!1),e},o.addBody=function(e,t){return e.bodies.push(t),o.setModified(e,!0,!0,!1),e},o.removeBody=function(e,t,n){var i=r.indexOf(e.bodies,t);if(-1!==i&&(o.removeBodyAt(e,i),o.setModified(e,!0,!0,!1)),n)for(var s=0;s<e.composites.length;s++)o.removeBody(e.composites[s],t,!0);return e},o.removeBodyAt=function(e,t){return e.bodies.splice(t,1),o.setModified(e,!0,!0,!1),e},o.addConstraint=function(e,t){return e.constraints.push(t),o.setModified(e,!0,!0,!1),e},o.removeConstraint=function(e,t,n){var i=r.indexOf(e.constraints,t);if(-1!==i&&o.removeConstraintAt(e,i),n)for(var s=0;s<e.composites.length;s++)o.removeConstraint(e.composites[s],t,!0);return e},o.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),o.setModified(e,!0,!0,!1),e},o.clear=function(e,t,n){if(n)for(var i=0;i<e.composites.length;i++)o.clear(e.composites[i],t,!0);return t?e.bodies=e.bodies.filter(function(e){return e.isStatic}):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,o.setModified(e,!0,!0,!1),e},o.allBodies=function(e){for(var t=[].concat(e.bodies),n=0;n<e.composites.length;n++)t=t.concat(o.allBodies(e.composites[n]));return t},o.allConstraints=function(e){for(var t=[].concat(e.constraints),n=0;n<e.composites.length;n++)t=t.concat(o.allConstraints(e.composites[n]));return t},o.allComposites=function(e){for(var t=[].concat(e.composites),n=0;n<e.composites.length;n++)t=t.concat(o.allComposites(e.composites[n]));return t},o.get=function(e,t,n){var i,r;switch(n){case"body":i=o.allBodies(e);break;case"constraint":i=o.allConstraints(e);break;case"composite":i=o.allComposites(e).concat(e)}return i?0===(r=i.filter(function(e){return e.id.toString()===t.toString()})).length?null:r[0]:null},o.move=function(e,t,n){return o.remove(e,t),o.add(n,t),e},o.rebase=function(e){for(var t=o.allBodies(e).concat(o.allConstraints(e)).concat(o.allComposites(e)),n=0;n<t.length;n++)t[n].id=r.nextId();return o.setModified(e,!0,!0,!1),e},o.translate=function(e,t,n){for(var i=n?o.allBodies(e):e.bodies,r=0;r<i.length;r++)a.translate(i[r],t);return o.setModified(e,!0,!0,!1),e},o.rotate=function(e,t,n,i){for(var r=Math.cos(t),s=Math.sin(t),l=i?o.allBodies(e):e.bodies,c=0;c<l.length;c++){var d=l[c],u=d.position.x-n.x,p=d.position.y-n.y;a.setPosition(d,{x:n.x+(u*r-p*s),y:n.y+(u*s+p*r)}),a.rotate(d,t)}return o.setModified(e,!0,!0,!1),e},o.scale=function(e,t,n,i,r){for(var s=r?o.allBodies(e):e.bodies,l=0;l<s.length;l++){var c=s[l],d=c.position.x-i.x,u=c.position.y-i.y;a.setPosition(c,{x:i.x+d*t,y:i.y+u*n}),a.scale(c,t,n)}return o.setModified(e,!0,!0,!1),e},o.bounds=function(e){for(var t=o.allBodies(e),n=[],i=0;i<t.length;i+=1){var r=t[i];n.push(r.bounds.min,r.bounds.max)}return s.create(n)}},{"../core/Common":14,"../core/Events":16,"../geometry/Bounds":26,"./Body":1}],3:[function(e,t,n){var o={};t.exports=o;var i=e("./Composite"),r=(e("../constraint/Constraint"),e("../core/Common"));o.create=function(e){var t=i.create(),n={label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-1/0,y:-1/0},max:{x:1/0,y:1/0}}};return r.extend(t,n,e)}},{"../constraint/Constraint":12,"../core/Common":14,"./Composite":2}],4:[function(e,t,n){var o={};t.exports=o,o.create=function(e){return{id:o.id(e),vertex:e,normalImpulse:0,tangentImpulse:0}},o.id=function(e){return e.body.id+"_"+e.index}},{}],5:[function(e,t,n){var o={};t.exports=o;var i=e("./SAT"),r=e("./Pair"),s=e("../geometry/Bounds");o.collisions=function(e,t){for(var n=[],a=t.pairs.table,l=0;l<e.length;l++){var c=e[l][0],d=e[l][1];if((!c.isStatic&&!c.isSleeping||!d.isStatic&&!d.isSleeping)&&o.canCollide(c.collisionFilter,d.collisionFilter)&&s.overlaps(c.bounds,d.bounds))for(var u=c.parts.length>1?1:0;u<c.parts.length;u++)for(var p=c.parts[u],m=d.parts.length>1?1:0;m<d.parts.length;m++){var f=d.parts[m];if(p===c&&f===d||s.overlaps(p.bounds,f.bounds)){var v,y=a[r.id(p,f)];v=y&&y.isActive?y.collision:null;var g=i.collides(p,f,v);g.collided&&n.push(g)}}}return n},o.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!=(e.mask&t.category)&&0!=(t.mask&e.category)}},{"../geometry/Bounds":26,"./Pair":7,"./SAT":11}],6:[function(e,t,n){var o={};t.exports=o;var i=e("./Pair"),r=e("./Detector"),s=e("../core/Common");o.create=function(e){var t={controller:o,detector:r.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return s.extend(t,e)},o.update=function(e,t,n,i){var r,s,a,l,c,d=n.world,u=e.buckets,p=!1;for(r=0;r<t.length;r++){var m=t[r];if((!m.isSleeping||i)&&!(m.bounds.max.x<d.bounds.min.x||m.bounds.min.x>d.bounds.max.x||m.bounds.max.y<d.bounds.min.y||m.bounds.min.y>d.bounds.max.y)){var f=o._getRegion(e,m);if(!m.region||f.id!==m.region.id||i){m.region&&!i||(m.region=f);var v=o._regionUnion(f,m.region);for(s=v.startCol;s<=v.endCol;s++)for(a=v.startRow;a<=v.endRow;a++){l=u[c=o._getBucketId(s,a)];var y=s>=f.startCol&&s<=f.endCol&&a>=f.startRow&&a<=f.endRow,g=s>=m.region.startCol&&s<=m.region.endCol&&a>=m.region.startRow&&a<=m.region.endRow;!y&&g&&g&&l&&o._bucketRemoveBody(e,l,m),(m.region===f||y&&!g||i)&&(l||(l=o._createBucket(u,c)),o._bucketAddBody(e,l,m))}m.region=f,p=!0}}}p&&(e.pairsList=o._createActivePairsList(e))},o.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]},o._regionUnion=function(e,t){var n=Math.min(e.startCol,t.startCol),i=Math.max(e.endCol,t.endCol),r=Math.min(e.startRow,t.startRow),s=Math.max(e.endRow,t.endRow);return o._createRegion(n,i,r,s)},o._getRegion=function(e,t){var n=t.bounds,i=Math.floor(n.min.x/e.bucketWidth),r=Math.floor(n.max.x/e.bucketWidth),s=Math.floor(n.min.y/e.bucketHeight),a=Math.floor(n.max.y/e.bucketHeight);return o._createRegion(i,r,s,a)},o._createRegion=function(e,t,n,o){return{id:e+","+t+","+n+","+o,startCol:e,endCol:t,startRow:n,endRow:o}},o._getBucketId=function(e,t){return"C"+e+"R"+t},o._createBucket=function(e,t){return e[t]=[]},o._bucketAddBody=function(e,t,n){for(var o=0;o<t.length;o++){var r=t[o];if(!(n.id===r.id||n.isStatic&&r.isStatic)){var s=i.id(n,r),a=e.pairs[s];a?a[2]+=1:e.pairs[s]=[n,r,1]}}t.push(n)},o._bucketRemoveBody=function(e,t,n){t.splice(s.indexOf(t,n),1);for(var o=0;o<t.length;o++){var r=t[o],a=i.id(n,r),l=e.pairs[a];l&&(l[2]-=1)}},o._createActivePairsList=function(e){var t,n,o=[];t=s.keys(e.pairs);for(var i=0;i<t.length;i++)(n=e.pairs[t[i]])[2]>0?o.push(n):delete e.pairs[t[i]];return o}},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(e,t,n){var o={};t.exports=o;var i=e("./Contact");o.create=function(e,t){var n=e.bodyA,i=e.bodyB,r=e.parentA,s=e.parentB,a={id:o.id(n,i),bodyA:n,bodyB:i,contacts:{},activeContacts:[],separation:0,isActive:!0,isSensor:n.isSensor||i.isSensor,timeCreated:t,timeUpdated:t,inverseMass:r.inverseMass+s.inverseMass,friction:Math.min(r.friction,s.friction),frictionStatic:Math.max(r.frictionStatic,s.frictionStatic),restitution:Math.max(r.restitution,s.restitution),slop:Math.max(r.slop,s.slop)};return o.update(a,e,t),a},o.update=function(e,t,n){var r=e.contacts,s=t.supports,a=e.activeContacts,l=t.parentA,c=t.parentB;if(e.collision=t,e.inverseMass=l.inverseMass+c.inverseMass,e.friction=Math.min(l.friction,c.friction),e.frictionStatic=Math.max(l.frictionStatic,c.frictionStatic),e.restitution=Math.max(l.restitution,c.restitution),e.slop=Math.max(l.slop,c.slop),a.length=0,t.collided){for(var d=0;d<s.length;d++){var u=s[d],p=i.id(u),m=r[p];m?a.push(m):a.push(r[p]=i.create(u))}e.separation=t.depth,o.setActive(e,!0,n)}else!0===e.isActive&&o.setActive(e,!1,n)},o.setActive=function(e,t,n){t?(e.isActive=!0,e.timeUpdated=n):(e.isActive=!1,e.activeContacts.length=0)},o.id=function(e,t){return e.id<t.id?"A"+e.id+"B"+t.id:"A"+t.id+"B"+e.id}},{"./Contact":4}],8:[function(e,t,n){var o={};t.exports=o;var i=e("./Pair"),r=e("../core/Common");o._pairMaxIdleLife=1e3,o.create=function(e){return r.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},o.update=function(e,t,n){var o,s,a,l,c=e.list,d=e.table,u=e.collisionStart,p=e.collisionEnd,m=e.collisionActive,f=[];for(u.length=0,p.length=0,m.length=0,l=0;l<t.length;l++)(o=t[l]).collided&&(s=i.id(o.bodyA,o.bodyB),f.push(s),(a=d[s])?(a.isActive?m.push(a):u.push(a),i.update(a,o,n)):(a=i.create(o,n),d[s]=a,u.push(a),c.push(a)));for(l=0;l<c.length;l++)(a=c[l]).isActive&&-1===r.indexOf(f,a.id)&&(i.setActive(a,!1,n),p.push(a))},o.removeOld=function(e,t){var n,i,r,s,a=e.list,l=e.table,c=[];for(s=0;s<a.length;s++)(i=(n=a[s]).collision).bodyA.isSleeping||i.bodyB.isSleeping?n.timeUpdated=t:t-n.timeUpdated>o._pairMaxIdleLife&&c.push(s);for(s=0;s<c.length;s++)delete l[(n=a[r=c[s]-s]).id],a.splice(r,1)},o.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}},{"../core/Common":14,"./Pair":7}],9:[function(e,t,n){var o={};t.exports=o;var i=e("../geometry/Vector"),r=e("./SAT"),s=e("../geometry/Bounds"),a=e("../factory/Bodies"),l=e("../geometry/Vertices");o.collides=function(e,t){for(var n=[],o=0;o<t.length;o++){var i=t[o];if(s.overlaps(i.bounds,e.bounds))for(var a=1===i.parts.length?0:1;a<i.parts.length;a++){var l=i.parts[a];if(s.overlaps(l.bounds,e.bounds)){var c=r.collides(l,e);if(c.collided){n.push(c);break}}}}return n},o.ray=function(e,t,n,r){r=r||1e-100;for(var s=i.angle(t,n),l=i.magnitude(i.sub(t,n)),c=.5*(n.x+t.x),d=.5*(n.y+t.y),u=a.rectangle(c,d,l,r,{angle:s}),p=o.collides(u,e),m=0;m<p.length;m+=1){var f=p[m];f.body=f.bodyB=f.bodyA}return p},o.region=function(e,t,n){for(var o=[],i=0;i<e.length;i++){var r=e[i],a=s.overlaps(r.bounds,t);(a&&!n||!a&&n)&&o.push(r)}return o},o.point=function(e,t){for(var n=[],o=0;o<e.length;o++){var i=e[o];if(s.contains(i.bounds,t))for(var r=1===i.parts.length?0:1;r<i.parts.length;r++){var a=i.parts[r];if(s.contains(a.bounds,t)&&l.contains(a.vertices,t)){n.push(i);break}}}return n}},{"../factory/Bodies":23,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"./SAT":11}],10:[function(e,t,n){var o={};t.exports=o;var i=e("../geometry/Vertices"),r=e("../geometry/Vector"),s=e("../core/Common"),a=e("../geometry/Bounds");o._restingThresh=4,o._restingThreshTangent=6,o._positionDampen=.9,o._positionWarming=.8,o._frictionNormalMultiplier=5,o.preSolvePosition=function(e){var t,n,o;for(t=0;t<e.length;t++)(n=e[t]).isActive&&(o=n.activeContacts.length,n.collision.parentA.totalContacts+=o,n.collision.parentB.totalContacts+=o)},o.solvePosition=function(e,t){var n,i,s,a,l,c,d,u,p,m=r._temp[0],f=r._temp[1],v=r._temp[2],y=r._temp[3];for(n=0;n<e.length;n++)(i=e[n]).isActive&&!i.isSensor&&(a=(s=i.collision).parentA,l=s.parentB,c=s.normal,d=r.sub(r.add(l.positionImpulse,l.position,m),r.add(a.positionImpulse,r.sub(l.position,s.penetration,f),v),y),i.separation=r.dot(c,d));for(n=0;n<e.length;n++)(i=e[n]).isActive&&!i.isSensor&&(a=(s=i.collision).parentA,l=s.parentB,c=s.normal,p=(i.separation-i.slop)*t,(a.isStatic||l.isStatic)&&(p*=2),a.isStatic||a.isSleeping||(u=o._positionDampen/a.totalContacts,a.positionImpulse.x+=c.x*p*u,a.positionImpulse.y+=c.y*p*u),l.isStatic||l.isSleeping||(u=o._positionDampen/l.totalContacts,l.positionImpulse.x-=c.x*p*u,l.positionImpulse.y-=c.y*p*u))},o.postSolvePosition=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.totalContacts=0,0!==n.positionImpulse.x||0!==n.positionImpulse.y){for(var s=0;s<n.parts.length;s++){var l=n.parts[s];i.translate(l.vertices,n.positionImpulse),a.update(l.bounds,l.vertices,n.velocity),l.position.x+=n.positionImpulse.x,l.position.y+=n.positionImpulse.y}n.positionPrev.x+=n.positionImpulse.x,n.positionPrev.y+=n.positionImpulse.y,r.dot(n.positionImpulse,n.velocity)<0?(n.positionImpulse.x=0,n.positionImpulse.y=0):(n.positionImpulse.x*=o._positionWarming,n.positionImpulse.y*=o._positionWarming)}}},o.preSolveVelocity=function(e){var t,n,o,i,s,a,l,c,d,u,p,m,f,v,y=r._temp[0],g=r._temp[1];for(t=0;t<e.length;t++)if((o=e[t]).isActive&&!o.isSensor)for(i=o.activeContacts,a=(s=o.collision).parentA,l=s.parentB,c=s.normal,d=s.tangent,n=0;n<i.length;n++)p=(u=i[n]).vertex,m=u.normalImpulse,f=u.tangentImpulse,0===m&&0===f||(y.x=c.x*m+d.x*f,y.y=c.y*m+d.y*f,a.isStatic||a.isSleeping||(v=r.sub(p,a.position,g),a.positionPrev.x+=y.x*a.inverseMass,a.positionPrev.y+=y.y*a.inverseMass,a.anglePrev+=r.cross(v,y)*a.inverseInertia),l.isStatic||l.isSleeping||(v=r.sub(p,l.position,g),l.positionPrev.x-=y.x*l.inverseMass,l.positionPrev.y-=y.y*l.inverseMass,l.anglePrev-=r.cross(v,y)*l.inverseInertia))},o.solveVelocity=function(e,t){for(var n=t*t,i=r._temp[0],a=r._temp[1],l=r._temp[2],c=r._temp[3],d=r._temp[4],u=r._temp[5],p=0;p<e.length;p++){var m=e[p];if(m.isActive&&!m.isSensor){var f=m.collision,v=f.parentA,y=f.parentB,g=f.normal,x=f.tangent,h=m.activeContacts,b=1/h.length;v.velocity.x=v.position.x-v.positionPrev.x,v.velocity.y=v.position.y-v.positionPrev.y,y.velocity.x=y.position.x-y.positionPrev.x,y.velocity.y=y.position.y-y.positionPrev.y,v.angularVelocity=v.angle-v.anglePrev,y.angularVelocity=y.angle-y.anglePrev;for(var w=0;w<h.length;w++){var S=h[w],C=S.vertex,A=r.sub(C,v.position,a),P=r.sub(C,y.position,l),B=r.add(v.velocity,r.mult(r.perp(A),v.angularVelocity),c),M=r.add(y.velocity,r.mult(r.perp(P),y.angularVelocity),d),k=r.sub(B,M,u),I=r.dot(g,k),_=r.dot(x,k),T=Math.abs(_),R=s.sign(_),V=(1+m.restitution)*I,E=s.clamp(m.separation+I,0,1)*o._frictionNormalMultiplier,L=_,F=1/0;T>m.friction*m.frictionStatic*E*n&&(F=T,L=s.clamp(m.friction*R*n,-F,F));var O=r.cross(A,g),q=r.cross(P,g),W=b/(v.inverseMass+y.inverseMass+v.inverseInertia*O*O+y.inverseInertia*q*q);if(V*=W,L*=W,I<0&&I*I>o._restingThresh*n)S.normalImpulse=0;else{var D=S.normalImpulse;S.normalImpulse=Math.min(S.normalImpulse+V,0),V=S.normalImpulse-D}if(_*_>o._restingThreshTangent*n)S.tangentImpulse=0;else{var N=S.tangentImpulse;S.tangentImpulse=s.clamp(S.tangentImpulse+L,-F,F),L=S.tangentImpulse-N}i.x=g.x*V+x.x*L,i.y=g.y*V+x.y*L,v.isStatic||v.isSleeping||(v.positionPrev.x+=i.x*v.inverseMass,v.positionPrev.y+=i.y*v.inverseMass,v.anglePrev+=r.cross(A,i)*v.inverseInertia),y.isStatic||y.isSleeping||(y.positionPrev.x-=i.x*y.inverseMass,y.positionPrev.y-=i.y*y.inverseMass,y.anglePrev-=r.cross(P,i)*y.inverseInertia)}}}}},{"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],11:[function(e,t,n){var o={};t.exports=o;var i=e("../geometry/Vertices"),r=e("../geometry/Vector");o.collides=function(e,t,n){var s,a,l,c,d=!1;if(n){var u=e.parent,p=t.parent,m=u.speed*u.speed+u.angularSpeed*u.angularSpeed+p.speed*p.speed+p.angularSpeed*p.angularSpeed;d=n&&n.collided&&m<.2,c=n}else c={collided:!1,bodyA:e,bodyB:t};if(n&&d){var f=c.axisBody,v=f===e?t:e,y=[f.axes[n.axisNumber]];if(l=o._overlapAxes(f.vertices,v.vertices,y),c.reused=!0,l.overlap<=0)return c.collided=!1,c}else{if((s=o._overlapAxes(e.vertices,t.vertices,e.axes)).overlap<=0)return c.collided=!1,c;if((a=o._overlapAxes(t.vertices,e.vertices,t.axes)).overlap<=0)return c.collided=!1,c;s.overlap<a.overlap?(l=s,c.axisBody=e):(l=a,c.axisBody=t),c.axisNumber=l.axisNumber}c.bodyA=e.id<t.id?e:t,c.bodyB=e.id<t.id?t:e,c.collided=!0,c.depth=l.overlap,c.parentA=c.bodyA.parent,c.parentB=c.bodyB.parent,e=c.bodyA,t=c.bodyB,r.dot(l.axis,r.sub(t.position,e.position))<0?c.normal={x:l.axis.x,y:l.axis.y}:c.normal={x:-l.axis.x,y:-l.axis.y},c.tangent=r.perp(c.normal),c.penetration=c.penetration||{},c.penetration.x=c.normal.x*c.depth,c.penetration.y=c.normal.y*c.depth;var g=o._findSupports(e,t,c.normal),x=[];if(i.contains(e.vertices,g[0])&&x.push(g[0]),i.contains(e.vertices,g[1])&&x.push(g[1]),x.length<2){var h=o._findSupports(t,e,r.neg(c.normal));i.contains(t.vertices,h[0])&&x.push(h[0]),x.length<2&&i.contains(t.vertices,h[1])&&x.push(h[1])}return x.length<1&&(x=[g[0]]),c.supports=x,c},o._overlapAxes=function(e,t,n){for(var i,s,a=r._temp[0],l=r._temp[1],c={overlap:Number.MAX_VALUE},d=0;d<n.length;d++){if(s=n[d],o._projectToAxis(a,e,s),o._projectToAxis(l,t,s),(i=Math.min(a.max-l.min,l.max-a.min))<=0)return c.overlap=i,c;i<c.overlap&&(c.overlap=i,c.axis=s,c.axisNumber=d)}return c},o._projectToAxis=function(e,t,n){for(var o=r.dot(t[0],n),i=o,s=1;s<t.length;s+=1){var a=r.dot(t[s],n);a>i?i=a:a<o&&(o=a)}e.min=o,e.max=i},o._findSupports=function(e,t,n){for(var o,i,s,a,l=Number.MAX_VALUE,c=r._temp[0],d=t.vertices,u=e.position,p=0;p<d.length;p++)i=d[p],c.x=i.x-u.x,c.y=i.y-u.y,(o=-r.dot(n,c))<l&&(l=o,s=i);return i=d[s.index-1>=0?s.index-1:d.length-1],c.x=i.x-u.x,c.y=i.y-u.y,l=-r.dot(n,c),a=i,i=d[(s.index+1)%d.length],c.x=i.x-u.x,c.y=i.y-u.y,(o=-r.dot(n,c))<l&&(a=i),[s,a]}},{"../geometry/Vector":28,"../geometry/Vertices":29}],12:[function(e,t,n){var o={};t.exports=o;var i=e("../geometry/Vertices"),r=e("../geometry/Vector"),s=e("../core/Sleeping"),a=e("../geometry/Bounds"),l=e("../geometry/Axes"),c=e("../core/Common");o._warming=.4,o._torqueDampen=1,o._minLength=1e-6,o.create=function(e){var t=e;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var n=t.bodyA?r.add(t.bodyA.position,t.pointA):t.pointA,o=t.bodyB?r.add(t.bodyB.position,t.pointB):t.pointB,i=r.magnitude(r.sub(n,o));t.length=void 0!==t.length?t.length:i,t.id=t.id||c.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var s={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===t.length&&t.stiffness>.1?(s.type="pin",s.anchors=!1):t.stiffness<.9&&(s.type="spring"),t.render=c.extend(s,t.render),t},o.preSolveAll=function(e){for(var t=0;t<e.length;t+=1){var n=e[t],o=n.constraintImpulse;n.isStatic||0===o.x&&0===o.y&&0===o.angle||(n.position.x+=o.x,n.position.y+=o.y,n.angle+=o.angle)}},o.solveAll=function(e,t){for(var n=0;n<e.length;n+=1){var i=e[n],r=!i.bodyA||i.bodyA&&i.bodyA.isStatic,s=!i.bodyB||i.bodyB&&i.bodyB.isStatic;(r||s)&&o.solve(e[n],t)}for(n=0;n<e.length;n+=1)r=!(i=e[n]).bodyA||i.bodyA&&i.bodyA.isStatic,s=!i.bodyB||i.bodyB&&i.bodyB.isStatic,r||s||o.solve(e[n],t)},o.solve=function(e,t){var n=e.bodyA,i=e.bodyB,s=e.pointA,a=e.pointB;if(n||i){n&&!n.isStatic&&(r.rotate(s,n.angle-e.angleA,s),e.angleA=n.angle),i&&!i.isStatic&&(r.rotate(a,i.angle-e.angleB,a),e.angleB=i.angle);var l=s,c=a;if(n&&(l=r.add(n.position,s)),i&&(c=r.add(i.position,a)),l&&c){var d=r.sub(l,c),u=r.magnitude(d);u<o._minLength&&(u=o._minLength);var p,m,f,v,y,g=(u-e.length)/u,x=e.stiffness<1?e.stiffness*t:e.stiffness,h=r.mult(d,g*x),b=(n?n.inverseMass:0)+(i?i.inverseMass:0),w=b+((n?n.inverseInertia:0)+(i?i.inverseInertia:0));if(e.damping){var S=r.create();f=r.div(d,u),y=r.sub(i&&r.sub(i.position,i.positionPrev)||S,n&&r.sub(n.position,n.positionPrev)||S),v=r.dot(f,y)}n&&!n.isStatic&&(m=n.inverseMass/b,n.constraintImpulse.x-=h.x*m,n.constraintImpulse.y-=h.y*m,n.position.x-=h.x*m,n.position.y-=h.y*m,e.damping&&(n.positionPrev.x-=e.damping*f.x*v*m,n.positionPrev.y-=e.damping*f.y*v*m),p=r.cross(s,h)/w*o._torqueDampen*n.inverseInertia*(1-e.angularStiffness),n.constraintImpulse.angle-=p,n.angle-=p),i&&!i.isStatic&&(m=i.inverseMass/b,i.constraintImpulse.x+=h.x*m,i.constraintImpulse.y+=h.y*m,i.position.x+=h.x*m,i.position.y+=h.y*m,e.damping&&(i.positionPrev.x+=e.damping*f.x*v*m,i.positionPrev.y+=e.damping*f.y*v*m),p=r.cross(a,h)/w*o._torqueDampen*i.inverseInertia*(1-e.angularStiffness),i.constraintImpulse.angle+=p,i.angle+=p)}}},o.postSolveAll=function(e){for(var t=0;t<e.length;t++){var n=e[t],c=n.constraintImpulse;if(!(n.isStatic||0===c.x&&0===c.y&&0===c.angle)){s.set(n,!1);for(var d=0;d<n.parts.length;d++){var u=n.parts[d];i.translate(u.vertices,c),d>0&&(u.position.x+=c.x,u.position.y+=c.y),0!==c.angle&&(i.rotate(u.vertices,c.angle,n.position),l.rotate(u.axes,c.angle),d>0&&r.rotateAbout(u.position,c.angle,n.position,u.position)),a.update(u.bounds,u.vertices,n.velocity)}c.angle*=o._warming,c.x*=o._warming,c.y*=o._warming}}}},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],13:[function(e,t,n){var o={};t.exports=o;var i=e("../geometry/Vertices"),r=e("../core/Sleeping"),s=e("../core/Mouse"),a=e("../core/Events"),l=e("../collision/Detector"),c=e("./Constraint"),d=e("../body/Composite"),u=e("../core/Common"),p=e("../geometry/Bounds");o.create=function(e,t){var n=(e?e.mouse:null)||(t?t.mouse:null);n||(e&&e.render&&e.render.canvas?n=s.create(e.render.canvas):t&&t.element?n=s.create(t.element):(n=s.create(),u.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var i={type:"mouseConstraint",mouse:n,element:null,body:null,constraint:c.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},r=u.extend(i,t);return a.on(e,"beforeUpdate",function(){var t=d.allBodies(e.world);o.update(r,t),o._triggerEvents(r)}),r},o.update=function(e,t){var n=e.mouse,o=e.constraint,s=e.body;if(0===n.button){if(o.bodyB)r.set(o.bodyB,!1),o.pointA=n.position;else for(var c=0;c<t.length;c++)if(s=t[c],p.contains(s.bounds,n.position)&&l.canCollide(s.collisionFilter,e.collisionFilter))for(var d=s.parts.length>1?1:0;d<s.parts.length;d++){var u=s.parts[d];if(i.contains(u.vertices,n.position)){o.pointA=n.position,o.bodyB=e.body=s,o.pointB={x:n.position.x-s.position.x,y:n.position.y-s.position.y},o.angleB=s.angle,r.set(s,!1),a.trigger(e,"startdrag",{mouse:n,body:s});break}}}else o.bodyB=e.body=null,o.pointB=null,s&&a.trigger(e,"enddrag",{mouse:n,body:s})},o._triggerEvents=function(e){var t=e.mouse,n=t.sourceEvents;n.mousemove&&a.trigger(e,"mousemove",{mouse:t}),n.mousedown&&a.trigger(e,"mousedown",{mouse:t}),n.mouseup&&a.trigger(e,"mouseup",{mouse:t}),s.clearSourceEvents(t)}},{"../body/Composite":2,"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../core/Sleeping":22,"../geometry/Bounds":26,"../geometry/Vertices":29,"./Constraint":12}],14:[function(e,n,o){(function(t){var o={};n.exports=o,function(){o._nextId=0,o._seed=0,o._nowStartTime=+new Date,o.extend=function(e,t){var n,i;"boolean"==typeof t?(n=2,i=t):(n=1,i=!0);for(var r=n;r<arguments.length;r++){var s=arguments[r];if(s)for(var a in s)i&&s[a]&&s[a].constructor===Object?e[a]&&e[a].constructor!==Object?e[a]=s[a]:(e[a]=e[a]||{},o.extend(e[a],i,s[a])):e[a]=s[a]}return e},o.clone=function(e,t){return o.extend({},t,e)},o.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)t.push(n);return t},o.values=function(e){var t=[];if(Object.keys){for(var n=Object.keys(e),o=0;o<n.length;o++)t.push(e[n[o]]);return t}for(var i in e)t.push(e[i]);return t},o.get=function(e,t,n,o){t=t.split(".").slice(n,o);for(var i=0;i<t.length;i+=1)e=e[t[i]];return e},o.set=function(e,t,n,i,r){var s=t.split(".").slice(i,r);return o.get(e,t,0,-1)[s[s.length-1]]=n,n},o.shuffle=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(o.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}return e},o.choose=function(e){return e[Math.floor(o.random()*e.length)]},o.isElement=function(e){return"undefined"!=typeof HTMLElement?e instanceof HTMLElement:!!(e&&e.nodeType&&e.nodeName)},o.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o.isFunction=function(e){return"function"==typeof e},o.isPlainObject=function(e){return"object"==typeof e&&e.constructor===Object},o.isString=function(e){return"[object String]"===toString.call(e)},o.clamp=function(e,t,n){return e<t?t:e>n?n:e},o.sign=function(e){return e<0?-1:1},o.now=function(){if(window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return new Date-o._nowStartTime},o.random=function(e,t){return t=void 0!==t?t:1,(e=void 0!==e?e:0)+n()*(t-e)};var n=function(){return o._seed=(9301*o._seed+49297)%233280,o._seed/233280};o.colorToNumber=function(e){return 3==(e=e.replace("#","")).length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},o.logLevel=1,o.log=function(){console&&o.logLevel>0&&o.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},o.info=function(){console&&o.logLevel>0&&o.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},o.warn=function(){console&&o.logLevel>0&&o.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},o.nextId=function(){return o._nextId++},o.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},o.map=function(e,t){if(e.map)return e.map(t);for(var n=[],o=0;o<e.length;o+=1)n.push(t(e[o]));return n},o.topologicalSort=function(e){var t=[],n=[],i=[];for(var r in e)n[r]||i[r]||o._topologicalSort(r,n,i,e,t);return t},o._topologicalSort=function(e,t,n,i,r){var s=i[e]||[];n[e]=!0;for(var a=0;a<s.length;a+=1){var l=s[a];n[l]||(t[l]||o._topologicalSort(l,t,n,i,r))}n[e]=!1,t[e]=!0,r.push(e)},o.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var n=arguments[t];n._chained?e.push.apply(e,n._chained):e.push(n)}var o=function(){for(var t,n=new Array(arguments.length),o=0,i=arguments.length;o<i;o++)n[o]=arguments[o];for(o=0;o<e.length;o+=1){var r=e[o].apply(t,n);void 0!==r&&(t=r)}return t};return o._chained=e,o},o.chainPathBefore=function(e,t,n){return o.set(e,t,o.chain(n,o.get(e,t)))},o.chainPathAfter=function(e,t,n){return o.set(e,t,o.chain(o.get(e,t),n))},o._requireGlobal=function(n,o){return("undefined"!=typeof window?window[n]:void 0!==t?t[n]:null)||e(o)}}()}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],15:[function(e,t,n){var o={};t.exports=o;var i=e("../body/World"),r=e("./Sleeping"),s=e("../collision/Resolver"),a=e("../render/Render"),l=e("../collision/Pairs"),c=(e("./Metrics"),e("../collision/Grid")),d=e("./Events"),u=e("../body/Composite"),p=e("../constraint/Constraint"),m=e("./Common"),f=e("../body/Body");o.create=function(e,t){t=(t=m.isElement(e)?t:e)||{},((e=m.isElement(e)?e:null)||t.render)&&m.warn("Engine.create: engine.render is deprecated (see docs)");var n={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},timing:{timestamp:0,timeScale:1},broadphase:{controller:c}},o=m.extend(n,t);if(e||o.render){var r={element:e,controller:a};o.render=m.extend(r,o.render)}return o.render&&o.render.controller&&(o.render=o.render.controller.create(o.render)),o.render&&(o.render.engine=o),o.world=t.world||i.create(o.world),o.pairs=l.create(),o.broadphase=o.broadphase.controller.create(o.broadphase),o.metrics=o.metrics||{extended:!1},o},o.update=function(e,t,n){t=t||1e3/60,n=n||1;var i,a=e.world,c=e.timing,m=e.broadphase,f=[];c.timestamp+=t*c.timeScale;var v={timestamp:c.timestamp};d.trigger(e,"beforeUpdate",v);var y=u.allBodies(a),g=u.allConstraints(a);for(e.enableSleeping&&r.update(y,c.timeScale),o._bodiesApplyGravity(y,a.gravity),o._bodiesUpdate(y,t,c.timeScale,n,a.bounds),p.preSolveAll(y),i=0;i<e.constraintIterations;i++)p.solveAll(g,c.timeScale);p.postSolveAll(y),m.controller?(a.isModified&&m.controller.clear(m),m.controller.update(m,y,e,a.isModified),f=m.pairsList):f=y,a.isModified&&u.setModified(a,!1,!1,!0);var x=m.detector(f,e),h=e.pairs,b=c.timestamp;for(l.update(h,x,b),l.removeOld(h,b),e.enableSleeping&&r.afterCollisions(h.list,c.timeScale),h.collisionStart.length>0&&d.trigger(e,"collisionStart",{pairs:h.collisionStart}),s.preSolvePosition(h.list),i=0;i<e.positionIterations;i++)s.solvePosition(h.list,c.timeScale);for(s.postSolvePosition(y),p.preSolveAll(y),i=0;i<e.constraintIterations;i++)p.solveAll(g,c.timeScale);for(p.postSolveAll(y),s.preSolveVelocity(h.list),i=0;i<e.velocityIterations;i++)s.solveVelocity(h.list,c.timeScale);return h.collisionActive.length>0&&d.trigger(e,"collisionActive",{pairs:h.collisionActive}),h.collisionEnd.length>0&&d.trigger(e,"collisionEnd",{pairs:h.collisionEnd}),o._bodiesClearForces(y),d.trigger(e,"afterUpdate",v),e},o.merge=function(e,t){if(m.extend(e,t),t.world){e.world=t.world,o.clear(e);for(var n=u.allBodies(e.world),i=0;i<n.length;i++){var s=n[i];r.set(s,!1),s.id=m.nextId()}}},o.clear=function(e){var t=e.world;l.clear(e.pairs);var n=e.broadphase;if(n.controller){var o=u.allBodies(t);n.controller.clear(n),n.controller.update(n,o,e,!0)}},o._bodiesClearForces=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.force.x=0,n.force.y=0,n.torque=0}},o._bodiesApplyGravity=function(e,t){var n=void 0!==t.scale?t.scale:.001;if((0!==t.x||0!==t.y)&&0!==n)for(var o=0;o<e.length;o++){var i=e[o];i.isStatic||i.isSleeping||(i.force.y+=i.mass*t.y*n,i.force.x+=i.mass*t.x*n)}},o._bodiesUpdate=function(e,t,n,o,i){for(var r=0;r<e.length;r++){var s=e[r];s.isStatic||s.isSleeping||f.update(s,t,n,o)}}},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":31,"./Common":14,"./Events":16,"./Metrics":18,"./Sleeping":22}],16:[function(e,t,n){var o={};t.exports=o;var i=e("./Common");o.on=function(e,t,n){for(var o,i=t.split(" "),r=0;r<i.length;r++)o=i[r],e.events=e.events||{},e.events[o]=e.events[o]||[],e.events[o].push(n);return n},o.off=function(e,t,n){if(t){"function"==typeof t&&(n=t,t=i.keys(e.events).join(" "));for(var o=t.split(" "),r=0;r<o.length;r++){var s=e.events[o[r]],a=[];if(n&&s)for(var l=0;l<s.length;l++)s[l]!==n&&a.push(s[l]);e.events[o[r]]=a}}else e.events={}},o.trigger=function(e,t,n){var o,r,s,a;if(e.events){n||(n={}),o=t.split(" ");for(var l=0;l<o.length;l++)if(r=o[l],s=e.events[r]){(a=i.clone(n,!1)).name=r,a.source=e;for(var c=0;c<s.length;c++)s[c].apply(e,[a])}}}},{"./Common":14}],17:[function(e,t,n){var o={};t.exports=o;var i=e("./Plugin"),r=e("./Common");o.name="matter-js",o.version="0.14.2",o.uses=[],o.used=[],o.use=function(){i.use(o,Array.prototype.slice.call(arguments))},o.before=function(e,t){return e=e.replace(/^Matter./,""),r.chainPathBefore(o,e,t)},o.after=function(e,t){return e=e.replace(/^Matter./,""),r.chainPathAfter(o,e,t)}},{"./Common":14,"./Plugin":20}],18:[function(e,t,n){},{"../body/Composite":2,"./Common":14}],19:[function(e,t,n){var o={};t.exports=o;var i=e("../core/Common");o.create=function(e){var t={};return e||i.log("Mouse.create: element was undefined, defaulting to document.body","warn"),t.element=e||document.body,t.absolute={x:0,y:0},t.position={x:0,y:0},t.mousedownPosition={x:0,y:0},t.mouseupPosition={x:0,y:0},t.offset={x:0,y:0},t.scale={x:1,y:1},t.wheelDelta=0,t.button=-1,t.pixelRatio=t.element.getAttribute("data-pixel-ratio")||1,t.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},t.mousemove=function(e){var n=o._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&(t.button=0,e.preventDefault()),t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.sourceEvents.mousemove=e},t.mousedown=function(e){var n=o._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches?(t.button=0,e.preventDefault()):t.button=e.button,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mousedownPosition.x=t.position.x,t.mousedownPosition.y=t.position.y,t.sourceEvents.mousedown=e},t.mouseup=function(e){var n=o._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&e.preventDefault(),t.button=-1,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mouseupPosition.x=t.position.x,t.mouseupPosition.y=t.position.y,t.sourceEvents.mouseup=e},t.mousewheel=function(e){t.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},o.setElement(t,t.element),t},o.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},o.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},o.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},o.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},o._getRelativeMousePosition=function(e,t,n){var o,i,r=t.getBoundingClientRect(),s=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:s.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:s.scrollTop,c=e.changedTouches;return c?(o=c[0].pageX-r.left-a,i=c[0].pageY-r.top-l):(o=e.pageX-r.left-a,i=e.pageY-r.top-l),{x:o/(t.clientWidth/(t.width||t.clientWidth)*n),y:i/(t.clientHeight/(t.height||t.clientHeight)*n)}}},{"../core/Common":14}],20:[function(e,t,n){var o={};t.exports=o;var i=e("./Common");o._registry={},o.register=function(e){if(o.isPlugin(e)||i.warn("Plugin.register:",o.toString(e),"does not implement all required fields."),e.name in o._registry){var t=o._registry[e.name],n=o.versionParse(e.version).number,r=o.versionParse(t.version).number;n>r?(i.warn("Plugin.register:",o.toString(t),"was upgraded to",o.toString(e)),o._registry[e.name]=e):n<r?i.warn("Plugin.register:",o.toString(t),"can not be downgraded to",o.toString(e)):e!==t&&i.warn("Plugin.register:",o.toString(e),"is already registered to different plugin object")}else o._registry[e.name]=e;return e},o.resolve=function(e){return o._registry[o.dependencyParse(e).name]},o.toString=function(e){return"string"==typeof e?e:(e.name||"anonymous")+"@"+(e.version||e.range||"0.0.0")},o.isPlugin=function(e){return e&&e.name&&e.version&&e.install},o.isUsed=function(e,t){return e.used.indexOf(t)>-1},o.isFor=function(e,t){var n=e.for&&o.dependencyParse(e.for);return!e.for||t.name===n.name&&o.versionSatisfies(t.version,n.range)},o.use=function(e,t){if(e.uses=(e.uses||[]).concat(t||[]),0!==e.uses.length){for(var n=o.dependencies(e),r=i.topologicalSort(n),s=[],a=0;a<r.length;a+=1)if(r[a]!==e.name){var l=o.resolve(r[a]);l?o.isUsed(e,l.name)||(o.isFor(l,e)||(i.warn("Plugin.use:",o.toString(l),"is for",l.for,"but installed on",o.toString(e)+"."),l._warned=!0),l.install?l.install(e):(i.warn("Plugin.use:",o.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(s.push(" "+o.toString(l)),delete l._warned):s.push(" "+o.toString(l)),e.used.push(l.name)):s.push(" "+r[a])}s.length>0&&i.info(s.join("  "))}else i.warn("Plugin.use:",o.toString(e),"does not specify any dependencies to install.")},o.dependencies=function(e,t){var n=o.dependencyParse(e),r=n.name;if(!(r in(t=t||{}))){e=o.resolve(e)||e,t[r]=i.map(e.uses||[],function(t){o.isPlugin(t)&&o.register(t);var r=o.dependencyParse(t),s=o.resolve(t);return s&&!o.versionSatisfies(s.version,r.range)?(i.warn("Plugin.dependencies:",o.toString(s),"does not satisfy",o.toString(r),"used by",o.toString(n)+"."),s._warned=!0,e._warned=!0):s||(i.warn("Plugin.dependencies:",o.toString(t),"used by",o.toString(n),"could not be resolved."),e._warned=!0),r.name});for(var s=0;s<t[r].length;s+=1)o.dependencies(t[r][s],t);return t}},o.dependencyParse=function(e){return i.isString(e)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/.test(e)||i.warn("Plugin.dependencyParse:",e,"is not a valid dependency string."),{name:e.split("@")[0],range:e.split("@")[1]||"*"}):{name:e.name,range:e.range||e.version}},o.versionParse=function(e){/^\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?$/.test(e)||i.warn("Plugin.versionParse:",e,"is not a valid version or range.");var t=e.split("-");e=t[0];var n=isNaN(Number(e[0])),o=n?e.substr(1):e,r=i.map(o.split("."),function(e){return Number(e)});return{isRange:n,version:o,range:e,operator:n?e[0]:"",parts:r,prerelease:t[1],number:1e8*r[0]+1e4*r[1]+r[2]}},o.versionSatisfies=function(e,t){t=t||"*";var n=o.versionParse(t),i=n.parts,r=o.versionParse(e),s=r.parts;if(n.isRange){if("*"===n.operator||"*"===e)return!0;if("~"===n.operator)return s[0]===i[0]&&s[1]===i[1]&&s[2]>=i[2];if("^"===n.operator)return i[0]>0?s[0]===i[0]&&r.number>=n.number:i[1]>0?s[1]===i[1]&&s[2]>=i[2]:s[2]===i[2]}return e===t||"*"===e}},{"./Common":14}],21:[function(e,t,n){var o={};t.exports=o;var i=e("./Events"),r=e("./Engine"),s=e("./Common");!function(){var e,t,n;("undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e)||(e=function(e){n=setTimeout(function(){e(s.now())},1e3/60)},t=function(){clearTimeout(n)});o.create=function(e){var t=s.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},e);return t.delta=t.delta||1e3/t.fps,t.deltaMin=t.deltaMin||1e3/t.fps,t.deltaMax=t.deltaMax||1e3/(.5*t.fps),t.fps=1e3/t.delta,t},o.run=function(t,n){return void 0!==t.positionIterations&&(n=t,t=o.create()),function i(r){t.frameRequestId=e(i),r&&t.enabled&&o.tick(t,n,r)}(),t},o.tick=function(e,t,n){var o,s=t.timing,a=1,l={timestamp:s.timestamp};i.trigger(e,"beforeTick",l),i.trigger(t,"beforeTick",l),e.isFixed?o=e.delta:(o=n-e.timePrev||e.delta,e.timePrev=n,e.deltaHistory.push(o),e.deltaHistory=e.deltaHistory.slice(-e.deltaSampleSize),a=(o=(o=(o=Math.min.apply(null,e.deltaHistory))<e.deltaMin?e.deltaMin:o)>e.deltaMax?e.deltaMax:o)/e.delta,e.delta=o),0!==e.timeScalePrev&&(a*=s.timeScale/e.timeScalePrev),0===s.timeScale&&(a=0),e.timeScalePrev=s.timeScale,e.correction=a,e.frameCounter+=1,n-e.counterTimestamp>=1e3&&(e.fps=e.frameCounter*((n-e.counterTimestamp)/1e3),e.counterTimestamp=n,e.frameCounter=0),i.trigger(e,"tick",l),i.trigger(t,"tick",l),t.world.isModified&&t.render&&t.render.controller&&t.render.controller.clear&&t.render.controller.clear(t.render),i.trigger(e,"beforeUpdate",l),r.update(t,o,a),i.trigger(e,"afterUpdate",l),t.render&&t.render.controller&&(i.trigger(e,"beforeRender",l),i.trigger(t,"beforeRender",l),t.render.controller.world(t.render),i.trigger(e,"afterRender",l),i.trigger(t,"afterRender",l)),i.trigger(e,"afterTick",l),i.trigger(t,"afterTick",l)},o.stop=function(e){t(e.frameRequestId)},o.start=function(e,t){o.run(e,t)}}()},{"./Common":14,"./Engine":15,"./Events":16}],22:[function(e,t,n){var o={};t.exports=o;var i=e("./Events");o._motionWakeThreshold=.18,o._motionSleepThreshold=.08,o._minBias=.9,o.update=function(e,t){for(var n=t*t*t,i=0;i<e.length;i++){var r=e[i],s=r.speed*r.speed+r.angularSpeed*r.angularSpeed;if(0===r.force.x&&0===r.force.y){var a=Math.min(r.motion,s),l=Math.max(r.motion,s);r.motion=o._minBias*a+(1-o._minBias)*l,r.sleepThreshold>0&&r.motion<o._motionSleepThreshold*n?(r.sleepCounter+=1,r.sleepCounter>=r.sleepThreshold&&o.set(r,!0)):r.sleepCounter>0&&(r.sleepCounter-=1)}else o.set(r,!1)}},o.afterCollisions=function(e,t){for(var n=t*t*t,i=0;i<e.length;i++){var r=e[i];if(r.isActive){var s=r.collision,a=s.bodyA.parent,l=s.bodyB.parent;if(!(a.isSleeping&&l.isSleeping||a.isStatic||l.isStatic)&&(a.isSleeping||l.isSleeping)){var c=a.isSleeping&&!a.isStatic?a:l,d=c===a?l:a;!c.isStatic&&d.motion>o._motionWakeThreshold*n&&o.set(c,!1)}}}},o.set=function(e,t){var n=e.isSleeping;t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0,n||i.trigger(e,"sleepStart")):(e.isSleeping=!1,e.sleepCounter=0,n&&i.trigger(e,"sleepEnd"))}},{"./Events":16}],23:[function(e,t,n){var o={};t.exports=o;var i,r=e("../geometry/Vertices"),s=e("../core/Common"),a=e("../body/Body"),l=e("../geometry/Bounds"),c=e("../geometry/Vector");o.rectangle=function(e,t,n,o,i){i=i||{};var l={label:"Rectangle Body",position:{x:e,y:t},vertices:r.fromPath("L 0 0 L "+n+" 0 L "+n+" "+o+" L 0 "+o)};if(i.chamfer){var c=i.chamfer;l.vertices=r.chamfer(l.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete i.chamfer}return a.create(s.extend({},l,i))},o.trapezoid=function(e,t,n,o,i,l){l=l||{};var c,d=n*(i*=.5),u=d+(1-2*i)*n,p=u+d;c=i<.5?"L 0 0 L "+d+" "+-o+" L "+u+" "+-o+" L "+p+" 0":"L 0 0 L "+u+" "+-o+" L "+p+" 0";var m={label:"Trapezoid Body",position:{x:e,y:t},vertices:r.fromPath(c)};if(l.chamfer){var f=l.chamfer;m.vertices=r.chamfer(m.vertices,f.radius,f.quality,f.qualityMin,f.qualityMax),delete l.chamfer}return a.create(s.extend({},m,l))},o.circle=function(e,t,n,i,r){i=i||{};var a={label:"Circle Body",circleRadius:n};r=r||25;var l=Math.ceil(Math.max(10,Math.min(r,n)));return l%2==1&&(l+=1),o.polygon(e,t,l,n,s.extend({},a,i))},o.polygon=function(e,t,n,i,l){if(l=l||{},n<3)return o.circle(e,t,i,l);for(var c=2*Math.PI/n,d="",u=.5*c,p=0;p<n;p+=1){var m=u+p*c,f=Math.cos(m)*i,v=Math.sin(m)*i;d+="L "+f.toFixed(3)+" "+v.toFixed(3)+" "}var y={label:"Polygon Body",position:{x:e,y:t},vertices:r.fromPath(d)};if(l.chamfer){var g=l.chamfer;y.vertices=r.chamfer(y.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete l.chamfer}return a.create(s.extend({},y,l))},o.fromVertices=function(e,t,n,o,d,u,p){var m,f,v,y,g,x,h,b,w;for(i||(i=s._requireGlobal("decomp","poly-decomp")),o=o||{},f=[],d=void 0!==d&&d,u=void 0!==u?u:.01,p=void 0!==p?p:10,i||s.warn("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull."),s.isArray(n[0])||(n=[n]),b=0;b<n.length;b+=1)if(y=n[b],(v=r.isConvex(y))||!i)y=v?r.clockwiseSort(y):r.hull(y),f.push({position:{x:e,y:t},vertices:y});else{var S=y.map(function(e){return[e.x,e.y]});i.makeCCW(S),!1!==u&&i.removeCollinearPoints(S,u);var C=i.quickDecomp(S);for(g=0;g<C.length;g++){var A=C[g].map(function(e){return{x:e[0],y:e[1]}});p>0&&r.area(A)<p||f.push({position:r.centre(A),vertices:A})}}for(g=0;g<f.length;g++)f[g]=a.create(s.extend(f[g],o));if(d)for(g=0;g<f.length;g++){var P=f[g];for(x=g+1;x<f.length;x++){var B=f[x];if(l.overlaps(P.bounds,B.bounds)){var M=P.vertices,k=B.vertices;for(h=0;h<P.vertices.length;h++)for(w=0;w<B.vertices.length;w++){var I=c.magnitudeSquared(c.sub(M[(h+1)%M.length],k[w])),_=c.magnitudeSquared(c.sub(M[h],k[(w+1)%k.length]));I<5&&_<5&&(M[h].isInternal=!0,k[w].isInternal=!0)}}}}return f.length>1?(m=a.create(s.extend({parts:f.slice(0)},o)),a.setPosition(m,{x:e,y:t}),m):f[0]}},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],24:[function(e,t,n){var o={};t.exports=o;var i=e("../body/Composite"),r=e("../constraint/Constraint"),s=e("../core/Common"),a=e("../body/Body"),l=e("./Bodies");o.stack=function(e,t,n,o,r,s,l){for(var c,d=i.create({label:"Stack"}),u=e,p=t,m=0,f=0;f<o;f++){for(var v=0,y=0;y<n;y++){var g=l(u,p,y,f,c,m);if(g){var x=g.bounds.max.y-g.bounds.min.y,h=g.bounds.max.x-g.bounds.min.x;x>v&&(v=x),a.translate(g,{x:.5*h,y:.5*x}),u=g.bounds.max.x+r,i.addBody(d,g),c=g,m+=1}else u+=r}p+=v+s,u=e}return d},o.chain=function(e,t,n,o,a,l){for(var c=e.bodies,d=1;d<c.length;d++){var u=c[d-1],p=c[d],m=u.bounds.max.y-u.bounds.min.y,f=u.bounds.max.x-u.bounds.min.x,v=p.bounds.max.y-p.bounds.min.y,y={bodyA:u,pointA:{x:f*t,y:m*n},bodyB:p,pointB:{x:(p.bounds.max.x-p.bounds.min.x)*o,y:v*a}},g=s.extend(y,l);i.addConstraint(e,r.create(g))}return e.label+=" Chain",e},o.mesh=function(e,t,n,o,a){var l,c,d,u,p,m=e.bodies;for(l=0;l<n;l++){for(c=1;c<t;c++)d=m[c-1+l*t],u=m[c+l*t],i.addConstraint(e,r.create(s.extend({bodyA:d,bodyB:u},a)));if(l>0)for(c=0;c<t;c++)d=m[c+(l-1)*t],u=m[c+l*t],i.addConstraint(e,r.create(s.extend({bodyA:d,bodyB:u},a))),o&&c>0&&(p=m[c-1+(l-1)*t],i.addConstraint(e,r.create(s.extend({bodyA:p,bodyB:u},a)))),o&&c<t-1&&(p=m[c+1+(l-1)*t],i.addConstraint(e,r.create(s.extend({bodyA:p,bodyB:u},a))))}return e.label+=" Mesh",e},o.pyramid=function(e,t,n,i,r,s,l){return o.stack(e,t,n,i,r,s,function(t,o,s,c,d,u){var p=Math.min(i,Math.ceil(n/2)),m=d?d.bounds.max.x-d.bounds.min.x:0;if(!(c>p||s<(c=p-c)||s>n-1-c))return 1===u&&a.translate(d,{x:(s+(n%2==1?1:-1))*m,y:0}),l(e+(d?s*m:0)+s*r,o,s,c,d,u)})},o.newtonsCradle=function(e,t,n,o,s){for(var a=i.create({label:"Newtons Cradle"}),c=0;c<n;c++){var d=l.circle(e+c*(1.9*o),t+s,o,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),u=r.create({pointA:{x:e+c*(1.9*o),y:t},bodyB:d});i.addBody(a,d),i.addConstraint(a,u)}return a},o.car=function(e,t,n,o,s){var c=a.nextGroup(!0),d=.5*-n+20,u=.5*n-20,p=i.create({label:"Car"}),m=l.rectangle(e,t,n,o,{collisionFilter:{group:c},chamfer:{radius:.5*o},density:2e-4}),f=l.circle(e+d,t+0,s,{collisionFilter:{group:c},friction:.8}),v=l.circle(e+u,t+0,s,{collisionFilter:{group:c},friction:.8}),y=r.create({bodyB:m,pointB:{x:d,y:0},bodyA:f,stiffness:1,length:0}),g=r.create({bodyB:m,pointB:{x:u,y:0},bodyA:v,stiffness:1,length:0});return i.addBody(p,m),i.addBody(p,f),i.addBody(p,v),i.addConstraint(p,y),i.addConstraint(p,g),p},o.softBody=function(e,t,n,i,r,a,c,d,u,p){u=s.extend({inertia:1/0},u),p=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},p);var m=o.stack(e,t,n,i,r,a,function(e,t){return l.circle(e,t,d,u)});return o.mesh(m,n,i,c,p),m.label="Soft Body",m}},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":23}],25:[function(e,t,n){var o={};t.exports=o;var i=e("../geometry/Vector"),r=e("../core/Common");o.fromVertices=function(e){for(var t={},n=0;n<e.length;n++){var o=(n+1)%e.length,s=i.normalise({x:e[o].y-e[n].y,y:e[n].x-e[o].x}),a=0===s.y?1/0:s.x/s.y;t[a=a.toFixed(3).toString()]=s}return r.values(t)},o.rotate=function(e,t){if(0!==t)for(var n=Math.cos(t),o=Math.sin(t),i=0;i<e.length;i++){var r,s=e[i];r=s.x*n-s.y*o,s.y=s.x*o+s.y*n,s.x=r}}},{"../core/Common":14,"../geometry/Vector":28}],26:[function(e,t,n){var o={};t.exports=o,o.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&o.update(t,e),t},o.update=function(e,t,n){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var o=0;o<t.length;o++){var i=t[o];i.x>e.max.x&&(e.max.x=i.x),i.x<e.min.x&&(e.min.x=i.x),i.y>e.max.y&&(e.max.y=i.y),i.y<e.min.y&&(e.min.y=i.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},o.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},o.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},o.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},o.shift=function(e,t){var n=e.max.x-e.min.x,o=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+n,e.min.y=t.y,e.max.y=t.y+o}},{}],27:[function(e,t,n){var o={};t.exports=o;e("../geometry/Bounds");var i=e("../core/Common");o.pathToVertices=function(e,t){"undefined"==typeof window||"SVGPathSeg"in window||i.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var n,r,s,a,l,c,d,u,p,m,f,v=[],y=0,g=0,x=0;t=t||15;var h=function(e,t,n){var o=n%2==1&&n>1;if(!p||e!=p.x||t!=p.y){p&&o?(m=p.x,f=p.y):(m=0,f=0);var i={x:m+e,y:f+t};!o&&p||(p=i),v.push(i),g=m+e,x=f+t}},b=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":g=e.x,x=e.y;break;case"H":g=e.x;break;case"V":x=e.y}h(g,x,e.pathSegType)}};for(o._svgPathToAbsolute(e),s=e.getTotalLength(),c=[],n=0;n<e.pathSegList.numberOfItems;n+=1)c.push(e.pathSegList.getItem(n));for(d=c.concat();y<s;){if((l=c[e.getPathSegAtLength(y)])!=u){for(;d.length&&d[0]!=l;)b(d.shift());u=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=e.getPointAtLength(y),h(a.x,a.y,0)}y+=t}for(n=0,r=d.length;n<r;++n)b(d[n]);return v},o._svgPathToAbsolute=function(e){for(var t,n,o,i,r,s,a=e.pathSegList,l=0,c=0,d=a.numberOfItems,u=0;u<d;++u){var p=a.getItem(u),m=p.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(m))"x"in p&&(l=p.x),"y"in p&&(c=p.y);else switch("x1"in p&&(o=l+p.x1),"x2"in p&&(r=l+p.x2),"y1"in p&&(i=c+p.y1),"y2"in p&&(s=c+p.y2),"x"in p&&(l+=p.x),"y"in p&&(c+=p.y),m){case"m":a.replaceItem(e.createSVGPathSegMovetoAbs(l,c),u);break;case"l":a.replaceItem(e.createSVGPathSegLinetoAbs(l,c),u);break;case"h":a.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(l),u);break;case"v":a.replaceItem(e.createSVGPathSegLinetoVerticalAbs(c),u);break;case"c":a.replaceItem(e.createSVGPathSegCurvetoCubicAbs(l,c,o,i,r,s),u);break;case"s":a.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(l,c,r,s),u);break;case"q":a.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(l,c,o,i),u);break;case"t":a.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(l,c),u);break;case"a":a.replaceItem(e.createSVGPathSegArcAbs(l,c,p.r1,p.r2,p.angle,p.largeArcFlag,p.sweepFlag),u);break;case"z":case"Z":l=t,c=n}"M"!=m&&"m"!=m||(t=l,n=c)}}},{"../core/Common":14,"../geometry/Bounds":26}],28:[function(e,t,n){var o={};t.exports=o,o.create=function(e,t){return{x:e||0,y:t||0}},o.clone=function(e){return{x:e.x,y:e.y}},o.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},o.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},o.rotate=function(e,t,n){var o=Math.cos(t),i=Math.sin(t);n||(n={});var r=e.x*o-e.y*i;return n.y=e.x*i+e.y*o,n.x=r,n},o.rotateAbout=function(e,t,n,o){var i=Math.cos(t),r=Math.sin(t);o||(o={});var s=n.x+((e.x-n.x)*i-(e.y-n.y)*r);return o.y=n.y+((e.x-n.x)*r+(e.y-n.y)*i),o.x=s,o},o.normalise=function(e){var t=o.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},o.dot=function(e,t){return e.x*t.x+e.y*t.y},o.cross=function(e,t){return e.x*t.y-e.y*t.x},o.cross3=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)},o.add=function(e,t,n){return n||(n={}),n.x=e.x+t.x,n.y=e.y+t.y,n},o.sub=function(e,t,n){return n||(n={}),n.x=e.x-t.x,n.y=e.y-t.y,n},o.mult=function(e,t){return{x:e.x*t,y:e.y*t}},o.div=function(e,t){return{x:e.x/t,y:e.y/t}},o.perp=function(e,t){return{x:(t=!0===t?-1:1)*-e.y,y:t*e.x}},o.neg=function(e){return{x:-e.x,y:-e.y}},o.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},o._temp=[o.create(),o.create(),o.create(),o.create(),o.create(),o.create()]},{}],29:[function(e,t,n){var o={};t.exports=o;var i=e("../geometry/Vector"),r=e("../core/Common");o.create=function(e,t){for(var n=[],o=0;o<e.length;o++){var i=e[o],r={x:i.x,y:i.y,index:o,body:t,isInternal:!1};n.push(r)}return n},o.fromPath=function(e,t){var n=[];return e.replace(/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,function(e,t,o){n.push({x:parseFloat(t),y:parseFloat(o)})}),o.create(n,t)},o.centre=function(e){for(var t,n,r,s=o.area(e,!0),a={x:0,y:0},l=0;l<e.length;l++)r=(l+1)%e.length,t=i.cross(e[l],e[r]),n=i.mult(i.add(e[l],e[r]),t),a=i.add(a,n);return i.div(a,6*s)},o.mean=function(e){for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y;return i.div(t,e.length)},o.area=function(e,t){for(var n=0,o=e.length-1,i=0;i<e.length;i++)n+=(e[o].x-e[i].x)*(e[o].y+e[i].y),o=i;return t?n/2:Math.abs(n)/2},o.inertia=function(e,t){for(var n,o,r=0,s=0,a=e,l=0;l<a.length;l++)o=(l+1)%a.length,r+=(n=Math.abs(i.cross(a[o],a[l])))*(i.dot(a[o],a[o])+i.dot(a[o],a[l])+i.dot(a[l],a[l])),s+=n;return t/6*(r/s)},o.translate=function(e,t,n){var o;if(n)for(o=0;o<e.length;o++)e[o].x+=t.x*n,e[o].y+=t.y*n;else for(o=0;o<e.length;o++)e[o].x+=t.x,e[o].y+=t.y;return e},o.rotate=function(e,t,n){if(0!==t){for(var o=Math.cos(t),i=Math.sin(t),r=0;r<e.length;r++){var s=e[r],a=s.x-n.x,l=s.y-n.y;s.x=n.x+(a*o-l*i),s.y=n.y+(a*i+l*o)}return e}},o.contains=function(e,t){for(var n=0;n<e.length;n++){var o=e[n],i=e[(n+1)%e.length];if((t.x-o.x)*(i.y-o.y)+(t.y-o.y)*(o.x-i.x)>0)return!1}return!0},o.scale=function(e,t,n,r){if(1===t&&1===n)return e;var s,a;r=r||o.centre(e);for(var l=0;l<e.length;l++)s=e[l],a=i.sub(s,r),e[l].x=r.x+a.x*t,e[l].y=r.y+a.y*n;return e},o.chamfer=function(e,t,n,o,s){t="number"==typeof t?[t]:t||[8],n=void 0!==n?n:-1,o=o||2,s=s||14;for(var a=[],l=0;l<e.length;l++){var c=e[l-1>=0?l-1:e.length-1],d=e[l],u=e[(l+1)%e.length],p=t[l<t.length?l:t.length-1];if(0!==p){var m=i.normalise({x:d.y-c.y,y:c.x-d.x}),f=i.normalise({x:u.y-d.y,y:d.x-u.x}),v=Math.sqrt(2*Math.pow(p,2)),y=i.mult(r.clone(m),p),g=i.normalise(i.mult(i.add(m,f),.5)),x=i.sub(d,i.mult(g,v)),h=n;-1===n&&(h=1.75*Math.pow(p,.32)),(h=r.clamp(h,o,s))%2==1&&(h+=1);for(var b=Math.acos(i.dot(m,f))/h,w=0;w<h;w++)a.push(i.add(i.rotate(y,b*w),x))}else a.push(d)}return a},o.clockwiseSort=function(e){var t=o.mean(e);return e.sort(function(e,n){return i.angle(t,e)-i.angle(t,n)}),e},o.isConvex=function(e){var t,n,o,i,r=0,s=e.length;if(s<3)return null;for(t=0;t<s;t++)if(o=(t+2)%s,i=(e[n=(t+1)%s].x-e[t].x)*(e[o].y-e[n].y),(i-=(e[n].y-e[t].y)*(e[o].x-e[n].x))<0?r|=1:i>0&&(r|=2),3===r)return!1;return 0!==r||null},o.hull=function(e){var t,n,o=[],r=[];for((e=e.slice(0)).sort(function(e,t){var n=e.x-t.x;return 0!==n?n:e.y-t.y}),n=0;n<e.length;n+=1){for(t=e[n];r.length>=2&&i.cross3(r[r.length-2],r[r.length-1],t)<=0;)r.pop();r.push(t)}for(n=e.length-1;n>=0;n-=1){for(t=e[n];o.length>=2&&i.cross3(o[o.length-2],o[o.length-1],t)<=0;)o.pop();o.push(t)}return o.pop(),r.pop(),o.concat(r)}},{"../core/Common":14,"../geometry/Vector":28}],30:[function(e,t,n){var o=t.exports=e("../core/Matter");o.Body=e("../body/Body"),o.Composite=e("../body/Composite"),o.World=e("../body/World"),o.Contact=e("../collision/Contact"),o.Detector=e("../collision/Detector"),o.Grid=e("../collision/Grid"),o.Pairs=e("../collision/Pairs"),o.Pair=e("../collision/Pair"),o.Query=e("../collision/Query"),o.Resolver=e("../collision/Resolver"),o.SAT=e("../collision/SAT"),o.Constraint=e("../constraint/Constraint"),o.MouseConstraint=e("../constraint/MouseConstraint"),o.Common=e("../core/Common"),o.Engine=e("../core/Engine"),o.Events=e("../core/Events"),o.Mouse=e("../core/Mouse"),o.Runner=e("../core/Runner"),o.Sleeping=e("../core/Sleeping"),o.Plugin=e("../core/Plugin"),o.Bodies=e("../factory/Bodies"),o.Composites=e("../factory/Composites"),o.Axes=e("../geometry/Axes"),o.Bounds=e("../geometry/Bounds"),o.Svg=e("../geometry/Svg"),o.Vector=e("../geometry/Vector"),o.Vertices=e("../geometry/Vertices"),o.Render=e("../render/Render"),o.RenderPixi=e("../render/RenderPixi"),o.World.add=o.Composite.add,o.World.remove=o.Composite.remove,o.World.addComposite=o.Composite.addComposite,o.World.addBody=o.Composite.addBody,o.World.addConstraint=o.Composite.addConstraint,o.World.clear=o.Composite.clear,o.Engine.run=o.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Matter":17,"../core/Metrics":18,"../core/Mouse":19,"../core/Plugin":20,"../core/Runner":21,"../core/Sleeping":22,"../factory/Bodies":23,"../factory/Composites":24,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Svg":27,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31,"../render/RenderPixi":32}],31:[function(e,t,n){var o={};t.exports=o;var i=e("../core/Common"),r=e("../body/Composite"),s=e("../geometry/Bounds"),a=e("../core/Events"),l=e("../collision/Grid"),c=e("../geometry/Vector"),d=e("../core/Mouse");!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(i.now())},1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),o.create=function(e){var t={controller:o,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#18181d",wireframeBackground:"#0f0f13",hasBounds:!!e.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},r=i.extend(t,e);return r.canvas&&(r.canvas.width=r.options.width||r.canvas.width,r.canvas.height=r.options.height||r.canvas.height),r.mouse=e.mouse,r.engine=e.engine,r.canvas=r.canvas||n(r.options.width,r.options.height),r.context=r.canvas.getContext("2d"),r.textures={},r.bounds=r.bounds||{min:{x:0,y:0},max:{x:r.canvas.width,y:r.canvas.height}},1!==r.options.pixelRatio&&o.setPixelRatio(r,r.options.pixelRatio),i.isElement(r.element)?r.element.appendChild(r.canvas):r.canvas.parentNode||i.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),r},o.run=function(t){!function n(i){t.frameRequestId=e(n),o.world(t)}()},o.stop=function(e){t(e.frameRequestId)},o.setPixelRatio=function(e,t){var n=e.options,o=e.canvas;"auto"===t&&(t=u(o)),n.pixelRatio=t,o.setAttribute("data-pixel-ratio",t),o.width=n.width*t,o.height=n.height*t,o.style.width=n.width+"px",o.style.height=n.height+"px",e.context.scale(t,t)},o.lookAt=function(e,t,n,o){o=void 0===o||o,t=i.isArray(t)?t:[t],n=n||{x:0,y:0};for(var r={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},s=0;s<t.length;s+=1){var a=t[s],l=a.bounds?a.bounds.min:a.min||a.position||a,c=a.bounds?a.bounds.max:a.max||a.position||a;l&&c&&(l.x<r.min.x&&(r.min.x=l.x),c.x>r.max.x&&(r.max.x=c.x),l.y<r.min.y&&(r.min.y=l.y),c.y>r.max.y&&(r.max.y=c.y))}var u=r.max.x-r.min.x+2*n.x,p=r.max.y-r.min.y+2*n.y,m=e.canvas.height,f=e.canvas.width/m,v=u/p,y=1,g=1;v>f?g=v/f:y=f/v,e.options.hasBounds=!0,e.bounds.min.x=r.min.x,e.bounds.max.x=r.min.x+u*y,e.bounds.min.y=r.min.y,e.bounds.max.y=r.min.y+p*g,o&&(e.bounds.min.x+=.5*u-u*y*.5,e.bounds.max.x+=.5*u-u*y*.5,e.bounds.min.y+=.5*p-p*g*.5,e.bounds.max.y+=.5*p-p*g*.5),e.bounds.min.x-=n.x,e.bounds.max.x-=n.x,e.bounds.min.y-=n.y,e.bounds.max.y-=n.y,e.mouse&&(d.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),d.setOffset(e.mouse,e.bounds.min))},o.startViewTransform=function(e){var t=e.bounds.max.x-e.bounds.min.x,n=e.bounds.max.y-e.bounds.min.y,o=t/e.options.width,i=n/e.options.height;e.context.scale(1/o,1/i),e.context.translate(-e.bounds.min.x,-e.bounds.min.y)},o.endViewTransform=function(e){e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0)},o.world=function(e){var t,n=e.engine,i=n.world,u=e.canvas,p=e.context,f=e.options,v=r.allBodies(i),y=r.allConstraints(i),g=f.wireframes?f.wireframeBackground:f.background,x=[],h=[],b={timestamp:n.timing.timestamp};if(a.trigger(e,"beforeRender",b),e.currentBackground!==g&&m(e,g),p.globalCompositeOperation="source-in",p.fillStyle="transparent",p.fillRect(0,0,u.width,u.height),p.globalCompositeOperation="source-over",f.hasBounds){for(t=0;t<v.length;t++){var w=v[t];s.overlaps(w.bounds,e.bounds)&&x.push(w)}for(t=0;t<y.length;t++){var S=y[t],C=S.bodyA,A=S.bodyB,P=S.pointA,B=S.pointB;C&&(P=c.add(C.position,S.pointA)),A&&(B=c.add(A.position,S.pointB)),P&&B&&((s.contains(e.bounds,P)||s.contains(e.bounds,B))&&h.push(S))}o.startViewTransform(e),e.mouse&&(d.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),d.setOffset(e.mouse,e.bounds.min))}else h=y,x=v;!f.wireframes||n.enableSleeping&&f.showSleeping?o.bodies(e,x,p):(f.showConvexHulls&&o.bodyConvexHulls(e,x,p),o.bodyWireframes(e,x,p)),f.showBounds&&o.bodyBounds(e,x,p),(f.showAxes||f.showAngleIndicator)&&o.bodyAxes(e,x,p),f.showPositions&&o.bodyPositions(e,x,p),f.showVelocity&&o.bodyVelocity(e,x,p),f.showIds&&o.bodyIds(e,x,p),f.showSeparations&&o.separations(e,n.pairs.list,p),f.showCollisions&&o.collisions(e,n.pairs.list,p),f.showVertexNumbers&&o.vertexNumbers(e,x,p),f.showMousePosition&&o.mousePosition(e,e.mouse,p),o.constraints(h,p),f.showBroadphase&&n.broadphase.controller===l&&o.grid(e,n.broadphase,p),f.showDebug&&o.debug(e,p),f.hasBounds&&o.endViewTransform(e),a.trigger(e,"afterRender",b)},o.debug=function(e,t){var n=t,o=e.engine,i=o.world,s=o.metrics,a=e.options;r.allBodies(i);if(o.timing.timestamp-(e.debugTimestamp||0)>=500){var l="";s.timing&&(l+="fps: "+Math.round(s.timing.fps)+"    "),e.debugString=l,e.debugTimestamp=o.timing.timestamp}if(e.debugString){n.font="12px Arial",a.wireframes?n.fillStyle="rgba(255,255,255,0.5)":n.fillStyle="rgba(0,0,0,0.5)";for(var c=e.debugString.split("\n"),d=0;d<c.length;d++)n.fillText(c[d],50,50+18*d)}},o.constraints=function(e,t){for(var n=t,o=0;o<e.length;o++){var r=e[o];if(r.render.visible&&r.pointA&&r.pointB){var s,a,l=r.bodyA,d=r.bodyB;if(s=l?c.add(l.position,r.pointA):r.pointA,"pin"===r.render.type)n.beginPath(),n.arc(s.x,s.y,3,0,2*Math.PI),n.closePath();else{if(a=d?c.add(d.position,r.pointB):r.pointB,n.beginPath(),n.moveTo(s.x,s.y),"spring"===r.render.type)for(var u,p=c.sub(a,s),m=c.perp(c.normalise(p)),f=Math.ceil(i.clamp(r.length/5,12,20)),v=1;v<f;v+=1)u=v%2==0?1:-1,n.lineTo(s.x+p.x*(v/f)+m.x*u*4,s.y+p.y*(v/f)+m.y*u*4);n.lineTo(a.x,a.y)}r.render.lineWidth&&(n.lineWidth=r.render.lineWidth,n.strokeStyle=r.render.strokeStyle,n.stroke()),r.render.anchors&&(n.fillStyle=r.render.strokeStyle,n.beginPath(),n.arc(s.x,s.y,3,0,2*Math.PI),n.arc(a.x,a.y,3,0,2*Math.PI),n.closePath(),n.fill())}}},o.bodyShadows=function(e,t,n){for(var o=n,i=(e.engine,0);i<t.length;i++){var r=t[i];if(r.render.visible){if(r.circleRadius)o.beginPath(),o.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI),o.closePath();else{o.beginPath(),o.moveTo(r.vertices[0].x,r.vertices[0].y);for(var s=1;s<r.vertices.length;s++)o.lineTo(r.vertices[s].x,r.vertices[s].y);o.closePath()}var a=r.position.x-.5*e.options.width,l=r.position.y-.2*e.options.height,c=Math.abs(a)+Math.abs(l);o.shadowColor="rgba(0,0,0,0.15)",o.shadowOffsetX=.05*a,o.shadowOffsetY=.05*l,o.shadowBlur=1+12*Math.min(1,c/1e3),o.fill(),o.shadowColor=null,o.shadowOffsetX=null,o.shadowOffsetY=null,o.shadowBlur=null}}},o.bodies=function(e,t,n){var o,i,r,s,a=n,l=(e.engine,e.options),c=l.showInternalEdges||!l.wireframes;for(r=0;r<t.length;r++)if((o=t[r]).render.visible)for(s=o.parts.length>1?1:0;s<o.parts.length;s++)if((i=o.parts[s]).render.visible){if(l.showSleeping&&o.isSleeping?a.globalAlpha=.5*i.render.opacity:1!==i.render.opacity&&(a.globalAlpha=i.render.opacity),i.render.sprite&&i.render.sprite.texture&&!l.wireframes){var d=i.render.sprite,u=p(e,d.texture);a.translate(i.position.x,i.position.y),a.rotate(i.angle),a.drawImage(u,u.width*-d.xOffset*d.xScale,u.height*-d.yOffset*d.yScale,u.width*d.xScale,u.height*d.yScale),a.rotate(-i.angle),a.translate(-i.position.x,-i.position.y)}else{if(i.circleRadius)a.beginPath(),a.arc(i.position.x,i.position.y,i.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(i.vertices[0].x,i.vertices[0].y);for(var m=1;m<i.vertices.length;m++)!i.vertices[m-1].isInternal||c?a.lineTo(i.vertices[m].x,i.vertices[m].y):a.moveTo(i.vertices[m].x,i.vertices[m].y),i.vertices[m].isInternal&&!c&&a.moveTo(i.vertices[(m+1)%i.vertices.length].x,i.vertices[(m+1)%i.vertices.length].y);a.lineTo(i.vertices[0].x,i.vertices[0].y),a.closePath()}l.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb",a.stroke()):(a.fillStyle=i.render.fillStyle,i.render.lineWidth&&(a.lineWidth=i.render.lineWidth,a.strokeStyle=i.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},o.bodyWireframes=function(e,t,n){var o,i,r,s,a,l=n,c=e.options.showInternalEdges;for(l.beginPath(),r=0;r<t.length;r++)if((o=t[r]).render.visible)for(a=o.parts.length>1?1:0;a<o.parts.length;a++){for(i=o.parts[a],l.moveTo(i.vertices[0].x,i.vertices[0].y),s=1;s<i.vertices.length;s++)!i.vertices[s-1].isInternal||c?l.lineTo(i.vertices[s].x,i.vertices[s].y):l.moveTo(i.vertices[s].x,i.vertices[s].y),i.vertices[s].isInternal&&!c&&l.moveTo(i.vertices[(s+1)%i.vertices.length].x,i.vertices[(s+1)%i.vertices.length].y);l.lineTo(i.vertices[0].x,i.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},o.bodyConvexHulls=function(e,t,n){var o,i,r,s=n;for(s.beginPath(),i=0;i<t.length;i++)if((o=t[i]).render.visible&&1!==o.parts.length){for(s.moveTo(o.vertices[0].x,o.vertices[0].y),r=1;r<o.vertices.length;r++)s.lineTo(o.vertices[r].x,o.vertices[r].y);s.lineTo(o.vertices[0].x,o.vertices[0].y)}s.lineWidth=1,s.strokeStyle="rgba(255,255,255,0.2)",s.stroke()},o.vertexNumbers=function(e,t,n){var o,i,r,s=n;for(o=0;o<t.length;o++){var a=t[o].parts;for(r=a.length>1?1:0;r<a.length;r++){var l=a[r];for(i=0;i<l.vertices.length;i++)s.fillStyle="rgba(255,255,255,0.2)",s.fillText(o+"_"+i,l.position.x+.8*(l.vertices[i].x-l.position.x),l.position.y+.8*(l.vertices[i].y-l.position.y))}}},o.mousePosition=function(e,t,n){var o=n;o.fillStyle="rgba(255,255,255,0.8)",o.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)},o.bodyBounds=function(e,t,n){var o=n,i=(e.engine,e.options);o.beginPath();for(var r=0;r<t.length;r++){if(t[r].render.visible)for(var s=t[r].parts,a=s.length>1?1:0;a<s.length;a++){var l=s[a];o.rect(l.bounds.min.x,l.bounds.min.y,l.bounds.max.x-l.bounds.min.x,l.bounds.max.y-l.bounds.min.y)}}i.wireframes?o.strokeStyle="rgba(255,255,255,0.08)":o.strokeStyle="rgba(0,0,0,0.1)",o.lineWidth=1,o.stroke()},o.bodyAxes=function(e,t,n){var o,i,r,s,a=n,l=(e.engine,e.options);for(a.beginPath(),i=0;i<t.length;i++){var c=t[i],d=c.parts;if(c.render.visible)if(l.showAxes)for(r=d.length>1?1:0;r<d.length;r++)for(o=d[r],s=0;s<o.axes.length;s++){var u=o.axes[s];a.moveTo(o.position.x,o.position.y),a.lineTo(o.position.x+20*u.x,o.position.y+20*u.y)}else for(r=d.length>1?1:0;r<d.length;r++)for(o=d[r],s=0;s<o.axes.length;s++)a.moveTo(o.position.x,o.position.y),a.lineTo((o.vertices[0].x+o.vertices[o.vertices.length-1].x)/2,(o.vertices[0].y+o.vertices[o.vertices.length-1].y)/2)}l.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},o.bodyPositions=function(e,t,n){var o,i,r,s,a=n,l=(e.engine,e.options);for(a.beginPath(),r=0;r<t.length;r++)if((o=t[r]).render.visible)for(s=0;s<o.parts.length;s++)i=o.parts[s],a.arc(i.position.x,i.position.y,3,0,2*Math.PI,!1),a.closePath();for(l.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),r=0;r<t.length;r++)(o=t[r]).render.visible&&(a.arc(o.positionPrev.x,o.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},o.bodyVelocity=function(e,t,n){var o=n;o.beginPath();for(var i=0;i<t.length;i++){var r=t[i];r.render.visible&&(o.moveTo(r.position.x,r.position.y),o.lineTo(r.position.x+2*(r.position.x-r.positionPrev.x),r.position.y+2*(r.position.y-r.positionPrev.y)))}o.lineWidth=3,o.strokeStyle="cornflowerblue",o.stroke()},o.bodyIds=function(e,t,n){var o,i,r=n;for(o=0;o<t.length;o++)if(t[o].render.visible){var s=t[o].parts;for(i=s.length>1?1:0;i<s.length;i++){var a=s[i];r.font="12px Arial",r.fillStyle="rgba(255,255,255,0.5)",r.fillText(a.id,a.position.x+10,a.position.y-10)}}},o.collisions=function(e,t,n){var o,i,r,s,a=n,l=e.options;for(a.beginPath(),r=0;r<t.length;r++)if((o=t[r]).isActive)for(i=o.collision,s=0;s<o.activeContacts.length;s++){var c=o.activeContacts[s].vertex;a.rect(c.x-1.5,c.y-1.5,3.5,3.5)}for(l.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),r=0;r<t.length;r++)if((o=t[r]).isActive&&(i=o.collision,o.activeContacts.length>0)){var d=o.activeContacts[0].vertex.x,u=o.activeContacts[0].vertex.y;2===o.activeContacts.length&&(d=(o.activeContacts[0].vertex.x+o.activeContacts[1].vertex.x)/2,u=(o.activeContacts[0].vertex.y+o.activeContacts[1].vertex.y)/2),i.bodyB===i.supports[0].body||!0===i.bodyA.isStatic?a.moveTo(d-8*i.normal.x,u-8*i.normal.y):a.moveTo(d+8*i.normal.x,u+8*i.normal.y),a.lineTo(d,u)}l.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},o.separations=function(e,t,n){var o,i,r,s,a,l=n,c=e.options;for(l.beginPath(),a=0;a<t.length;a++)if((o=t[a]).isActive){r=(i=o.collision).bodyA;var d=1;(s=i.bodyB).isStatic||r.isStatic||(d=.5),s.isStatic&&(d=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x-i.penetration.x*d,s.position.y-i.penetration.y*d),d=1,s.isStatic||r.isStatic||(d=.5),r.isStatic&&(d=0),l.moveTo(r.position.x,r.position.y),l.lineTo(r.position.x+i.penetration.x*d,r.position.y+i.penetration.y*d)}c.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},o.grid=function(e,t,n){var o=n;e.options.wireframes?o.strokeStyle="rgba(255,180,0,0.1)":o.strokeStyle="rgba(255,180,0,0.5)",o.beginPath();for(var r=i.keys(t.buckets),s=0;s<r.length;s++){var a=r[s];if(!(t.buckets[a].length<2)){var l=a.split(/C|R/);o.rect(.5+parseInt(l[1],10)*t.bucketWidth,.5+parseInt(l[2],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}o.lineWidth=1,o.stroke()},o.inspector=function(e,t){e.engine;var n,o=e.selected,i=e.render,r=i.options;if(r.hasBounds){var s=i.bounds.max.x-i.bounds.min.x,a=i.bounds.max.y-i.bounds.min.y,l=s/i.options.width,c=a/i.options.height;t.scale(1/l,1/c),t.translate(-i.bounds.min.x,-i.bounds.min.y)}for(var d=0;d<o.length;d++){var u=o[d].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),u.type){case"body":n=u.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var p=u.pointA;u.bodyA&&(p=u.pointB),t.beginPath(),t.arc(p.x,p.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),r.hasBounds&&t.setTransform(1,0,0,1,0,0)};var n=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},u=function(e){var t=e.getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},p=function(e,t){var n=e.textures[t];return n||((n=e.textures[t]=new Image).src=t,n)},m=function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}}()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../geometry/Bounds":26,"../geometry/Vector":28}],32:[function(e,t,n){var o={};t.exports=o;var i=e("../geometry/Bounds"),r=e("../body/Composite"),s=e("../core/Common"),a=e("../core/Events"),l=e("../geometry/Vector");!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(s.now())},1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),o.create=function(e){s.warn("RenderPixi.create: Matter.RenderPixi is deprecated (see docs)");var t={controller:o,engine:null,element:null,frameRequestId:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},n=s.extend(t,e),i=!n.options.wireframes&&"transparent"===n.options.background;return n.pixiOptions=n.pixiOptions||{view:n.canvas,transparent:i,antialias:!0,backgroundColor:e.background},n.mouse=e.mouse,n.engine=e.engine,n.renderer=n.renderer||new PIXI.WebGLRenderer(n.options.width,n.options.height,n.pixiOptions),n.container=n.container||new PIXI.Container,n.spriteContainer=n.spriteContainer||new PIXI.Container,n.canvas=n.canvas||n.renderer.view,n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.options.width,y:n.options.height}},a.on(n.engine,"beforeUpdate",function(){o.clear(n)}),n.textures={},n.sprites={},n.primitives={},n.container.addChild(n.spriteContainer),s.isElement(n.element)?n.element.appendChild(n.canvas):s.warn('No "render.element" passed, "render.canvas" was not inserted into document.'),n.canvas.oncontextmenu=function(){return!1},n.canvas.onselectstart=function(){return!1},n},o.run=function(t){!function n(i){t.frameRequestId=e(n),o.world(t)}()},o.stop=function(e){t(e.frameRequestId)},o.clear=function(e){for(var t=e.container,n=e.spriteContainer;t.children[0];)t.removeChild(t.children[0]);for(;n.children[0];)n.removeChild(n.children[0]);var o=e.sprites["bg-0"];e.textures={},e.sprites={},e.primitives={},e.sprites["bg-0"]=o,o&&t.addChildAt(o,0),e.container.addChild(e.spriteContainer),e.currentBackground=null,t.scale.set(1,1),t.position.set(0,0)},o.setBackground=function(e,t){if(e.currentBackground!==t){var n=t.indexOf&&-1!==t.indexOf("#"),o=e.sprites["bg-0"];if(n){var i=s.colorToNumber(t);e.renderer.backgroundColor=i,o&&e.container.removeChild(o)}else if(!o){var r=d(e,t);(o=e.sprites["bg-0"]=new PIXI.Sprite(r)).position.x=0,o.position.y=0,e.container.addChildAt(o,0)}e.currentBackground=t}},o.world=function(e){var t,n=e.engine.world,s=e.renderer,a=e.container,c=e.options,d=r.allBodies(n),u=r.allConstraints(n),p=[];c.wireframes?o.setBackground(e,c.wireframeBackground):o.setBackground(e,c.background);var m=e.bounds.max.x-e.bounds.min.x,f=e.bounds.max.y-e.bounds.min.y,v=m/e.options.width,y=f/e.options.height;if(c.hasBounds){for(t=0;t<d.length;t++){var g=d[t];g.render.sprite.visible=i.overlaps(g.bounds,e.bounds)}for(t=0;t<u.length;t++){var x=u[t],h=x.bodyA,b=x.bodyB,w=x.pointA,S=x.pointB;h&&(w=l.add(h.position,x.pointA)),b&&(S=l.add(b.position,x.pointB)),w&&S&&((i.contains(e.bounds,w)||i.contains(e.bounds,S))&&p.push(x))}a.scale.set(1/v,1/y),a.position.set(-e.bounds.min.x*(1/v),-e.bounds.min.y*(1/y))}else p=u;for(t=0;t<d.length;t++)o.body(e,d[t]);for(t=0;t<p.length;t++)o.constraint(e,p[t]);s.render(a)},o.constraint=function(e,t){e.engine;var n=t.bodyA,o=t.bodyB,i=t.pointA,r=t.pointB,a=e.container,l=t.render,c="c-"+t.id,d=e.primitives[c];d||(d=e.primitives[c]=new PIXI.Graphics),l.visible&&t.pointA&&t.pointB?(-1===s.indexOf(a.children,d)&&a.addChild(d),d.clear(),d.beginFill(0,0),d.lineStyle(l.lineWidth,s.colorToNumber(l.strokeStyle),1),n?d.moveTo(n.position.x+i.x,n.position.y+i.y):d.moveTo(i.x,i.y),o?d.lineTo(o.position.x+r.x,o.position.y+r.y):d.lineTo(r.x,r.y),d.endFill()):d.clear()},o.body=function(e,t){e.engine;var o=t.render;if(o.visible)if(o.sprite&&o.sprite.texture){var i="b-"+t.id,r=e.sprites[i],a=e.spriteContainer;r||(r=e.sprites[i]=n(e,t)),-1===s.indexOf(a.children,r)&&a.addChild(r),r.position.x=t.position.x,r.position.y=t.position.y,r.rotation=t.angle,r.scale.x=o.sprite.xScale||1,r.scale.y=o.sprite.yScale||1}else{var l="b-"+t.id,d=e.primitives[l],u=e.container;d||((d=e.primitives[l]=c(e,t)).initialAngle=t.angle),-1===s.indexOf(u.children,d)&&u.addChild(d),d.position.x=t.position.x,d.position.y=t.position.y,d.rotation=t.angle-d.initialAngle}};var n=function(e,t){var n=t.render.sprite.texture,o=d(e,n),i=new PIXI.Sprite(o);return i.anchor.x=t.render.sprite.xOffset,i.anchor.y=t.render.sprite.yOffset,i},c=function(e,t){var n,o=t.render,i=e.options,r=new PIXI.Graphics,a=s.colorToNumber(o.fillStyle),l=s.colorToNumber(o.strokeStyle),c=s.colorToNumber(o.strokeStyle),d=s.colorToNumber("#bbb"),u=s.colorToNumber("#CD5C5C");r.clear();for(var p=t.parts.length>1?1:0;p<t.parts.length;p++){n=t.parts[p],i.wireframes?(r.beginFill(0,0),r.lineStyle(1,d,1)):(r.beginFill(a,1),r.lineStyle(o.lineWidth,l,1)),r.moveTo(n.vertices[0].x-t.position.x,n.vertices[0].y-t.position.y);for(var m=1;m<n.vertices.length;m++)r.lineTo(n.vertices[m].x-t.position.x,n.vertices[m].y-t.position.y);r.lineTo(n.vertices[0].x-t.position.x,n.vertices[0].y-t.position.y),r.endFill(),(i.showAngleIndicator||i.showAxes)&&(r.beginFill(0,0),i.wireframes?r.lineStyle(1,u,1):r.lineStyle(1,c),r.moveTo(n.position.x-t.position.x,n.position.y-t.position.y),r.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2-t.position.x,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2-t.position.y),r.endFill())}return r},d=function(e,t){var n=e.textures[t];return n||(n=e.textures[t]=PIXI.Texture.fromImage(t)),n}}()},{"../body/Composite":2,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":26,"../geometry/Vector":28}]},{},[30])(30)});
},{}],"gAj0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=n(require("phina.js")),t=n(require("matter-js"));function n(e){return e&&e.__esModule?e:{default:e}}var r=e.default.define("mc.matter.MatterLayer",{superClass:e.default.display.DisplayElement,mtEngine:null,mtWorld:null,init:function(e){var n=this;this.superInit(e),this.mtEngine=t.default.Engine.create(),this.mtWorld=this.mtEngine.world;var r=function(e){n.has(e.name)&&n.flare(e.name,e)};["collisionStart","collisionActive","collisionEnd"].forEach(function(e){t.default.Events.on(n.mtEngine,e,r)}),this.one("enterframe",function(e){var a=t.default.MouseConstraint.create(n.mtEngine,{mouse:t.default.Mouse.create(e.app.canvas.domElement)});["startdrag","enddrag"].forEach(function(e){t.default.Events.on(a,e,r)}),t.default.World.add(n.mtWorld,a)}),this.on("enterframe",function(e){var r=e.app.ticker.deltaTime;t.default.Engine.update(n.mtEngine,r)})},addChild:function(e){return this.superMethod("addChild",e),e.mtBody&&t.default.World.add(this.mtWorld,e.mtBody),e},removeChild:function(e){return this.superMethod("removeChild",e),e.mtBody&&t.default.World.remove(this.mtWorld,e.mtBody),this}});exports.default=r;
},{"phina.js":"OtoZ","matter-js":"mG0D"}],"d6KO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"MatterLayer",{enumerable:!0,get:function(){return e.default}});var e=r(require("./MatterLayer"));function r(e){return e&&e.__esModule?e:{default:e}}
},{"./MatterLayer":"gAj0"}],"PAk2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=s(require("phina.js")),e=s(require("matter-js")),i=require("../constants");function s(t){return t&&t.__esModule?t:{default:t}}var n=t.default.define("mc.display.Shape",{superClass:t.default.display.Shape,mtBody:null,label:null,cmyList:null,init:function(e){this.superInit(e),this.label=t.default.display.Label({fontSize:50,text:"1",fill:"#888",fontFamily:i.FONT.DEFAULT,fontWeight:"700",stroke:"#fff",strokeWidth:12}).addChildTo(this),this.cmyList=e.cmyList||[{c:1,m:0,y:0}],this.applyCmyList()},applyCmyList:function(){var t=this.cmyList.length,e={c:0,m:0,y:0};this.cmyList.forEach(function(i){e.c+=i.c/t,e.m+=i.m/t,e.y+=i.y/t}),e.c=.7*Math.min(e.c,1),e.m=.7*Math.min(e.m,1),e.y=.7*Math.min(e.y,1);var i=Math.floor(255*(1-e.c)),s=Math.floor(255*(1-e.m)),n=Math.floor(255*(1-e.y));return this.fill="rgb(".concat(i,", ").concat(s,", ").concat(n,")"),this.label.text=t.toString(),this},mtSetLabel:function(t){return this.mtBody.plugin.mcLabel=t,this},mtSet:function(t,i){return e.default.Body.set(this.mtBody,t,i),this},mtSetStatic:function(t){return e.default.Body.setStatic(this.mtBody,t),this},mtSetDensity:function(t){return e.default.Body.setDensity(this.mtBody,t),this},mtSetInertia:function(t){return e.default.Body.setInertia(this.mtBody,t),this},mtSetVertices:function(t){return e.default.Body.setVertices(this.mtBody,t),this},mtSetParts:function(t,i){return e.default.Body.setParts(this.mtBody,t,i),this},mtSetPosition:function(t){return e.default.Body.setPosition(this.mtBody,t),this},mtSetAngle:function(t){return e.default.Body.setAngle(this.mtBody,t),this},mtSetVelocity:function(t){return e.default.Body.setVelocity(this.mtBody,t),this},mtSetAngularVelocity:function(t){return e.default.Body.setAngularVelocity(this.mtBody,t),this},mtTranslate:function(t){return e.default.Body.translate(this.mtBody,t),this},mtRotate:function(t,i){return e.default.Body.rotate(this.mtBody,t,i),this},mtScale:function(t,i,s){return e.default.Body.scale(this.mtBody,t,i,s),this.setScale(this.scale.x*t,this.scale.y*i),this},mtApplyForce:function(t,i){return e.default.Body.applyForce(this.mtBody,t,i),this}});exports.default=n;
},{"phina.js":"OtoZ","matter-js":"mG0D","../constants":"iJA9"}],"xwme":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=r(require("phina.js")),e=r(require("matter-js")),i=r(require("./Shape"));function r(t){return t&&t.__esModule?t:{default:t}}var s=t.default.define("mc.display.RectangleShape",{superClass:i.default,init:function(t){var i=this;t={}.$safe(t,{width:100,height:100,backgroundColor:"transparent",fill:"blue",stroke:"transparent",cornerRadius:0}),this.superInit(t),this.cornerRadius=t.cornerRadius,this.mtBody=e.default.Bodies.rectangle(this.x,this.y,this.width,this.height,{restitution:.5}),this.mtSetAngle(this.rotation*Math.DEG_TO_RAD),this.mtSetLabel("rectangle"),this.mtBody.plugin.mcObject=this,this.on("enterframe",function(t){i.x=i.mtBody.position.x,i.y=i.mtBody.position.y,i.rotation=i.mtBody.angle*Math.RAD_TO_DEG})},prerender:function(t){t.roundRect(-this.width/2,-this.height/2,this.width,this.height,this.cornerRadius)}});exports.default=s;
},{"phina.js":"OtoZ","matter-js":"mG0D","./Shape":"PAk2"}],"r86y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=r(require("phina.js")),e=r(require("matter-js")),i=r(require("./Shape"));function r(t){return t&&t.__esModule?t:{default:t}}var s=t.default.define("mc.display.CircleShape",{superClass:i.default,init:function(t){var i=this;t={}.$safe(t,{backgroundColor:"transparent",fill:"red",stroke:"transparent",radius:56}),this.superInit(t),this.setBoundingType("circle"),this.mtBody=e.default.Bodies.circle(this.x,this.y,this.radius,{restitution:.5}),this.mtSetAngle(this.rotation*Math.DEG_TO_RAD),this.mtSetLabel("circle"),this.mtBody.plugin.mcObject=this,this.on("enterframe",function(t){i.x=i.mtBody.position.x,i.y=i.mtBody.position.y,i.rotation=i.mtBody.angle*Math.RAD_TO_DEG})},prerender:function(t){t.circle(0,0,this.radius)}});exports.default=s;
},{"phina.js":"OtoZ","matter-js":"mG0D","./Shape":"PAk2"}],"ueps":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=r(require("phina.js")),e=r(require("matter-js")),i=r(require("./Shape"));function r(t){return t&&t.__esModule?t:{default:t}}var s=t.default.define("mc.display.TriangleShape",{superClass:i.default,rotationOffset:30,init:function(t){var i=this;t={}.$safe(t,{backgroundColor:"transparent",fill:"green",stroke:"transparent",radius:87}),this.superInit(t),this.setBoundingType("circle"),this.mtBody=e.default.Bodies.polygon(this.x,this.y,3,this.radius,{restitution:.5}),this.mtSetAngle((this.rotation-this.rotationOffset)*Math.DEG_TO_RAD),this.mtSetLabel("triangle"),this.mtBody.plugin.mcObject=this,this.on("enterframe",function(t){i.x=i.mtBody.position.x,i.y=i.mtBody.position.y,i.rotation=i.mtBody.angle*Math.RAD_TO_DEG+i.rotationOffset})},prerender:function(t){t.polygon(0,0,this.radius,3)}});exports.default=s;
},{"phina.js":"OtoZ","matter-js":"mG0D","./Shape":"PAk2"}],"kIeH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Shape",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"RectangleShape",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(exports,"CircleShape",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(exports,"TriangleShape",{enumerable:!0,get:function(){return n.default}});var e=u(require("./Shape")),r=u(require("./RectangleShape")),t=u(require("./CircleShape")),n=u(require("./TriangleShape"));function u(e){return e&&e.__esModule?e:{default:e}}
},{"./Shape":"PAk2","./RectangleShape":"xwme","./CircleShape":"r86y","./TriangleShape":"ueps"}],"X8aN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("phina.js"));function t(e){return e&&e.__esModule?e:{default:e}}var r=e.default.define("mc.effect.Wave",{superClass:e.default.display.CircleShape,init:function(e,t){var r=this;this.superInit({padding:50,radius:50,fill:"transparent",stroke:e,strokeWidth:50,x:t.x,y:t.y}),this.tweener.clear().to({radius:200,strokeWidth:0},200,"easeOutSine").call(function(){r.remove()})}});exports.default=r;
},{"phina.js":"OtoZ"}],"rJE3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Wave",{enumerable:!0,get:function(){return e.default}});var e=r(require("./Wave"));function r(e){return e&&e.__esModule?e:{default:e}}
},{"./Wave":"X8aN"}],"FOZT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cmyToRgb=exports.cmyExact=exports.cmySum=void 0;var t=function(t){return t.reduce(function(t,r){return{c:t.c+r.c,m:t.m+r.m,y:t.y+r.y}},{c:0,m:0,y:0})};exports.cmySum=t;var r=function(r,c){if(r.length!==c.length)return!1;var e=t(r),o=t(c);return e.c===o.c&&e.m===o.m&&e.y===o.y};exports.cmyExact=r;var c=function(r){var c=t(r),e=r.length,o=c.c/e*.7,n=c.m/e*.7,m=c.y/e*.7,u=Math.floor(255*(1-o)),a=Math.floor(255*(1-n)),y=Math.floor(255*(1-m));return"rgb(".concat(u,", ").concat(a,", ").concat(y,")")};exports.cmyToRgb=c;
},{}],"usmn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=l(require("phina.js")),t=l(require("matter-js")),i=require("../constants"),r=require("../matter/"),a=require("../display/"),n=require("../effect/"),o=require("../utils");function l(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=f(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,l=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return o=e.done,e},e:function(e){l=!0,n=e},f:function(){try{o||null==i.return||i.return()}finally{if(l)throw n}}}}function c(e){return d(e)||h(e)||f(e)||u()}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){if(e){if("string"==typeof e)return p(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(e,t):void 0}}function h(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function d(e){if(Array.isArray(e))return p(e)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function m(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(Object(i),!0).forEach(function(t){g(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function g(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var b=e.default.define("mc.scene.MainScene",{superClass:e.default.display.DisplayScene,mtLayer:null,baseColors:null,mixedColors:null,level:null,stage:null,time:null,isClear:null,answers:null,init:function(t){var a=this;this.superInit(t),this.baseColors=Object.values(i.BASE_COLOR),this.mixedColors=i.MIXED_COLORS,this.backgroundColor=i.COLOR.BASE,this.mtLayer=(0,r.MatterLayer)({width:i.SCREEN.W,height:i.SCREEN.H}).addChildTo(this),this.mtLayer.mtWorld.gravity.y=0,this._createWall(),this.topBar=e.default.display.RectangleShape({fill:"#fff",stroke:"transparent",width:i.SCREEN.W,height:i.SCREEN.H/8,x:i.SCREEN.W/2,y:i.SCREEN.H/16}).addChildTo(this);var n={fill:"#888",fontSize:28,fontFamily:i.FONT.DEFAULT,fontWeight:"300",align:"left",x:10};this.stageLabel=e.default.display.Label(m(m({},n),{},{text:"stage: 1",y:30})).addChildTo(this),this.timeLabel=e.default.display.Label(m(m({},n),{},{text:"time:\n  00:01",y:80})).addChildTo(this),this.mtLayer.on("collisionStart",function(e){a._onCollision(e)}),this.mtLayer.on("startdrag",function(e){e.body.plugin.isDrag=!0}),this.mtLayer.on("enddrag",function(e){e.body.plugin.isDrag=!1}),this.time=0,this.level=1,this.stage=1,this.isClear=!1,this._createStage()},update:function(e){this.time+=e.ticker.deltaTime;var t=Math.floor(this.time/1e3),i=Math.floor(t/60),r=(t%60).padding(2,"0"),a=i.padding(2,"0");this.timeLabel.text="time:\n  ".concat(a,":").concat(r)},_spawn:function(e,t,r){var n,o={cmyList:[t]};switch(e){case"rectangle":n=(0,a.RectangleShape)(o);break;case"circle":n=(0,a.CircleShape)(o);break;case"triangle":n=(0,a.TriangleShape)(o)}r=r||{x:i.SCREEN.W/2,y:i.SCREEN.H/2},n.addChildTo(this.mtLayer).mtSetPosition(r),n.mtSetAngularVelocity(Math.randfloat(-.5,.5))},_onCollision:function(e){var t=this;if(!this.isClear){var i=e.pairs[0],r=i.bodyA,a=i.bodyB,o=r.plugin.mcObject,l=a.plugin.mcObject;if("wall"===r.plugin.mcLabel){if(a.plugin.isDrag||1===l.cmyList.length||a.speed<30)return;l.cmyList.forEach(function(e){t._spawn(a.plugin.mcLabel,e,a.position)}),(0,n.Wave)(l.fill,l.position).addChildTo(this),l.remove(),this._checkClear()}else if(r.plugin.mcLabel===a.plugin.mcLabel){if(!r.plugin.isDrag&&!a.plugin.isDrag)return;if(o.cmyList.length+l.cmyList.length>6)return;var s,u;if(a.plugin.isDrag)(s=l.cmyList).push.apply(s,c(o.cmyList)),l.applyCmyList(),o.remove(),(0,n.Wave)(l.fill,l.position).addChildTo(this);else(u=o.cmyList).push.apply(u,c(l.cmyList)),o.applyCmyList(),l.remove(),(0,n.Wave)(o.fill,o.position).addChildTo(this);this._checkClear()}}},_checkClear:function(){this.answers.forEach(function(e){e.isCorrect=!1,e.starShape.fill="#fff"});var e,t=s(this.mtLayer.children);try{e:for(t.s();!(e=t.n()).done;){var i,r=e.value,a=s(this.answers);try{for(a.s();!(i=a.n()).done;){var n=i.value;if(!n.isCorrect&&(0,o.cmyExact)(r.cmyList,n.cmyList)){n.isCorrect=!0,n.starShape.fill=n.starShape.stroke;continue e}}}catch(l){a.e(l)}finally{a.f()}}}catch(l){t.e(l)}finally{t.f()}this.answers.every(function(e){return e.isCorrect})&&(this.isClear=!0,this._transionNextStage())},_createStage:function(){for(var t=this,i=[],r=["rectangle","circle","triangle"],a=this.level+1,n=Math.randint(0,2),l=function(l){var s=t.mixedColors.pickup(),c=(Math.randint(1,2)+n)%3,u=r[c];s.forEach(function(e){t._spawn(u,e)}),t._spawn(u,t.baseColors.pickup()),t._spawn(u,t.baseColors.pickup()),n=c;var f=50*(a-1),h=e.default.display.StarShape({padding:20,radius:38,x:100*l-f,fill:"#fff",stroke:(0,o.cmyToRgb)(s),strokeWidth:20,sideIndent:.5,rotation:-180}).setScale(0).addChildTo(t.topBar);h.tweener.wait(200*l).to({scaleX:1,scaleY:1,rotation:0},500,"swing"),i.push({starShape:h,cmyList:s,isCorrect:!1})},s=0;s<a;s++)l(s);this.answers=i,this.stageLabel.text="stage: ".concat(this.stage),this.isClear=!1},_transionNextStage:function(){var e=this;this.topBar.children.forEach(function(t,i){t.tweener.clear().wait(200*i).to({scaleX:0,scaleY:0,rotation:180},500,"swing").call(function(){var i=t.position.clone().add(e.topBar.position);(0,n.Wave)(t.fill,i).addChildTo(e),t.remove()})}),this.mtLayer.children.forEach(function(t,i){t.tweener.wait(200*i).to({scaleX:0,scaleY:0},500,"easeInSine").call(function(){(0,n.Wave)(t.fill,t.position).addChildTo(e),t.remove()})}),this.tweener.clear().wait(200*this.mtLayer.children.length+500).call(function(){e.stage++,e._createStage()})},_createWall:function(){var e={isStatic:!0},r=[t.default.Bodies.rectangle(i.SCREEN.W/2,i.SCREEN.H/8-500,i.SCREEN.W+2e3,1e3,e),t.default.Bodies.rectangle(i.SCREEN.W/2,i.SCREEN.H+500,i.SCREEN.W+2e3,1e3,e),t.default.Bodies.rectangle(-500,i.SCREEN.H/2,1e3,i.SCREEN.H+2e3,e),t.default.Bodies.rectangle(i.SCREEN.W+500,i.SCREEN.H/2,1e3,i.SCREEN.H+2e3,e)];t.default.World.add(this.mtLayer.mtWorld,r),r.forEach(function(e){e.plugin.mcLabel="wall"})}});exports.default=b;
},{"phina.js":"OtoZ","matter-js":"mG0D","../constants":"iJA9","../matter/":"d6KO","../display/":"kIeH","../effect/":"rJE3","../utils":"FOZT"}],"fj5L":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"MainScene",{enumerable:!0,get:function(){return e.default}});var e=r(require("./MainScene"));function r(e){return e&&e.__esModule?e:{default:e}}
},{"./MainScene":"usmn"}],"epB2":[function(require,module,exports) {
"use strict";var e=t(require("phina.js")),a=require("./constants"),n=require("./scene/");function t(e){return e&&e.__esModule?e:{default:e}}var r=[{className:n.MainScene.prototype.className,label:"main"}];e.default.main(function(){e.default.game.GameApp({width:a.SCREEN.W,height:a.SCREEN.H,startLabel:"main",runner:function(e){requestAnimationFrame(e)},scenes:r}).run()});
},{"phina.js":"OtoZ","./constants":"iJA9","./scene/":"fj5L"}]},{},["epB2"], null)